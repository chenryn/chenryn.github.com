<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">Archive</a></li>
      	<li><a href="/categories.html">Categories</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/tags.html">Tags</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
            <li><a href="/links.html">友情链接</a></li>
            <li><a href="/projects.html">学习记录</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/24/cacti-install" title="cacti安装记录" rel="bookmark">cacti安装记录</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-24 00:00:00 +0800">24 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>cacti运行在lamp环境下，采用net-snmp获得监控数据，由rrdtool绘图。所以cacti的安装，主要就是apache、mysql、php、rrdtool、net-snmp这几个的安装。其中apache2是我们服务器上早就有的，可以利用；而原有的php5因为不支持mysql，所以要重新编译。</p>
<ol>
  <li>mysql安装：</li>
</ol>
<div class="highlight"><pre><code class="bash">wget http://mysql.cs.pu.edu.tw/Downloads/MySQL-5.1/mysql-5.1.44.tar.gz
tar zxvf mysql-5.1.44.tar.gz
<span class="nb">cd </span>mysql-5.1.44
groupadd mysql
useradd mysql -g mysql
./configure --prefix<span class="o">=</span>/home/mysql --with-unix-socket...</code></pre></div>
</body></html>
      <a href="/2010/02/24/cacti-install" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/23/extend-shell-variables" title="shell变量扩展" rel="bookmark">shell变量扩展</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-23 00:00:00 +0800">23 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>第一种扩展形式，按长度截取：${PARAMETER:OFFSET:LENGTH}；例：</p>
<p>i=http://www.baidu.com/a/b.html;j=${i:1:10};echo $j
ttp://www.</p>
<p>第二种扩展形式，按模式截取：${PARAMETER#WORD}、${PARAMETER##WORD}、${PARAMETER%WORD}、${PARAMETER%%WORD}；例：</p>
<p>i=http://www.baidu.com/a/b.html;b=${i%/<em>};a=${i%%/</em>};c=${i#<em>/};d=${i##</em>/};echo $b;ech...</p>
</body></html>
      <a href="/2010/02/23/extend-shell-variables" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/22/esi-cache" title="ESI & CACHE 介绍" rel="bookmark">ESI & CACHE 介绍</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-22 00:00:00 +0800">22 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>今天看到一个叫做 ESI 的东东，以此为线索，一路链接下去，颇为有趣，摘抄些新闻/博客段落来，算作长眼了：</p>
<p>首先是《CSDN09大会见闻》，其中提到康神的讲演《网站的那些事儿》，介绍了大规模网站架构上的种种工具和技术“比如做数据切分的 Mysql Proxy，分布式缓存的 MemoryCached，Web ...</p>
</body></html>
      <a href="/2010/02/22/esi-cache" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/09/qhttpd" title="qhttpd" rel="bookmark">qhttpd</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-09 00:00:00 +0800">09 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>今天偷菜极不顺利，QQ空间老坏，看着那个Qhttpd的502提示页面就郁闷，决定自己也安一个看看。
<a href="http://www.qdecoder.org/qhttpd/download.qsp">http://www.qdecoder.org/qhttpd/download.qsp</a>
话说网上人都说QQ的视频服务器用的是qhttpd，Qzone用的是自己的qzhttpd呀。为啥农场的错误是qhttpd呢？
以上，过完年在说。呵呵
过年回来鸟~~去韩国下载了qhttpd来看，默认安装配置什么的，真的超级简单——功能也超级简单（连logformat都没有）。如果想要玩出花样来，好吧，从源代码开始，慢慢写C去吧~~~</p>
</body></html>
      <a href="/2010/02/09/qhttpd" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/09/intro-vary" title="cache驻留时间（七、Vary）" rel="bookmark">cache驻留时间（七、Vary）</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-09 00:00:00 +0800">09 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>之前的系列文章，只涉及squid本身，今天突然想到，其实这个网站加速，除了squid缓存这种缩短传...</p></body></html>
      <a href="/2010/02/09/intro-vary" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/06/squid-running-analysis" title="squid运行分析" rel="bookmark">squid运行分析</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-06 00:00:00 +0800">06 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>上回编译加载tcmalloc后，效果各有不同，所以还得细分具体运行情况，以便之后继续优化。
之前的架构是1个lvs下挂6台leaf+1台parent。现在已经给7台squid都加载tcmalloc了。leaf运行上佳，CPU占用率甚至降到了2%，loadavg也不过0.2。但parent的CPU占用率虽然降低，loadavg却依然在1以上——这对于单核服务器来说，可不是什么好事。分析日志，或者用squidclient分析cache情况，leaf如下：
cat access.log |awk ‘{if(/NONE/){a[NONE]++}}END{print a[NONE]/NR}’
0.981347
squidclient -p 80 mgr:info
    Cache information for squid:
    Request Hit Ratios: 5min: 97.8%, 60min: 98.3%
    Byte Hit Ratios: 5min: 97.8%, 60min: 98.2%
    Request Memory Hit Ratios: 5min: 85.8%, 60min: 86.8%
    Request Disk Hit Ratios: 5min: 9.8%, 60min: 9.1%
    Storage Swap size: 19891740 KB
    Storage Mem size: 1048572 KB
    Mean Object Size: 9.67 KB
可以看到缓存文件的平均大小不足10KB，绝大多数的请求都在内存中处理掉了。所以在加载了优化内存反应速度的tcmalloc后，效果那么明显。
parent如下：
$ cat access.log |awk ‘{if(/NONE/){a[NONE]++}}END{print a[NONE]/NR}’
0.179209
$ squidclient -p 80 mgr:info
    Cache information for squid:
    Request Hit Ratios: 5min: 31.1%, 60min: 32.3%
    Byte Hit Ratios: 5min: 38.4%, 60min: 36.9%
    Request Memory Hit Ratios: 5min: 7.8%, 60min: 12.2%
    Request Disk Hit Ratios: 5min: 32.7%, 60min: 37.9%
    Storage Swap size: 40300232 KB
    Storage Mem size: 524284 KB
    Mean Object Size: 11.68 KB
只有30%的缓存命中，而且基本还都是从磁盘读取的（awk结果排除了REFRESH_HIT，所以更低）。难怪上次优化没什么效用了……
为了保证服务，先给这组服务器加上了round-robin的双parent。新parent的硬件情况和老的一样。而squid配置上，则采用了aufs方式，不再使用diskd方式。运行到现在30个小时，分析如下：
$ cat /cache/logs/access.log |awk ‘{if(/NONE/){a[NONE]++}}END{print a[NONE]/NR}’
0.238754
$ squidclient -p 80...</p></body></html>
      <a href="/2010/02/06/squid-running-analysis" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/06/conntrack-of-netfilter" title="netfilter的conntrack优化" rel="bookmark">netfilter的conntrack优化</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-06 00:00:00 +0800">06 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p><a href="http://www.wallfire.org/misc/netfilter_conntrack_perf.txt">参考原文</a>
<a href="http://www.linuxmine.com/5791.html">中文版</a>
说是zz，好歹也是自己看完以后的zz，所以组织语言次序都是自己来：
首先解释两个概念性的名词</p>
<p>conntrack最大数量.叫做conntrack_max
存储这些conntrack的hash表的大小,叫做hashsize
hash表存在于固定的的不可swap的内存中.
conntrack_mark决定占用多少这些不可swap的内存
hashsize=conntrack_max/8=ramsize(in bytes)/131072/(x/32)
x表示使用的指针类型是(32位还是64的)</p>
<p>读取conntrack_max值
cat /proc/sys/net/ipv4/ip_conntrack_max</p>
<p>读取hashsize值
cat /proc/sys/net/ip...</p>
</body></html>
      <a href="/2010/02/06/conntrack-of-netfilter" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/04/performance-optimization-test-of-tcmalloc-loaded-by-squid-3" title="squid加载tcmalloc性能优化测试(编译)" rel="bookmark">squid加载tcmalloc性能优化测试(编译)</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-04 00:00:00 +0800">04 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>话接上文，同一组LVS下，昨天采用重编译方式部署了另一台squid服务器。同样跑上一天，再次对比一番。今天流量比上回稍微少些，未加载的服务器cacti监控截图如下：
<img src="/images/uploads/62d80b5eh73140310b076690.jpg" alt="" title="cpu" width="573" height="259" class="alignnone size-full wp-image-2565">
CPU占用率
=====================
<img src="/images/uploads/62d80b5eh73140316c9a2690.jpg" alt="" title="loadavg" width="569" height="254" class="alignnone size-full wp-image-2567">
负载</p>
<hr>
<p>同时，重编译过后的squid服务器监控截图如下：
<img src="/images/uploads/62d80b5eh7314031cd5b3690.jpg" alt="" title="cpu-new" width="572" height="261" class="alignnone size-full wp-image-2568">
CPU占用率（那个尖峰是我运行了一下lsof确认是否加载，lsof这个命令真是大杀器，少用……）
=====================
<img src="/images/uploads/62d80b5eh731403230ce5690.jpg" alt="" title="loadavg-new" width="570" height="258" class="alignnone size-full wp-image-2569">
负载</p>
<p>这么一对比，效果马上就出来了。难怪官方建议要用编译加载的方式呢~~~</p>
</body></html>
      <a href="/2010/02/04/performance-optimization-test-of-tcmalloc-loaded-by-squid-3" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/02/01/performance-optimization-test-of-tcmalloc-loaded-by-squid-2" title="squid加载tcmalloc性能优化测试(动态)" rel="bookmark">squid加载tcmalloc性能优化测试(动态)</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-02-01 00:00:00 +0800">01 Feb 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>昨天下午在一台squid上加载了tcmalloc。运行到现在，整整一天时间。现取LVS下与其完全相同配置的另一台未加载tcmalloc的squid服务器进行比较。
环境说明：
CPUinfo：Intel(R) Xeon(R) CPU  E5405  @ 2.00GHz
MEM：4G
SQUID：Version 2.6.STABLE21
当单台流量20M，TCP连接数6w时，未加载tcmalloc的服务器CPU占用率和负载情况如下图：
<img src="/images/uploads/62d80b5eh730dca4ebd76690.jpg" alt="" title="cpu%" width="572" height="263" class="alignnone size-full wp-image-2559">
CPU占用率
<img src="/images/uploads/62d80b5eh730dca57d6ee690.jpg" alt="" title="loadavg" width="575" height="257" class="alignnone size-full wp-image-2561">
负载</p>
<hr>
<p>而同时，加载了tcmalloc的服务器CPU占用率和负载情况如下图：
<img src="/images/uploads/62d80b5eh730dca5f8985690.jpg" alt="" title="cpu%-new" width="577" height="263" class="alignnone size-full wp-image-2562">
CPU占用率
<img src="/images/uploads/62d80b5eh730dca671bb7690.jpg" alt="" title="loadavg-new" width="579" height="259" class="alignnone size-full wp-image-2563">
负载（上一个尖峰就是我加载tcmalloc的时候）</p>
<p>从图中来看，加载tcmalloc，确实对squid处理高并发小图片请求有一定的性能优化帮助，但其本身对系统资源又有一定的耗用，导致负载反而略微提高（CPU占用率中sy...</p>
</body></html>
      <a href="/2010/02/01/performance-optimization-test-of-tcmalloc-loaded-by-squid-2" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/31/third-party-tools-about-squid" title="squid几个第三方工具" rel="bookmark">squid几个第三方工具</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-31 00:00:00 +0800">31 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p><a href="http://gadmintools.flippedweb.com/index.php?option=com_content&amp;task=view&amp;id=47&amp;Itemid=37#Download">GADMIN-SQUID</a> 在linux环境下运行，经本人下载src后看，只能用于本机squid管理，不支持批量……</p>
<p><a href="http://www.zerozone.it/Software/Linux/SquidTL/">SQUIDTL</a> 针对IP、domain进行访问时长控制，C语言编写，需配合MySQL，好复杂的架构……</p>
<p><a href="http://sourceforge.net/projects/squidmodel/">SQUIDMODEL</a> java平台，俺还没搞定，未知其所以然</p>
<p><a href="http://cachevideos.com">CACHEVIDEO</a> 专门针对yotube等网站的视频文件缓存开发的rewrite_program，python编写。可惜是要花钱滴~~</p>
</body></html>
      <a href="/2010/01/31/third-party-tools-about-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/31/performance-optimization-test-of-tcmalloc-loaded-by-squid-1" title="squid加载tcmalloc性能优化测试(原理)" rel="bookmark">squid加载tcmalloc性能优化测试(原理)</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-31 00:00:00 +0800">31 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>TCMalloc（Thread-Caching Malloc）是google开发的开源工具──“<a href="http://code.google.com/p/google-perftools/" title="google-perftools">google-perftools</a>”中的成员。其作者宣称tcmalloc相对于glibc2.3 malloc(aka-ptmalloc2)在内存的分配上效率和速度有6倍的性能提高，tcmalloc的常用场景是用于加速MySQL，不过据Wikipedia的hacker（Domas Mituzas）说，tcmalloc不仅仅对MySQL起作用，对squid也同样起作用（网上也有很多人在nginx上启用tcmalloc了），不过目前squid并没有official way来使用tcmalloc。
TCMalloc的实现原理和测试报告请见一篇文章：《<a href="http://shiningray.cn/tcmalloc-thread-caching-malloc.html">TCMalloc：线程缓存的Malloc</a>》
那么让我们赶紧给squid加载上tcmalloc，提高cache服务器在高并发情况下的性能，降低系统负载吧。
因为服务器是64位OS，所以要先安装libunwind库。libunwind库为基于64位CPU和操作系统的程序提供了基本的堆栈辗转开解功能，其中包括用于输出堆栈跟踪的API、用于以编程方式辗转开解堆栈的API以及支持C++异常处理机制的API。（又cp一...</p></body></html>
      <a href="/2010/01/31/performance-optimization-test-of-tcmalloc-loaded-by-squid-1" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/31/intro-header_replace" title="header_replace试验" rel="bookmark">header_replace试验</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-31 00:00:00 +0800">31 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在linuxtone论坛上，偶见一贴，说采用如下配置，browser就可以正常遵守originserver的过期设置，而且充分利用browser本身的缓存设置，对server来说就可以达到减少304请求的效果，从而提升机器性能，节省带宽云云……</p>
<p>header_access Age deny all
header_replace Age 1</p>
<p>这样reqly_header就显示成：Cache-Control: max-age=1。
（让我很郁闷的一点是squid.conf.default里提供的header_access配置条目不全……）</p>
<p>从之前的cache驻留时间系列里知道，在HTTP的header里，max-age的优先级别高于Expires[Cache-Control...</p>
</body></html>
      <a href="/2010/01/31/intro-header_replace" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/31/anti-hotlinking-by-external_acl" title="防盗链二进阶（squid外部ACL）" rel="bookmark">防盗链二进阶（squid外部ACL）</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-31 00:00:00 +0800">31 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>服务器防盗链设置，从最简单的referer判断，到进阶的key+time生成md5值，应该说是比较可靠了，而还有一种防盗链方式，基于IP/COOKIE的，这个我没找到太多有用信息，似乎IIS有个相关插件？
只看到一篇squid的相关文章，简单的举了个防盗链的例子，未必有效（因为把cookie做明文处理，相比md5加密实在是防君子不防小人）。倒是从中学习一下external_acl_type用法，对squid进阶一番罢~~
首先按惯例，上权威：《squid中文权威指南》6.1.3章节和12.5章节。
用法如下：
external_acl_type name [options] FORMAT.. /path/to/helper
[helper arguments..]
options包括：ttl、negtive_ttl、children、con...</p></body></html>
      <a href="/2010/01/31/anti-hotlinking-by-external_acl" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/30/solution-of-linuxqq-die-on-ubuntu-9-10" title="ubuntu 9.10下linuxqq经常挂掉的解决方案" rel="bookmark">ubuntu 9.10下linuxqq经常挂掉的解决方案</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-30 00:00:00 +0800">30 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>ubuntu 9.10下linuxqq（官方的QQ，八百年不更新的那个了）</p>
<p>sudo vim /usr/bin/qq
增加</p>
<div class="highlight"><pre><code class="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">GDK_NATIVE_WINDOWS</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">cd</span> /usr/share/tencent/qq/
./qq
</code></pre></div>
<p>经试验正确无误。。。linuxqq不再挂。。。五四陈科学院小道报道</p>
<p>原创文章如转载，请注明：转载自五四陈科学院[<a href="http://www.54chen.com%5D/">http://www.54chen.com]</a>
本文链接: 
<a href="http://www.54chen.com/uncategorized/ubuntu-910-hangs-under-linuxqq-regular-solution.html">http://www.54chen.com/uncategorized/ubuntu-910-hangs-under-linuxqq-regular-solution.html</a></p>
</body></html>
      <a href="/2010/01/30/solution-of-linuxqq-die-on-ubuntu-9-10" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/30/limit-speed-in-nginx-lighttpd" title="限速进阶" rel="bookmark">限速进阶</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-30 00:00:00 +0800">30 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>继续横向比较，之前有squid的限速配置，现在说nginx限速，nginx关于限速的模块有三个：HTTPLimitZoneModule、HTTPCoreModule和HTTPLimitReqModule，详见官方wiki，就不再贴链接了，能不能上天知道，真是地上芙蓉姐，天上绿坝娘呀……</p>
<h1 id="limitzone">limit_zone配置</h1>
<div class="highlight"><pre><code class="nginx"><span class="k">http</span> <span class="p">{</span>
    <span class="kn">limit_zone</span> <span class="no">on</span><span class="s">e</span> <span class="nv">$binary_remote_addr</span> <span class="mi">10m</span><span class="p">;</span> <span class="c1">#每个clientIP定义一个10m大的session容器，根据32bytes/session，可以处理320000个session；</span>
    <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">location</span> <span class="s">/download/</span> <span class="p">{</span>
            <span class="kn">limit_conn</span> <span class="no">on</span><span class="s">e</span> <span class="mi">1</span><span class="p">;</span><span class="c1">#限制一个IP并发连接数为1；...</span></code></pre></div>
</body></html>
      <a href="/2010/01/30/limit-speed-in-nginx-lighttpd" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/30/anti-hotlinking-in-nginx-lighttpd-squid" title="防盗链进阶（nginx、lighttpd和squid类比）" rel="bookmark">防盗链进阶（nginx、lighttpd和squid类比）</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-30 00:00:00 +0800">30 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在折腾squid的rewrite.pl时，参考的是公司原有的一个防盗链脚本。如下：</p>
<div class="highlight"><pre><code class="perl"><span class="c1">#! /usr/bin/env perl</span>
<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Digest::</span><span class="n">MD5</span> <span class="sx">qw(md5_hex)</span><span class="p">;</span>
<span class="k">use</span> <span class="n">POSIX</span> <span class="sx">qw(difftime mktime)</span><span class="p">;</span>
<span class="vg">$|</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$errUrl</span> <span class="o">=</span> <span class="s">"http://www.test.com/no_such_url.html"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$secret</span> <span class="o">=</span> <span class="s">"123456"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$expired</span> <span class="o">=</span> <span class="mi">7200</span><span class="p">;</span>
<span class="k">while</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="nv">$client</span><span class="p">,</span> <span class="nv">$ident</span><span class="p">,</span> <span class="nv">$method</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">"$errUrln"</span> <span class="ow">and</span> <span class="k">next</span> <span class="k">unless</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">=~</span> <span class="n">m</span><span class="c1">#^(http://w*.?test.com)/(d{4})(d{2})(d{2})(d{2})(d{2})/(w{32})(/.+.mp3)$#i)...</span></code></pre></div>
</body></html>
      <a href="/2010/01/30/anti-hotlinking-in-nginx-lighttpd-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/29/intro-cronolog-logrotate" title="日志管理" rel="bookmark">日志管理</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-29 00:00:00 +0800">29 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>第一个，最常见的cronolog，因为他配对apache，apache太常见，所以cronolog也就常见了~~稳定版本1.6.2，似乎不支持2G以上的日志，因为那时候linux内核也不支持。。。现在有beta版可以，另据网友分析，其实只要修改1.6.2源代码中的openfile函数成openfile64就行了……
使用方法：</p>
<pre><code>CustomLog "|/usr/local/sbin/cronolog /var/log/httpd/www/access%Y%m%d.log" combined
</code></pre>
<p>其实就是利用管道，传递给cronolog记录日志。
对于不支持在配置文件里利用管道的，也有别的变通办法，比如命名管道。像nginx日志就能这么做：</p>
<p>mkfifo /path/to/nginx/logs/access_log_pipe
/path/to/cronolog /path/to/log/access_%Y%m%d.log /path/to/nginx/...</p>
</body></html>
      <a href="/2010/01/29/intro-cronolog-logrotate" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/28/transparent-by-ports" title="端口转发" rel="bookmark">端口转发</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-28 00:00:00 +0800">28 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>常见的linux端口转发，是iptables方式，方法如下：</p>
<div class="highlight"><pre><code class="bash"><span class="c">#modprobe iptable_nat</span>
<span class="c">#modprobe ip_conntrack</span>
<span class="c">#service iptables stop</span>
<span class="c">#echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span>
<span class="c">#iptables -t nat -I PREROUTING -p tcp --dport 443 -j DNAT --to 1.2.3.4</span>
<span class="c">#iptables -t nat -I POSTROUTING -p tcp --dport 8081 -j MASQUERADE</span>
<span class="c">#service iptables save</span>
<span class="c">#service iptables start</span>
</code></pre></div>
<p>其次网上有不少推荐rinetd，方法如下：</p>
<div class="highlight"><pre><code class="bash"><span class="c">#wget http://www.boutell.com/rinetd/http/rinetd.tar.gz...</span></code></pre></div>
</body></html>
      <a href="/2010/01/28/transparent-by-ports" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/27/test-location-in-squid" title="squid页面跳转试验" rel="bookmark">squid页面跳转试验</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-27 00:00:00 +0800">27 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>某客户页面跳转试验记录</p>
<h2 id="section">一、客户需求</h2>
<p>某客户加速域名下某路径http://www.test.com/zhlc/不想让网民直接访问，希望当有直接访问该路径的请求时，都跳转到search.test.com域名下相应的路径去。</p>
<h2 id="section-1">二、解决思路</h2>
<p>a) 客户源站增添rewrite配置进行处理，将该类请求url改写成所期望的url；
b) Squid端对请求进行处理，将该类请求url改写成所期望的url。
根据售前沟通结果，这个处理步骤交由squid完成。</p>
<h2 id="squidrequest">三、Squid对request的处理流程（略，见前博文）</h2>
<h2 id="section-2">四、两种跳转方法的介绍与比较</h2>
<p>针对跳转需求，提供两个两种方法：
a) Squid支持调用外部程序脚本改写url，即redirect_program（2.6以上版本为url_rewrite_program）。所有的url请求，在squid处理流程的第三步，都会检查rewrite_program，然后将改写后的结果推入流程继续进行（为了提高运行速度，降低服务器负载，可以采用url_rewrite_access控制请求和redirector_bypass在繁忙时进行透传）。
根据《squid中文权威指南》11章的介绍，squid传递给redirect_proram的流格式为：
URL IP/FQDN IDENT METHOD
Rewrite处理时，也就是对这四个字段进行处理，一般地说，也就处理第一个字段——$url。
《squid中文权威指南》中提供了标准的perl脚本，演示了处...</p>
</body></html>
      <a href="/2010/01/27/test-location-in-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/24/shell-script-for-train-setting" title="CUshell版惊见中国特色脚本" rel="bookmark">CUshell版惊见中国特色脚本</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-24 00:00:00 +0800">24 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>58同城：</p>
<div class="highlight"><pre><code class="bash"><span class="c">#!/bin/bash</span>
<span class="c">#该脚本仅用于58同城网站刷票</span>
<span class="c">#到达目的地</span>
<span class="nv">DES</span><span class="o">=</span><span class="s2">"(天水|兰州|西安)"</span>
<span class="c">#刷票url</span>
<span class="nv">URL</span><span class="o">=</span>http://bj.58.com/huochepiao/a1/
<span class="nv">OLDMD5</span><span class="o">=</span><span class="sb">`</span>curl <span class="nv">$URL</span> | egrep <span class="s2">"$DES"</span> | sed <span class="s1">'$d'</span> | md5sum | awk <span class="s1">'{print $1}'</span><span class="sb">`</span>
<span class="k">while </span><span class="nb">true</span>; <span class="k">do</span>
<span class="k">    if</span> <span class="o">[</span> <span class="s2">"$OLDMD5"</span> <span class="o">==</span> <span class="sb">`</span>curl <span class="nv">$URL</span> | egrep <span class="s2">"$DES"</span> | sed <span class="s1">'$d'</span> | md5sum | awk <span class="s1">'{print $1}'</span><span class="sb">`</span> <span class="o">]</span>;<span class="k">then</span>
<span class="k">        </span>sleep 300
    <span class="k">else</span>
<span class="k">        </span><span class="nv">MESSAGE</span><span class="o">=</span><span class="sb">`</span>curl <span class="nv">$URL</span> | egrep <span class="s2">"$DES...</span></code></pre></div>
</body></html>
      <a href="/2010/01/24/shell-script-for-train-setting" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/23/automate-configure-squid-in-website" title="squid自动配置web化" rel="bookmark">squid自动配置web化</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-23 00:00:00 +0800">23 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>[root@test data]# cat index.htm</p>
<div class="highlight"><pre><code class="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>饶琛琳专用21V-CDN流程系统<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
<span class="nc">.style1</span> <span class="p">{</span>
<span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;center&gt;</span>
<span class="nt">&lt;h1&gt;</span>Designed for support@21vianet.com in RT table.<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="err"> </span> <span class="na">action=</span><span class="s">"/cgi-bin/rt.cgi"</span><span class="nt">&gt;</span>
<span class="nt">&lt;table&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"config"</span> <span class="na">style=</span><span class="s">"width: 700px; hei...</span></code></pre></div>
</body></html>
      <a href="/2010/01/23/automate-configure-squid-in-website" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/19/sysctl-about-tcp" title="系统优化——TCP参数" rel="bookmark">系统优化——TCP参数</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-19 00:00:00 +0800">19 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>tcp_syn_retries ：INTEGER
默认值是5
对于一个新建连接，内核要发送多少个 SYN 连接请求才决定放弃。不应该大于255，默认值是5，对应于180秒左右时间。(对于大负载而物理通信良好的网络而言,这个值偏高,可修改为2.这个值仅仅是针对对外的连接,对进来的连接,是由tcp_retries1决定的)</p>
<p>tcp_synack_retries ：IN...</p>
</body></html>
      <a href="/2010/01/19/sysctl-about-tcp" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/13/refresh-cache-of-interrogation-url" title="squid刷新缓存" rel="bookmark">squid刷新缓存</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-13 00:00:00 +0800">13 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>这篇博文的起因是最近犯的一个低级错误。某客户要求立刻刷新掉一批url。格式是http://a.b.com/index.jsp?pid=123456&amp;id=654321这样的。
我也没多想，上去就执行“squidclient -p 80  -m purge
http://a.b.com/index.jsp?pid=123456&amp;id=654321”。结果硬是刷不掉……明明访问源...</p></body></html>
      <a href="/2010/01/13/refresh-cache-of-interrogation-url" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/13/refresh-cache-by-php" title="刷新squid缓存的php脚本" rel="bookmark">刷新squid缓存的php脚本</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-13 00:00:00 +0800">13 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Flush_Cache</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">Flush_Cache_HTTP_Header_Impl</span> <span class="k">implements</span> <span class="nx">Flush_Cache</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$url</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$url_component</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
        <span class="k">global</span> <span class="nv">$g_squid_servers</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$g_squid_servers</span> <span class="k">as</span> <span class="nv">$server</span><span class="p">)</span>
       ...</code></pre></div></body></html>
      <a href="/2010/01/13/refresh-cache-by-php" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/01/10/zz-intro-acls-in-squid" title="Squid的ACL分类" rel="bookmark">Squid的ACL分类</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-10 00:00:00 +0800">10 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在找http_status的acl用法时，看到这么一句“This clause supports both fast and slow acl types”。acl还分快慢呢~~赶紧去wiki看：<a href="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs</a></p>
<pre><code>Some ACL types require information which may not
be already available to Squid. Checking them requires suspending
work on the current request, querying some external source, and
resuming work when the needed information becomes available. This
is for example the case for DNS, authenticators or external
authorization scripts. ACLs can thus be divided in
FAST ACLs, which do not require going to external
sources to be fulfilled, and SLOW ACLs, which do.
Fast ACLs include (as of squid 3.1.0.7):
all (built-in)
src
dstdomain
dstdom_regex
myip
arp
src_as
peername
time
url_regex
urlpath_regex
port
myport
myportname
proto
method
http_status {R}
browser
referer_regex
snmp_community
maxconn
max_user_ip
req_mime_type
req_header
rep_mime_type {R}
user_cert
ca_cert
Slow ACLs include:
dst
dst_as
srcdomain
srcdom_regex
ident
ident_regex
proxy_auth
proxy_auth_regex
external
ext_user
ext_user_regex
This list may be incomplete or out-of-date. See
your squid.conf.documented file for details. ACL types
marked with {R} are reply ACLs, see the dedicated FAQ
chapter.
Squid caches the results of ACL lookups whenever
possible, thus slow ACLs will not always need to go to the external
data-source.
Knowing the behaviour of an ACL type is relevant
because not all ACL matching directives support all kinds of ACLs.
Some check-points will not suspend the request:
they allow (or deny) immediately. If a SLOW acl has to be checked,
and the r...</code></pre>
</body></html>
      <a href="/2010/01/10/zz-intro-acls-in-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
    <li>
      <a href="/page11">Previous</a>
    </li>
    <li class="page">
      <a href="/">1</a>
    </li>
    <li class="page">
      <a href="/page2">2</a>
    </li>
    <li class="page">
      <a href="/page3">3</a>
    </li>
    <li class="page">
      <a href="/page4">4</a>
    </li>
    <li class="page">
      <a href="/page5">5</a>
    </li>
    <li class="page">
      <a href="/page6">6</a>
    </li>
    <li class="page">
      <a href="/page7">7</a>
    </li>
    <li class="page">
      <a href="/page8">8</a>
    </li>
    <li class="page">
      <a href="/page9">9</a>
    </li>
    <li class="page">
      <a href="/page10">10</a>
    </li>
    <li class="page">
      <a href="/page11">11</a>
    </li>
    <li class="page active">
      <a href="#">12</a>
    </li>
    <li class="page">
      <a href="/page13">13</a>
    </li>
    <li class="page">
      <a href="/page14">14</a>
    </li>
    <li class="page">
      <a href="/page15">15</a>
    </li>
    <li>
      <a href="/page13">Next</a>
    </li>
  </ul>
</div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <!--以下是QQ邮件列表订阅嵌入代码-->
            <script >var nId = "86cca8e03c1002936e00aaa28bd933c15c4a437a5e63cafd",nWidth="auto",sColor="light",sText="填写您的邮件地址，订阅logstash/ElasticSearch相关讨论：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
    <!-- JiaThis Button BEGIN -->
    <script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1589850" charset="utf-8"></script>
    <!-- JiaThis Button END -->
    <!-- UJian Button BEGIN -->
    <script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&uid=1589850"></script>
    <!-- UJian Button END -->
  </body>
</html>
