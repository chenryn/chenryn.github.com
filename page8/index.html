<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">Archive</a></li>
      	<li><a href="/categories.html">Categories</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/tags.html">Tags</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://feed.feedsky.com/chenlinux" rel="alternate" /><a href="http://feed.feedsky.com/chenlinux" target="_blank">RSS订阅</a></li>
            <li><a href="/links.html">友情链接</a></li>
            <li><a href="/projects.html">学习记录</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/27/problem-about-vrrp-and-intro-flood-ping" title="集群故障检查记录" rel="bookmark">集群故障检查记录</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-27 00:00:00 +0800">27 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>某服务器集群，是双lvs_keepalived+多nginx结构。最近突然发现流量监控出现较大波动，nginx的access.log时常出现持续几十秒的无外来访问情况（即只有LVS的ip过来的400探测）。</p>
<p>在两台lvs设备上的/var/log/messages上都看到大量的VIP切换记录：</p>
<p>Oct 22 09:47:12 localhost Keepalived_vrrp: VRRP_Instance(VI<em>10) Transition to MASTER STATE
Oct 22 09:47:13 localhost Keepalived_vrrp: VRRP_Instance(VI</em>10) Entering MASTER STATE
Oct 22 09:47:13 localhost Keepalived...</p>
</body></html>
      <a href="/2010/10/27/problem-about-vrrp-and-intro-flood-ping" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/27/intro-myisamchk" title="Myisamchk小工具使用手册(转)" rel="bookmark">Myisamchk小工具使用手册(转)</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-27 00:00:00 +0800">27 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#database-ref" title="database" rel="category tag">database</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>前不久碰上mysql的表损坏，百度到这篇文章，现在转载过来，原文出处：<a href="http://logzgh.itpub.net/post/3185/454455">http://logzgh.itpub.net/post/3185/454455</a></p>
<p>Myisamchk是MyISAM表维护的一个非常实用的工具。可以使用myisamchk实用程序来获得有关数据库表的信息或检查、修复、优化他们。myisamchk适用MyISAM表(对应.MYI和.MYD文件的表)。
1.myisamchk的调用方法
myisamchk [options] tbl_name …
其中options指定你想让myisamchk干什么。</p>
<p>它允许你通过使用模式“*.MYI”指定在一个目录所有的表。
shell&gt; myisamchk *.MYI</p>
<p>推荐的快速检查所有MyISAM表的方式是：</p>
<p>shell&gt; myisamchk –silent –fast /path/to...</p>
</body></html>
      <a href="/2010/10/27/intro-myisamchk" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/21/translation-of-mysql-error-log" title="mysql错误日志中文翻译" rel="bookmark">mysql错误日志中文翻译</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-21 00:00:00 +0800">21 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#database-ref" title="database" rel="category tag">database</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>1005：创建表失败</p>
<p>1006：创建数据库失败</p>
<p>1007：数据库已存在，创建数据库失败</p>
<p>1008：数据库不存在，删除数据库失败</p>
<p>1009：不能删除数据库文件导致删除数据库失败</p>
<p>1010：不能删除数据目录导致删除数据库失败</p>
<p>1011：删除数据库文件失败</p>
<p>1012：不能读取系统表中的记录</p>
<p>1016: 无法打开文件</p>
<p>1020：记录已被其他用户修改</p>
<p>1021：硬盘剩余空间不足，请加大硬盘可用空间</p>
<p>1022：关键字重复，更改记录失败</p>
<p>1023：关闭时发生错误</p>
<p>1024：读文件错误</p>
<p>1025：更改名字时发生错误</p>
<p>1026：写文件错误</p>
<p>1032：记录不存在</p>
<p>1036：数据表是只读的，不能对它进行修改</p>
<p>1037：系统内存不足，请重启数据库或重启服务器</p>
<p>1038：用于排序的内存不足，请...</p>
</body></html>
      <a href="/2010/10/21/translation-of-mysql-error-log" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/21/auto-refresh-of-pnp4nagios" title="页面自动刷新小问题" rel="bookmark">页面自动刷新小问题</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-21 00:00:00 +0800">21 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>cacti的页面，每5分钟自动刷新一次，这样就可以“实时”的看到rrd绘图的最新结果。</p>
<p>nagios加上pnp插件后，也有rrd绘图的页面，但却没有自动刷新。</p>
<p>查看pnp/config.cfg，里面已经配置了$conf[‘refresh’] = “90”;但页面没有反应。</p>
<p>于是分别查看cacti和pnp的页面源代码，cacti的如下：</p>
<p>&lt;meta http-equiv=refresh content=’300’&gt;</p>
<p>pnp的如下：</p>
<meta http-equiv="refresh" content="90; URL=***">
<p>看来时这个META标签写法不对，修改nagios/share/pnp/include/funcation.inc.php如下：</p>
<ul><li>
    <p>print “&lt;meta http-equiv="refresh" content="” . $conf[‘r...</p>
</li></ul>
</body></html>
      <a href="/2010/10/21/auto-refresh-of-pnp4nagios" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/20/solution-of-tcp_overflow" title="tcp overflow报错" rel="bookmark">tcp overflow报错</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-20 00:00:00 +0800">20 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在对TCP参数进行sysctl优化时，通常会减小net.ipv4.tcp_max_tw_buckets这个设置，以减少服务器的TIME_WAIT数量，提高服务器响应速度。</p>
<p>不过对于squid服务器来说，这个优化没什么作用，而且在/var/log/messages和dmesg中大屏大屏的出现如下kernel报错。很是烦人……
printk: 7277 messages suppressed.
TCP: time wait bucket table overflow</p>
<p>更深一步，如果去linux内核代码中搜索的话，可以发现如下：</p>
<p>struct inet_timewait_sock *tw = NULL;
const struct inet_connection_sock *...</p>
</body></html>
      <a href="/2010/10/20/solution-of-tcp_overflow" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/19/intro-nagiostats" title="nagios性能监控" rel="bookmark">nagios性能监控</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-19 00:00:00 +0800">19 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>nagios自带有性能监控工具nagiostats，安装在nagios路径的bin/下。直接运行即可看到主机、服务的检测频率，故障数量及比例等。举例如下：</p>
<p>Nagios Stats 3.0.3
Copyright (c) 2003-2008 Ethan Galstad (www.nagios.org)
Last Modified: 06-25-2008
License: GPL</p>
<h2 id="current-status-data">CURRENT STATUS DATA</h2>
<p>Status File:                       ...</p>
</body></html>
      <a href="/2010/10/19/intro-nagiostats" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/13/a-problem-of-php-compiling" title="php编译小问题" rel="bookmark">php编译小问题</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-13 00:00:00 +0800">13 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#php-ref" title="php" rel="category tag">php</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>昨天应用调整，尝试将服务器上的php降级，从5.3.0降到5.2.10，在编译时爆出如下错误提示：</p>
<p>./.libs/libgd.so: undefined reference to `png_check_sig’
collect2: ld returned 1 exit status</p>
<p>因为之前有过安装，所以可以确认libpng是已经存在的。百度后看到如下说法：</p>
<p>libpng-1.4.0源码中的libpng-1.4.0.txt有说明,已经取消了png_check_sig这个函数,改用png_sig_cmp代替.自从libpng-0.90就已经反对使用png_check_sig函数了</p>
<p>所以修改php源码中的ext/gd/libgd/gd_png.c如下：</p>
<ul><li>  if (!png_check_sig (sig, 8)) { /* bad...</li></ul>
</body></html>
      <a href="/2010/10/13/a-problem-of-php-compiling" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/09/change-time-zone-of-linux" title="linux更改时区" rel="bookmark">linux更改时区</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-09 00:00:00 +0800">09 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>linux上的时间，一般用定时ntpdate或者守护ntpd服务来保持正确。不过有时候会发现系统时间显示不是我们熟悉的CST，而是莫名其妙的其他地方。比如EDT什么的，ntpdate的时候，可不会自己辨别时区的~~
那么就要自己手动更改了。
办法很多，第一：...</p></body></html>
      <a href="/2010/10/09/change-time-zone-of-linux" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/10/06/a-question-of-google" title="google校招笔试题" rel="bookmark">google校招笔试题</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-10-06 00:00:00 +0800">06 Oct 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>刚在CU看到传说中的一道google2011年校招笔试题，如下：</p>
<p>现在北京有一套房子，价格200万，假设房价每年上涨 10%，一个软件工程师每年固定能赚40万。如果他想买这套房子，不贷 款，不涨工资，没有其他收入，每年不吃不喝不消费，那么他需要几年才能攒够钱买这套房子？
A, 5年
B, 7年
C, 8年
D, 9年
E, 永远买不起</p>
<p>最简单的思路，算算每年的房价和攒下的工资总数，最多到房价超过400万的时候就不用算了，因为那时候10%就大于工资了……</p>
<h1 id="binbash">!/bin/bash</h1>
<p>fangzi=200
gongzi=40
while true
do
fangzi_new=<code>echo $fangzi|awk '{print $1*1.1}'</code>
gongzi_new=<code>echo $gongzi|awk '...</code></p>
</body></html>
      <a href="/2010/10/06/a-question-of-google" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/09/26/perlbal" title="perlbal" rel="bookmark">perlbal</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-09-26 00:00:00 +0800">26 Sep 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>看mogileFS，其中用到了perlbal，这是一个用perl完成的超轻量级服务器程序。包括了web、proxy、loadbalance等功能，嗯，看起来和nginx很像。
又想到曾经在CU上看到一个说法，用解释性脚本语言编写的服务器程序执行相应的网页，效率最高。
我就会凑点perl，下perlbal来体验一把吧~~</p>
<p>发挥一下perl的优势，直接采用CPAN安装。（从扶凯那学来cpanm方式，确实方便）</p>
<div class="highlight"><pre><code class="bash">wget http://xrl.us/cpanm -O /sbin/cpanm
chmod +x !<span class="err">$</span>
!<span class="nv">$ </span>Perlbal
perlbal --help
Usage: perlbal <span class="o">[</span>OPTS<span class="o">]</span>
--help           This usage info
--version    ...</code></pre></div>
</body></html>
      <a href="/2010/09/26/perlbal" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/09/26/configure-transfer-to-peer-in-squid" title="squid回源选择配置小结" rel="bookmark">squid回源选择配置小结</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-09-26 00:00:00 +0800">26 Sep 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>一共关系到cache_peer/always_direct/never_direct/hierarchy_stoplist/prefer_direct等配置项。</p>
<p>squid的<a href="http://www.deckle.co.za/squid-users-guide/Cache_Hierarchies#The_always_direct_and_never_direct_tags" target="_blank">使用指南</a>上，关于always_direct和never_direct这么写到：</p>
<p>Squid checks all <em>always_direct</em> tags before it checks any <em>never_direct</em> tags. If a matching <em>always_direct</em> tag is found, Squid will not check the <em>never_direct</em> tags, but de...</p>
</body></html>
      <a href="/2010/09/26/configure-transfer-to-peer-in-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/09/17/conditional-command-details" title="条件判断命令小细节" rel="bookmark">条件判断命令小细节</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-09-17 00:00:00 +0800">17 Sep 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>服务器上有个定时任务，执行结果输出到out.txt中以便查看，类似下行这样的：</p>
<p>*/5 * * * * /shell/runscript.sh » /shell/out.txt</p>
<p>runscript.sh中执行script.sh，完成后删除。</p>
<p>/shell目录下的所有文件不定期的通过rsync –delete同步过去。
结果发现如果script在5分钟内无法执行完毕的话，cro...</p>
</body></html>
      <a href="/2010/09/17/conditional-command-details" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/09/14/intro-snmp-config-and-oids-of-squid" title="squid的snmp配置和部分oid说明" rel="bookmark">squid的snmp配置和部分oid说明</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-09-14 00:00:00 +0800">14 Sep 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>首先配置squid.conf如下：</p>
<div class="highlight"><pre><code class="squid"><span class="k">acl</span><span class="w"> </span>MonitorCenter<span class="w"> </span><span class="k">src</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="w"></span>
<span class="k">acl</span><span class="w"> </span>snmppublic<span class="w"> </span><span class="k">snmp_community</span><span class="w"> </span>public<span class="w"></span>
<span class="k">snmp_access</span><span class="w"> </span><span class="no">allow</span><span class="w"> </span>snmppublic<span class="w"> </span>MonitorCenter<span class="w"></span>
<span class="k">snmp_access</span><span class="w"> </span><span class="no">deny</span><span class="w"> </span><span class="no">all</span><span class="w"></span>
</code></pre></div>
<p>然后配置snmpd.conf如下：</p>
<pre><code>com2sec notConfigUser  def...</code></pre>
</body></html>
      <a href="/2010/09/14/intro-snmp-config-and-oids-of-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/09/14/an-oid-error-of-snmpwalk" title="snmpwalk的报错一例" rel="bookmark">snmpwalk的报错一例</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-09-14 00:00:00 +0800">14 Sep 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在给squid配置了snmp后，用snmpwalk采集数据，总览一下：</p>
<p>snmpwalk 192.168.0.2 -v 2c -c public 1.3.6.1.4.1.3495</p>
<p>刷到最后爆出错误：</p>
<pre><code>SNMPv2-SMI::enterprises.3495.1.5.2.1.1.218.28.141.150 = I...</code></pre>
</body></html>
      <a href="/2010/09/14/an-oid-error-of-snmpwalk" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/25/string-operator-on-bsd" title="BSD下的字符串运算" rel="bookmark">BSD下的字符串运算</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-25 00:00:00 +0800">25 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>之前在linux上有个脚本，通过expr命令截取字符串的。大意如下：
    a=/path/to/example
    b=<code>expr length "$a  "</code>
    c=/path/to/example/file/to/example
    d=<code>expr length "$c"</code>
    e=<code>expr substr "$c" "$b" "$d"</code>
转移到BSD后，脚本报...</p></body></html>
      <a href="/2010/08/25/string-operator-on-bsd" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/24/received-a-mail-from-jwplayer" title="收到jwplayer的推广邮件" rel="bookmark">收到jwplayer的推广邮件</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-24 00:00:00 +0800">24 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>在做CDN的时候，曾经有一个客户加速视频播放，所以去注册下载了JWPlayer尝尝鲜。
转眼几个月了，今天突然收到一封信，《Introducing Open Video Ads》，原来是JWPlayer的开发者，新出的基于GPL3的一个开源插件，可以在jwplayer和flowplayer播放正式视频前，插播一段自定义广告~~
记得离职前还有同事专门在研究如何在播放rtmp流时切换插播广告，不知道现在搞定没。
不过，这还是我第一次收到开源软件开发者推广自己软件的邮件。。。</p></body></html>
      <a href="/2010/08/24/received-a-mail-from-jwplayer" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/24/intro-pmap" title="pmap命令" rel="bookmark">pmap命令</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-24 00:00:00 +0800">24 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>继pgrep之后，又发现一个pmap命令，有些不错的小作用~
比方说，用pgrep java得出pid后，用pmap $pid，得出输出结果如下：</p>
<pre><code>23792:   /usr/java/jdk1.5.0_14/bin/java -Djava.util.logging.manager=com.caucho.log.LogManagerImpl -Djava.system.class.loader=com.caucho.loader.SystemClassLoader -Djavax.management.builder.initial=com.caucho.jmx.MBeanServerBuilderImpl -Djava.awt.headless=true -Dresin.home=/usr/local/resin3.1.8-rtuku/ -Xmx256m -Xss1m -Xdebug -Dcom.sun.management.jmxremote -Djava.util.logging.manager=com.caucho.log.LogManagerImpl -Djavax.management.builder.initial=com.caucho.jmx.MBeanServerBuilderImpl -Djava.awt.headless=true -Dresin.
0028f000     72K r-x--  /lib/libnsl-2.3.4.so
002a1000      8K rwx--  /lib/libnsl-2.3.4.so
002a3000      8K rwx--    [ anon ]
0031c000     84K r-x--  /lib/ld-2.3.4.so
00331000      4K r-x--  /lib/ld-2.3.4.so
00332000      4K rwx--  /lib/ld-2.3.4.so
0033a000   1172K r-x--  /lib/tls/libc-2.3.4.so
0045f000      4K r-x--  /lib/tls/libc-2.3.4.so
00460000     12K rwx--  /lib/tls/libc-2.3.4.so
0046...</code></pre>
</body></html>
      <a href="/2010/08/24/intro-pmap" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/24/inotifypurge_cache" title="inotify+purge_cache" rel="bookmark">inotify+purge_cache</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-24 00:00:00 +0800">24 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>linux内核从2.6.13开始，加入了inotify特性。对目录、文件的各种修改，都会发出inotify信号。包括
    IN_ACCESS
    IN_MODIFY
    IN_ATTRIB
    IN_CLOSE_WRITE
    IN_CLOSE_NOWRITE
    IN_OPEN
    IN_MOVED_FROM
    IN_MOVED_TO
    IN_CREATE
    IN_DELETE
    IN_DELETE_SELF
    IN_MOVE_SELF
    IN_UNMOUNT
    IN_CLOSE
    IN_MOVE
目前最常见的inotify应用，就是和rsync配合进行实时同步。
而对web发布路径进行inotify监听的话，可以实时PURGE掉前端cache，保证网民访问的实效性。内容更新周期不固定的一些网站，大可以设定长一些的expires（也不要太长，不然浏览器端本身的缓存影响比较大），然后通过inotify监听来强制控制缓存时间，应该是比较有效果的。
最早的思路，先用perl的Linux::Inotify模块watch目录，read出每次event的name；再用IO::Socket模块向squid发送”PURGE $url HTTP/1.0\n\n”请求，最后用WWW::Curl::Form模块POST数据到CDN的刷新接口。洋洋洒洒好几十行后，发现利用inotify-tools、curl、squidclient等现成的工具，写成的shell脚本更加简单而且方便。
先修改squid.conf，添加web服务器ip的purge权限，重...</p></body></html>
      <a href="/2010/08/24/inotifypurge_cache" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/13/intro-pnp4nagios" title="nagios绘图" rel="bookmark">nagios绘图</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-13 00:00:00 +0800">13 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>nagios默认command中，有个未开启的process_performance_data。可以开启它来保存数据，然后提供给rrdtools绘图。</p>
<p>下载pnp插件包，官网是<a href="http://www.pnp4nagios.org/">http://www.pnp4nagios.org</a>，和cacti一样，保证有lamp、rrdtool（低版本的还要GD），然后和其他插件一样./configure &amp;&amp; make &amp;&amp; make all &amp;&amp; make install &amp;&amp; make install-config &amp;&amp; make install-init就行了。
然后修改nagios.cfg如下：</p>
<p>process_performance_data=1
service_perfdata_command=proce...</p>
</body></html>
      <a href="/2010/08/13/intro-pnp4nagios" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/13/intro-gnuplot" title="gnuplot画图" rel="bookmark">gnuplot画图</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-13 00:00:00 +0800">13 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>之前提高日志流量统计的问题。并给出了分时流量的计算方法。当...</p></body></html>
      <a href="/2010/08/13/intro-gnuplot" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/13/intro-bc-command" title="bc命令及其他" rel="bookmark">bc命令及其他</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-13 00:00:00 +0800">13 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在写check_if_flow.sh的时候，因为要比较的值太多，几个网卡，每个都分进出、然后分w和c。如果直接if判断大小，会写的无比庞大……于是想到根据比较结果先输出一个变量，大就是1，小就是0，类似这种。</p>
<p>于是找到了bc命令，最终结果如下：</p>
<p>[root@test ~]# echo “1.13 &gt; 1.2”|bc
0
[root@test ~]# echo “1.13 &lt; 1.2”|bc
1
bc支持+-*/%^=!&gt;&lt;各种运算，还能通过scale指定小数点后几位；
还能任意转换数字的进制，如下：</p>
<p>[root@test ~]# echo ‘obase=10; ibase=16; 1E79’ | bc
7801</p>
<p>相比之前脚本里用的awk要灵活（就是必须大写...</p>
</body></html>
      <a href="/2010/08/13/intro-bc-command" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/05/traffic-monitor" title="流量监控" rel="bookmark">流量监控</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-05 00:00:00 +0800">05 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body><p>流量监控，一般看cacti上的绘图。近日打算设置报警，懒得给cacti加模块，自己写个脚本吧，于是开始研究这个流量监控的方式。
先是在网上看到一个nagios的check_traffic.sh脚本，核心就是用snmpwalk取网卡总流量，写在/tmp/某个文件下，下次nrpe启动check时，再去新的总流量，减去文件中读取出来的值，除以启动间隔时间，就是平均流量值。
用snmpwalk -v 2c -c public localhost IF-MIB::ifInOctets取出值来一看，发现和ifconifg出来的RX数值是一样的！
然后有张宴的net.sh脚本...</p></body></html>
      <a href="/2010/08/05/traffic-monitor" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/04/concat" title="concat" rel="bookmark">concat</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-04 00:00:00 +0800">04 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>今天逛到淘宝核心系统组的公开博客，然后知道了淘宝开源平台<a href="http://code.taobao.org/">http://code.taobao.org/</a>，刚出来的东东，上面开源了淘宝目前正在使用的key-value分布式存储tair和nginx的concet模块、Cookie模块，以及这个平台本身的代码……在回复中，淘宝的人说有关tair的update都会同步在这个平台上进行，而不是另起一个闭源分支，或者想新浪的sina-sdd那样放弃。据说九月份，淘宝还会放出它的分布式文件系统TFS来，毕竟时间不长，会不会“人亡政息”，有待考验……</p>
<p>不过我对这个concet模块有点兴趣，从其英文介绍（淘宝真是...</p>
</body></html>
      <a href="/2010/08/04/concat" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/03/squid2-6-bug-about-if_none_match" title="squid2.6的bug（if-none-match）" rel="bookmark">squid2.6的bug（if-none-match）</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-03 00:00:00 +0800">03 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>话接上篇。
在发现经过squid的刷新请求头不带If-None-Match后，向squid-user发邮件询问。Amos回复如下：</p>
<p>On Mon, 02 Aug 2010 07:56:09 +0800, Gemmy <a href="mailto:chenryn@163.com"><span style="text-decoration:underline;"><span style="color:#0000ff;"><a href="mailto:chenryn@163.com">chenryn@163.com</a></span></span></a> wrote:
&lt;blockquote style="color:#000000;"&gt;
 Hi~
&gt; I have a nginx webserver adding the static-etags module and a
&gt; squid2.6.23 before the nginx. When I access to the nginx directly, I can
&gt; see the ETag in response header and If-None-Match in the request header
&gt; after refresh. But when I access to t...</p>
</body></html>
      <a href="/2010/08/03/squid2-6-bug-about-if_none_match" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2010/08/01/test-last_modified-etag-of-nginx" title="郁闷的last-modified和etag试验" rel="bookmark">郁闷的last-modified和etag试验</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-08-01 00:00:00 +0800">01 Aug 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#CDN-ref" title="CDN" rel="category tag">CDN</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>手上有一个伪静态的论坛bbs.example.com，每当有用户回复帖子的时候，提交到r.bbs.example.com，然后由r.bbs.example.com的提示页面replyautojump.jsp延迟3000后调用window.location.href函数返回原来的帖子——期间即完成对该帖的静态化。</p>
<p>为了实效性，之前的配置，将这类html都设定为no-cache。现在考虑到流量和IO的问题，计划希望能够将这类html尽可能的缓存在browser和proxy上，但每次都能采用304的方式，确认帖子的最新情况。对于不太热门的板块，不太热点的帖子，应该能缓存一段时间，减轻webserver的压力；就算是热门，哪怕几十秒钟的缓存，对于全网流量，也是积腋成裘。。。</p>
<p>因为论坛页面上，用SSI方式include了一些广告、点击排名等挂件。所以nginx上设定了ssi on，导致response-header中，没有了last-modified——按照常规，一般是在长期不变的html里include经常改变的shtml，而每次在解析SSI时去读取所有shtml的MTIME然后计算最后一个MTIME来设定成总页面的last-modified，是个比较繁琐且耗资源的做法（网上有lighttpd的patch，就是这么做的），所以包括nginx在内的多数webserver采取了比较简便的方法，即取消掉last-modified输出。参见nginx/src/http/module/ngx_http_ssi_filter_module...</p>
</body></html>
      <a href="/2010/08/01/test-last_modified-etag-of-nginx" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
    <li>
      <a href="/page7">Previous</a>
    </li>
    <li class="page">
      <a href="/">1</a>
    </li>
    <li class="page">
      <a href="/page2">2</a>
    </li>
    <li class="page">
      <a href="/page3">3</a>
    </li>
    <li class="page">
      <a href="/page4">4</a>
    </li>
    <li class="page">
      <a href="/page5">5</a>
    </li>
    <li class="page">
      <a href="/page6">6</a>
    </li>
    <li class="page">
      <a href="/page7">7</a>
    </li>
    <li class="page active">
      <a href="#">8</a>
    </li>
    <li class="page">
      <a href="/page9">9</a>
    </li>
    <li class="page">
      <a href="/page10">10</a>
    </li>
    <li class="page">
      <a href="/page11">11</a>
    </li>
    <li class="page">
      <a href="/page12">12</a>
    </li>
    <li class="page">
      <a href="/page13">13</a>
    </li>
    <li class="page">
      <a href="/page14">14</a>
    </li>
    <li>
      <a href="/page9">Next</a>
    </li>
  </ul>
</div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <!--以下是QQ邮件列表订阅嵌入代码-->
            <script >var nId = "86cca8e03c1002936e00aaa28bd933c15c4a437a5e63cafd",nWidth="auto",sColor="light",sText="填写您的邮件地址，订阅logstash/ElasticSearch相关讨论：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
    <!-- JiaThis Button BEGIN -->
    <script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1589850" charset="utf-8"></script>
    <!-- JiaThis Button END -->
    <!-- UJian Button BEGIN -->
    <script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&uid=1589850"></script>
    <!-- UJian Button END -->
  </body>
</html>
