<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">Archive</a></li>
      	<li><a href="/categories.html">Categories</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/tags.html">Tags</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
            <li><a href="/projects.html">学习记录</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/22/elasticsearch-amcharts-demo" title="用 Amcharts 和 ElasticSearch 做日志分析" rel="bookmark">用 Amcharts 和 ElasticSearch 做日志分析</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-22 00:00:00 +0800">22 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>之前有一篇从 ElasticSearch 官网摘下来的博客<a href="http://chenlinux.com/2012/11/18/data-visualization-with-elasticsearch-and-protovis">《【翻译】用ElasticSearch和Protovis实现数据可视化》</a>。不过一来 Protovis 已经过时，二来 不管是 Protovis 的进化品 D3 还是 Highchart 什么的，我觉得在多图方面都还不如 amcharts 好用。所以在最后依然选择了老牌的 amcharts 完成。</p>
<p>展示品的大概背景还是 webserver 日志，嗯，这个需求应该是最有代表性的了。我们需要对webserver的性能有所了解。之前有一篇文章<a href="http://chenlinux.com/2012/11/22/tatsumaki-demo/">《Tatsumaki框架的小demo一个》</a>，讲的是通过 <code>terms_stats</code> 获取固定时段内请求时间的平均值。其实这个demo是可以参照官网博客修改成纯js应用的。因为 Tatsumaki 在这里除了处理 HTT...</p>
</body></html>
      <a href="/2012/12/22/elasticsearch-amcharts-demo" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/21/dancer-plugin-auth-extensible" title="学习 Dancer::Plugin::Auth::Extensible 模块" rel="bookmark">学习 Dancer::Plugin::Auth::Extensible 模块</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-21 00:00:00 +0800">21 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#dancer-ref" title="dancer" rel="category tag">dancer</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>首先介绍一下 <code>Dancer::Plugin::Auth::Extensible</code> 模块。这是一个认证验证的框架，之前 Dancer 里这方面的框架是 RBAC ，不过 RBAC 是实现的 auth 对象，然后提供 <code>-&gt;asa</code>，<code>-&gt;can</code>，<code>-&gt;roles</code> 等方法。在使用的时候，需要自己在每个 route 里写 if 或者 switch 代码，显得比较繁琐。而 Extensible 模块提供了另一个（或者说是两个）思路。同时借此深入了解 <code>Dancer::Plugin</code> 和 <code>Dancer::Hook</code> 的用法，外加熟悉 perl 的一些不常见的对象使用。收获良多，不可不记。</p>
<p>上面之所以说算是两个思路。是因为在...</p>
</body></html>
      <a href="/2012/12/21/dancer-plugin-auth-extensible" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/19/dancer-and-text-xslate" title="Dancer 框架使用 Text::XSlate 模版的注意事项" rel="bookmark">Dancer 框架使用 Text::XSlate 模版的注意事项</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-19 00:00:00 +0800">19 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#dancer-ref" title="dancer" rel="category tag">dancer</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>Dancer 框架自带有一个 Simple 模版，不过推荐使用 <code>Template</code> 模块作为替代品。不过从性能上来说，TT2 比之前博客里陆续介绍过的 <code>HTML::Template</code> 和 <code>Text::MicroTemplate</code> 都要差。而这方面最好的，就是 <code>Text::XSlate</code> 模块了。今天尝试将一个 Dancer 应用迁移到 <code>Text::XSlate</code> 上。踩进两个坑，特此记录。</p>
<p>关于语法什么的，可以看 POD ，扶凯 有翻译的 中文版POD 。足以十分钟入门。就不多说了。</p>
<ul>
  <li>第一个坑：session 的处理</li>
</ul>
<p>website 少不了 session 的运用。在 template 里使用 <code>[% session.username %]</code> 可以很方便的控制显示面板还是登陆啊什么的。</p>
<p>不过切换成 XSlate 后（即 ...</p>
</body></html>
      <a href="/2012/12/19/dancer-and-text-xslate" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/16/how-to-set-host-header-in-perl" title="perl发起HTTP请求时如何设置Host头" rel="bookmark">perl发起HTTP请求时如何设置Host头</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-16 00:00:00 +0800">16 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>之所以写这么个内容，是今天突然发现之前有个脚本的效果完全不对。这个脚本是用 Furl 模块发 HTTP 请求。看 POD 的说明，以为这样写是生效的：</p>
<div class="highlight"><pre><code class="perl">    <span class="k">use</span> <span class="nn">HTTP::</span><span class="n">Request</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">Furl</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$r</span> <span class="o">=</span> <span class="nn">HTTP::</span><span class="n">Request</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="n">GET</span> <span class="o">=&gt;</span> <span class="s">"http://192.168.0.2/path/to/file"</span> <span class="p">);</span>
    <span class="nv">$r</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">(</span> <span class="n">Host</span> <span class="o">=&gt;</span> <span class="s">"www.example.com"</span> <span class="p">);</span>
    <span class="k">my</span> <span class="nv">$furl</span> <span class="o">=</span> <span class="n">Furl</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">();</span>
    <span class="k">my</span> <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$furl</span><span class="o">-&gt;</span><span class="n">request</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
    <span class="n">say</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="n">code</span><span class="p">();</span>
</code></pre></div>
<p>但是随后在 192.168.0.2 上发现日志记录中，Ho...</p>
</body></html>
      <a href="/2012/12/16/how-to-set-host-header-in-perl" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/11/note-on-using-ElasticSearch-pm" title="不小心踩进ElasticSearch.pm模块的坑里了" rel="bookmark">不小心踩进ElasticSearch.pm模块的坑里了</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-11 00:00:00 +0800">11 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在今天以前，我一直认为perl的ElasticSearch.pm是除了原生java库以外封装最好的。不过今天踩进一个硕大的坑里，多亏 dancer-user 邮件列表里外国友人的帮助，才算爬了出来……</p>
<h1 id="section">事情是这样的</h1>
<p>用 dancer 搭建的一个 webserver 用来提供 api 给前端图表页面。dancer 收到 ajax 请求后组装成 json 发给 ElasticSearch。因为要算百分比，无法在单次请求内完成，不然的话直接从页面上发给 ES 服务器了。</p>
<p>这个 webserver 是之前已经创建过的。而且作用类似，也就是说，之前已经存在一个 <code>DancerApp/lib/DancerApp/First.pm</code> 里使用了 ElasticSearch 模块。相关代码如下：</p>
<div class="highlight"><pre><code class="perl">    <span class="k">use...</span></code></pre></div>
</body></html>
      <a href="/2012/12/11/note-on-using-ElasticSearch-pm" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/10/gnuplot-to-draw-histogram-cluster" title="用gnuplot绘制直方图" rel="bookmark">用gnuplot绘制直方图</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-10 00:00:00 +0800">10 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>越来越喜欢用 gnuplot 画图了，因为有时候发现自己实在是不会用 Excel……</p>
<p>之前基本上用gnuplot画的都是时间轴形式的，诸位客官肯定已经看多了。但是 gnuplot 可不止是这点。还有一种很常见的功能也很方便，就是与时间无关的多个数据做对比的时候，还画成两条连线，就不如画成直方图更体现价值了。比如下面这组数据：</p>
<pre><code>地区	总数(A)	总数(B)
美洲	16682	20344
澳洲	4021	3672
欧洲	2902	2878
</code></pre>
<p>只需要几行配置，就可以生成很漂亮滴直方图对比了。</p>
<div class="highlight"><pre><code class="bash"><span class="nb">set </span>key right top Left reverse width 0 box 3
<span class="nb">set </span>xlabel <span class="s2">"各大洲区域"</span>
<span class="nb">set </span>ylabel <span class="s2">"请求总数"</span>
<span class="nb">set </span>ytics 0, 500
<span class="nb">set ...</span></code></pre></div>
</body></html>
      <a href="/2012/12/10/gnuplot-to-draw-histogram-cluster" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/12/01/convert-docx-to-markdown" title="把docx文档转换成markdown格式发布" rel="bookmark">把docx文档转换成markdown格式发布</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-12-01 00:00:00 +0800">01 Dec 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>有些Word文档想搬到博客上来，而博客用的是markdown的格式。最简单的办法是在Word里转成html格式另存为，因为markdown和html是兼容的。不过word直接另存为的html里面带有“海量”的无聊样式，实在不方便之后我们再用vim的工具编辑。所以还是想办法整整。</p>
<p>相对来说，Word的docx格式比doc格式要容易处理，因为docx是微软特意推出的open xml格式。其实就是记录了文本内容的content.xml、附件media/*和对应附件路径的_ref.xml等的zip包而已。所以相对必须在Windows平台上调用WIN32OLE的API来处理的doc来说，我们在linux平台上也可以很容易的处理docx文件了。比如rubygems上就有一个很不错的gem叫<code>ydocx</code>。一般的docx库都是只抽取docx里的content文字，而这个ydocx很负责的把media/*也复制到docxname_files/images/*下面，并且在html里生成...</p>
</body></html>
      <a href="/2012/12/01/convert-docx-to-markdown" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/22/tatsumaki-demo" title="用 Tatsumaki 框架写 elasticsearch 界面" rel="bookmark">用 Tatsumaki 框架写 elasticsearch 界面</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-22 00:00:00 +0800">22 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>Tatsumaki是Plack作者的一个小框架，亮点是很好的利用了psgi.streaming的接口可以async的完成响应。不过因为缺少周边支持，所以除了几个webchat的example，似乎没看到什么应用。笔者之前纯为练手，却用tatsumaki写了个sync响应的小demo，算是展示一下用tatsuamki做普通web应用的基础步骤吧：</p>
<p>(代码本来是作为一个ElasticSearch数据分析的平台，不过后来发现社区有人开始做纯js的内嵌进ElasticSearch的plugin了，所以撤了repo，这里贴下代码)</p>
<ul>
  <li>所有的psgi/plack应用都一样有自己的app.psgi文件：</li>
</ul>
<div class="highlight"><pre><code class="perl"><span class="k">our</span> <span class="nv">$VERSION</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
<span class="c1">### app.psgi</span>
<span class="k">use</span> <span class="nn">Tatsum...</span></code></pre></div>
</body></html>
      <a href="/2012/11/22/tatsumaki-demo" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/22/gnuplot-to-draw-multi-graph" title="用gnuplot绘制多图" rel="bookmark">用gnuplot绘制多图</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-22 00:00:00 +0800">22 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>以前已经提过多次gnuplot的简便快捷了。不过大多是最基本的单图上画条线之类的。这次碰到需求，稍微help了一下在一个图上画多个区域。主要需要注意的就是set size的定位点到底从什么角度算，说实话蛮麻烦的。</p>
<p>上文件：</p>
<div class="highlight"><pre><code class="bash">    <span class="nv">result</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">begin</span><span class="o">=</span><span class="sb">`</span>head -n 1 <span class="nv">$result</span>.txt | awk <span class="s1">'{print $1}'</span><span class="sb">`</span>
    <span class="nv">end</span><span class="o">=</span><span class="sb">`</span>tail -n 1 <span class="nv">$result</span>.txt | awk <span class="s1">'{print $1}'</span><span class="sb">`</span>
    cat &gt; conf/<span class="nv">$result</span>.conf <span class="s">&lt;&lt;EOF</span>
<span class="s">    set terminal png</span>
<span class="s">    set output "png/$result.png"</span>
<span class="s">    set multiplot</span>
<span class="s">    set ...</span></code></pre></div>
</body></html>
      <a href="/2012/11/22/gnuplot-to-draw-multi-graph" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/19/syslog-realtime-warning-to-speech" title="syslog实时报警"说出来"" rel="bookmark">syslog实时报警"说出来"</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-19 00:00:00 +0800">19 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>syslog应该是大家最常用的，也基本可以说是最重要的服务器监控信息来源了。</p>
<p>syslog的传输，应该不用再说，哪怕在百度里搜都有足够多的靠谱结果。而关于报警的问题，之前我也写了好几篇，比如<a href="/2012/10/17/juggernaut-for-syslog-check">《用Juggernaut实时推送syslog分析结果》</a>讲了如何用websocket推送结果，<a href="/2012/11/09/chrome-app-demo">《Chrome的APP简单用法》</a>讲了如何利用chrome后台页面开机自动运行进行桌面提示。</p>
<p>那么，如果我既不想开网页看，也不好安装chrome浏览器，有没有够简便的办法接收呢？有！Linux社区从来不缺乏各种神奇工具。下面介绍两个同样强大的提示办法。</p>
<p>第一个...</p>
</body></html>
      <a href="/2012/11/19/syslog-realtime-warning-to-speech" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/18/data-visualization-with-elasticsearch-and-protovis" title="【翻译】用ElasticSearch和Protovis实现数据可视化" rel="bookmark">【翻译】用ElasticSearch和Protovis实现数据可视化</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-18 00:00:00 +0800">18 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>搜索引擎最重要的目的，嗯，不出意料就是<code>搜索</code>。你传给它一个请求，然后它依照相关性返回你一串匹配的结果。我们可以根据自己的内容创造各种请求结构，试验各种不同的分析器，搜索引擎都会努力尝试提供最好的结果。</p>
<p>不过，一个现代的全文搜索引擎可以做的比这个更多。因为它的核心是基于一个为了高效查询匹配文档而高度优化过的数据结构——<a href="http://en.wikipedia.org/wiki/Index_%5C(search_engine%5C)#Inverted_indices">倒排索引</a>。它也可以为我们的数据完成复杂的<code>聚合</code>运算，在这里我们叫它facets。(不好翻译，后文对这个单词都保留英文)</p>
<p>facets通常的目的是提供给用户某个方面的导航或者搜索。 当你在网上商店搜索“相机”，你可以选择不同的制造商，价格范围或者特定功能来定制条件，这应该就是点一下链接的事情，而不是通过修改一长串查询语法。</p>
<p>一个<a href="http://blog.linkedin.com/2009/12/14/linkedin-faceted-search/">LinkedIn的导航</a>范例如下图所示：</p>
<p><img src="http://www.elasticsearch.cn/blog/images/dashboards/linkedin-faceted-search.png" alt="图片1"></p>
<p>Facet搜索为数不多的几个可以把强大的请求能力开放给最终用户的办法之一，详见Moritz Stefaner的试...</p>
</body></html>
      <a href="/2012/11/18/data-visualization-with-elasticsearch-and-protovis" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/18/coro" title="【翻译】Coro模块文档" rel="bookmark">【翻译】Coro模块文档</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-18 00:00:00 +0800">18 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<h1 id="section">名称</h1>
<p>Coro —— perl唯一真正的线程</p>
<h1 id="section-1">简要</h1>
<div class="highlight"><pre><code class="perl">    <span class="k">use</span> <span class="n">Coro</span><span class="p">;</span>
    <span class="n">async</span> <span class="p">{</span>
        <span class="c1">#一些异步执行的线程</span>
        <span class="k">print</span> <span class="s">"2\n"</span><span class="p">;</span>
        <span class="n">cede</span><span class="p">;</span> <span class="c1">#切换回main线程</span>
        <span class="k">print</span> <span class="s">"4\n"</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="k">print</span> <span class="s">"1\n"</span><span class="p">;</span>
    <span class="n">cede</span><span class="p">;</span> <span class="c1">#切换到coro线程</span>
    <span class="k">print</span> <span class="s">"3\n"</span><span class="p">;</span>
    <span class="n">cede</span><span class="p">;</span> <span class="c1">#再次切换</span>
    <span class="c1">#使用信号锁</span>
    <span class="k">my</span> <span class="nv">$lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nn">Coro::</span><span class="n">Semaphore</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$locked</span><span class="p">;</span>
    <span class="nv">$lock</span><span class="o">-&gt;</span><span class="n">down</span><span class="p">;</span>
    <span class="nv">$locked</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$lock</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">;</span>
</code></pre></div>
<h1 id="section-2">描述</h1>
<p>如果想...</p>
</body></html>
      <a href="/2012/11/18/coro" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/11/09/chrome-app-demo" title="Chrome的APP简单用法" rel="bookmark">Chrome的APP简单用法</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-11-09 00:00:00 +0800">09 Nov 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>学习一下简单的chrome app写法。首先，chrome的ext和web app和packaged app就要分清楚。简单说，ext就是可以出现在地址栏右侧的，app是可以出现在任务栏右侧的。而web app其实就是用json描述了一个url地址，packaged app则是最接近普通桌面程序的，需要完整的带有html/css/js等内容。但同时，因为packaged app可以在关闭chrome浏览器后运行，所以有些浏览器上的API它也用不了。</p>
<p>首先上一个web app的demo，只要一个manifest.json在本地就够了。关键点是app里指定为url，permissions指定需要的权限。</p>
<div class="highlight"><pre><code class="javascript"><span class="p">{</span>
  <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"WebApp"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="o">:</span> <span class="s2">"0.1"</span><span class="p">,</span>
  <span class="s2">"app"...</span></code></pre></div>
</body></html>
      <a href="/2012/11/09/chrome-app-demo" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/10/30/faraday-select-rand-node-for-logstash-output-elasticsearch-http" title="【Logstash系列】Outputs::ElasticsearchHTTP自动获取随机node" rel="bookmark">【Logstash系列】Outputs::ElasticsearchHTTP自动获取随机node</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-10-30 00:00:00 +0800">30 Oct 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>今天在ES群中和medcl请教了一下index的性能问题。基本上在bulk的基础上，还有几点是可以做的。当然medcl说的是正常的全文索引的场景：</p>
<ul>
  <li>不用http协议，直接走tcp层，维护一个pool发bulk；</li>
  <li>多台node的情况下，在bulk前先设置replica为0；bulk完成后再调整replica；</li>
  <li>因为es会自动路由，所以index请求可以分散开直接发给多个node。</li>
</ul>
<p>总之，就是减少集群内部的网络传输。</p>
<p>介于logstash的应用是一直持续往es写数据的，所以replica调整这招用不上，顶多加大refresh时间而已。所以可以动手的地方主要就是第三条了。</p>
<p>正好去翻了一下perl的Elasticsearch.pm的POD。发现原来perl模块本色默认就是这么做的。new的时候定义的server，是用来发送请求获取集群所有alive的nod...</p>
</body></html>
      <a href="/2012/10/30/faraday-select-rand-node-for-logstash-output-elasticsearch-http" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/10/26/systemtap-and-file-descriptor" title="用systemtap调试文件描述符限制" rel="bookmark">用systemtap调试文件描述符限制</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-10-26 00:00:00 +0800">26 Oct 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>在运行一些非root用户进程的时候，我们都习惯要在前面加上一个ulimit -HSn 65535的命令。而且我们还知道关于文件描述符的限制，不止这一个地方，还有limits.conf，sysctl -w fs.file-max等等。但是到底这些是什么个关系呢？而且，如果是一个已经在运行的程序，有没有可能在更改他的文件描述符限制呢？</p>
<p>以最经常碰到这种情况的squid为例。我们可以在squid/src/comm.c里看到<code>comm_openex()</code>是如何发现超出限制的，嗯，可以说没有”自己发现”，直接判断socket()是否成功而已。所以接下来的事情是看socket创建过程怎么判断的。</p>
<p>关于socket过程，主要看kernel/net/socke...</p>
</body></html>
      <a href="/2012/10/26/systemtap-and-file-descriptor" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/10/21/elasticearch-simple-usage" title="【Logstash系列】ElasticSearch的几点使用事项" rel="bookmark">【Logstash系列】ElasticSearch的几点使用事项</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-10-21 00:00:00 +0800">21 Oct 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>之前已经写过一些ES的使用，也翻译了一篇官网上关于ES存储日志的建议日志。今天稍微总结一下近期以来实践出来的方案。</p>
<h1 id="shardreplica">shard和replica的选择</h1>
<p>在测试期，可以单节点上设置成1 shard + 0 replica的方式，这种的indexing速度是最快的(存疑:我至今没搞清楚ES在index的时候集群”应该”是比单node快还是慢)。</p>
<p>我曾经按照”常理”(我想象中的)理解，设定成10 shards + 0 replica，期望能用上并行写双node加倍index，事实上压根没用，而且因为另一台node上有其他负载的原因导致更慢了。</p>
<p>更可怕的是：就在前几天，突然出现一个shard挂了，……毫无办法，整个index全作废了。</p>
<p>所以结论是：无论如何，一定要保证有 &gt; 0 份的replica!! 至于shards，保持默认的5个，或者顶多到20个也就差不多了。在maillist里看到有哥们设了100个，然后苦着脸问性能问题...</p>
</body></html>
      <a href="/2012/10/21/elasticearch-simple-usage" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/10/17/juggernaut-for-syslog-check" title="用Juggernaut实时推送syslog分析结果" rel="bookmark">用Juggernaut实时推送syslog分析结果</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-10-17 00:00:00 +0800">17 Oct 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>大家一般都会用rsyslog或者syslog-ng之类的收集系统日志。不过收集之后的处理就各种各样了。这里提供一个简单的处理，按日期保存成文件，然后定时分析新增内容，通过websocket推送到页面报警。这对于像磁盘错误等信息比较有用。因为等nagios之类的监控反应出来，故障可能就已经到你措手不及的地步了。</p>
<p>这里介绍一下Juggernaut项目，作者当初还在上学的时候就开始搞这个项目并最终因为这个项目找到的工作。不过几个月前他宣布不再维护了，因为他觉得html5已经普及，大家直接写websocket就够了。额，在口年的中国，我觉得Juggernaut还是很有意义的。项目地址：<a href="https://github.com/maccman/juggernaut">https://github.com/maccman/juggernaut</a>。</p>
<p>举例中有ruby、js和python的样例，不过既然是用Redis传消息，那么改成perl的代码跟p...</p>
</body></html>
      <a href="/2012/10/17/juggernaut-for-syslog-check" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/10/02/gather-take-in-perl5" title="Perl5里的gather/take" rel="bookmark">Perl5里的gather/take</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-10-02 00:00:00 +0800">02 Oct 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>九月末的YAPC::Asia上，Larry Wall展示了一下怎么把一个perl5上很标准的排序脚本改造成perl6脚本。主要是条件语句不再用()了，子函数传参方式，对象化操作等等。唯独有个命令是之前未见过的：gather/take。用这个可以减少临时变量的使用。</p>
<p>找了一下，类似命令在perl5中有多个模块对应：<a href="http://search.cpan.org/~moritz/Perl6-GatherTake-0.0.3/lib/Perl6/GatherTake.pm">Perl6::GatherTake</a>、<a href="http://search.cpan.org/~gaal/Perl6-Take-0.04/lib/Perl6/Take.pm">Perl6::Take</a>、<a href="http://search.cpan.org/~dconway/Perl6-Gather-0.42/lib/Perl6/Gather.pm">Perl6::Gather</a>、<a href="http://search.cpan.org/~flora/List-Gather-0.06/lib/List/Gather.pm">List::Gather</a>和<a href="http://search.cpan.org/~frew/Syntax-Keyword-Gather-1.002000/lib/Syntax/Keyword/Gather.pm">Syntax::Keyword::Gather</a>。</p>
<p>具体的说明，可以看<a href="http://search.cpan.org/~dconway/Perl6-Gather-0.42/lib/Perl6/Gather.pm">Perl6::Gather</a>的POD说明，比较详细。其他的都是简单给个例子就是了。</p>
<div class="highlight"><pre><code class="perl"><span class="k">use</span> <span class="nn">Perl6::</span><span class="n">Gather</span><span class="p">;</span>
<span class="k">print</span> <span class="n">gather</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">{</span>
   ...</code></pre></div>
</body></html>
      <a href="/2012/10/02/gather-take-in-perl5" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/26/jsonp-for-new-version-amcharts" title="用javascript操作新版本amcharts" rel="bookmark">用javascript操作新版本amcharts</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-26 00:00:00 +0800">26 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>新版本的amcharts用js和html5改写。不再简单的用settings.xml而是写成js的object了。好在例子依然详细。下面贴一段从数据库里取值并绘制成多栏图式的代码：</p>
<div class="highlight"><pre><code class="javascript"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">"Content-Type"</span> <span class="nx">content</span><span class="o">=</span><span class="s2">"text/html; charset=utf-8"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">amStock</span> <span class="nx">Example</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
        <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"../amcharts/style.css"</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text/css"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"../javasc...</span></code></pre></div>
</body></html>
      <a href="/2012/09/26/jsonp-for-new-version-amcharts" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/21/json-event-for-logstash" title="【Logstash系列】数据格式之json-event" rel="bookmark">【Logstash系列】数据格式之json-event</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-21 00:00:00 +0800">21 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>之前的各种示例中，都没有提到logstash的输入输出格式。看起来就好像logstash比Message::Passing少了decoder/encoder一样。其实logstash也有类似的设定的，这就是format。有三种选择：plain/json/json_event。默认情况下是plain。也就是我们之前的通用做法，传文本给logstash，由logstash转换成json。</p>
<p>logstash社区根据某些应用场景，有相关的cookbook。关于访问日志，有<a href="http://cookbook.logstash.net/recipes/apache-json-logs/">http://cookbook.logstash.net/recipes/apache-json-logs/</a>。这是一个不错的思路！我们可以照葫芦画瓢给nginx也定义一下：</p>
<div class="highlight"><pre><code class="nginx">     <span class="k">logformat</span> <span class="s">json</span> <span class="s">'</span><span class="p">{</span><span class="kn">"@timestamp":"$time_iso8601...</span></code></pre></div>
</body></html>
      <a href="/2012/09/21/json-event-for-logstash" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/16/regexp-log-demo-for-nginx" title="【Message::Passing系列】Regexp::Log模板匹配变量" rel="bookmark">【Message::Passing系列】Regexp::Log模板匹配变量</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-16 00:00:00 +0800">16 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>上面调用的Regexp::Log::Nginx是base Regexp::Log的实例，CPAN上已经提供了好些server的log regex，见<a href="http://search.cpan.org/search?query=Regexp%3A%3Alog&amp;mode=all">http://search.cpan.org/search?query=Regexp%3A%3Alog&amp;mode=all</a>。</p>
<div class="highlight"><pre><code class="perl">    <span class="c1">#!/usr/bin/perl</span>
    <span class="nb">package</span> <span class="nn">Regexp::Log::</span><span class="n">Nginx</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">base</span> <span class="sx">qw( Regexp::Log )</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">vars</span> <span class="sx">qw( $VERSION %DEFAULT %FORMAT %REGEXP )</span><span class="p">;</span>
    <span class="nv">%DEFAULT</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">format</span>  <span class="o">=&gt;</span> <span class="s">'%date %status %remotehost %domain %request %originhost %responsetime %upstreamtime %bytes %referer %useragent %xforwarderfor'...</span></code></pre></div>
</body></html>
      <a href="/2012/09/16/regexp-log-demo-for-nginx" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/16/message-passing-filter-demo" title="【Message::Passing系列】过滤器实例" rel="bookmark">【Message::Passing系列】过滤器实例</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-16 00:00:00 +0800">16 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p><a href="http://github.com/suretec">Message::Passing</a>是Suretec公司为自己的VoIP业务开发的logstash山寨版。这几个月更新还是比较快的。比之前我刚关注它时改变很大。比如Message::Passing::Output::ElasticSearch已经出来了，还有专门的Message::Passing::Filter::ToLogstash，连命令行方式Message::Passing::Role::Script都采用了MooX::Options构建，相当的OO了。</p>
<p>不过可能是运用...</p>
</body></html>
      <a href="/2012/09/16/message-passing-filter-demo" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/16/message-passing-agent" title="【Message::Passing系列】客户端收集脚本" rel="bookmark">【Message::Passing系列】客户端收集脚本</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-16 00:00:00 +0800">16 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>最后编写一段日志收集的agent：</p>
<div class="highlight"><pre><code class="perl">    <span class="c1">#!/usr/bin/perl</span>
    <span class="nb">package</span> <span class="n">NginxLogCollector</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">Moo</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">MooX::</span><span class="n">Options</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">Message::Passing::</span><span class="n">DSL</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">MooX::Types::MooseLike::</span><span class="n">Base</span> <span class="sx">qw/ Str /</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">namespace::</span><span class="n">clean</span> <span class="o">-</span><span class="n">except</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sx">qw( meta _options_data _options_config )</span><span class="p">];</span>
    <span class="n">with</span> <span class="s">'Message::Passing::Role::Script'</span><span class="p">;</span>
    <span class="n">option</span> <span class="n">filename</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="n">is</span> <span class="o">=&gt;</span> <span class="s">'ro...</span></code></pre></div>
</body></html>
      <a href="/2012/09/16/message-passing-agent" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/16/elasticsearch-bulk-index-speed-testing" title="【Message::Passing系列】ElasticSearch的bulk_index速度测试" rel="bookmark">【Message::Passing系列】ElasticSearch的bulk_index速度测试</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-16 00:00:00 +0800">16 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#logstash-ref" title="logstash" rel="category tag">logstash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>连续尝试了logstash的elasticsearch/elasticsearch_http/elasticsearch_river三个putput模块，发现其index/bulk/river三种插入方式的实际运行效果速度居然没有差异。而使用perl脚本测试，单例下index不到300msg/sec，bulk接近2500msg/sec，几乎翻了10倍。</p>
<p>测试脚本如下：</p>
<div class="highlight"><pre><code class="perl">    <span class="c1">#!/usr/bin/perl -w</span>
    <span class="k">use</span> <span class="n">ElasticSearch</span><span class="p">;</span>
    <span class="k">use</span> <span class="n">JSON</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">Time::</span><span class="n">HiRes</span> <span class="sx">qw/time/</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">Data::</span><span class="n">Dumper</span><span class="p">;</span>
    <span class="c1">#curl -XGET 'http://localh...</span></code></pre></div>
</body></html>
      <a href="/2012/09/16/elasticsearch-bulk-index-speed-testing" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h1 class="entry-title">
      <a href="/2012/09/06/intro-rex" title="(R)?ex介绍" rel="bookmark">(R)?ex介绍</a>
    </h1>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2012-09-06 00:00:00 +0800">06 Sep 2012</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#devops-ref" title="devops" rel="category tag">devops</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
      <html><body>
<p>按说这文章好像轮不到我写。几个线上运用着的哥们都不出手，我勉强记录一些<a href="http://rexify.org/">官网</a>上没写example但实际应该蛮常用的功能吧：</p>
<ul>
  <li>IP列表</li>
</ul>
<p>Rex的示例中，都突出了自己可以方便的对group做集合运算的特点。嗯，这个在早先使用SSH::Batch的时候就很钦佩。但是面对可能某个应用每个节点就一两台设备又有很多应用的情况，在Rexfile里写就很麻烦了。而且难免有其他操作的时候需要用单独的列表。</p>
<p>其实Rex有Rex::Group::Lookup::File模块专门解决这个问题：</p>
<div class="highlight"><pre><code class="perl"><span class="k">use</span> <span class="nn">Rex::Group::Lookup::</span><span class="n">File</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$group_path</span> <span class="o">=</span> <span class="s">"/etc/puppet/iplist"</span><span class="p">;</span>
<span class="nb">grep</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$group_file</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">;</span>
    <span class="k">my...</span></code></pre></div>
</body></html>
      <a href="/2012/09/06/intro-rex" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
    <li>
      <a href="/">Previous</a>
    </li>
    <li class="page">
      <a href="/">1</a>
    </li>
    <li class="page active">
      <a href="#">2</a>
    </li>
    <li class="page">
      <a href="/page3">3</a>
    </li>
    <li class="page">
      <a href="/page4">4</a>
    </li>
    <li class="page">
      <a href="/page5">5</a>
    </li>
    <li class="page">
      <a href="/page6">6</a>
    </li>
    <li class="page">
      <a href="/page7">7</a>
    </li>
    <li class="page">
      <a href="/page8">8</a>
    </li>
    <li class="page">
      <a href="/page9">9</a>
    </li>
    <li class="page">
      <a href="/page10">10</a>
    </li>
    <li class="page">
      <a href="/page11">11</a>
    </li>
    <li class="page">
      <a href="/page12">12</a>
    </li>
    <li class="page">
      <a href="/page13">13</a>
    </li>
    <li class="page">
      <a href="/page14">14</a>
    </li>
    <li class="page">
      <a href="/page15">15</a>
    </li>
    <li>
      <a href="/page3">Next</a>
    </li>
  </ul>
</div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <!--以下是QQ邮件列表订阅嵌入代码-->
            <script >var nId = "86cca8e03c1002936e00aaa28bd933c15c4a437a5e63cafd",nWidth="auto",sColor="light",sText="填写您的邮件地址，订阅logstash/ElasticSearch相关讨论：" ;</script><script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接</li>
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
              <li><a href="http://blog.dotcloud.com/" title="dotCloud 官方博客">dotCloud-Blog</a></li>
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
              <li><a href="http://www.icylife.net/blog/" title="">心路</a></li>
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
              <li><a href="http://dbahacker.com/" title="TB 杨德华">DBA Hacker</a></li>
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
              <li><a href="http://blog.laird-sa.com/" title="">Laird-SA</a></li>
              <li><a href="http://www.linuxsee.com/" title="">LinuxSEE</a></li>
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
              <li><a href="http://www.puppeter.cn/" title="">piol</a></li>
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
              <li><a href="http://www.sanote.org/" title="">sa note</a></li>
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
              <li><a href="http://zauc.wordpress.com/" title="">Timo</a></li>
              <li><a href="http://julyclyde.org/" title="新浪系统工程师">七月的夏天</a></li>
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
              <li><a href="http://blog.s135.com/" title="金山·张宴">回忆未来</a></li>
              <li><a href="http://blog.ops.tudou.com/wp/" title="">土豆运营团队</a></li>
              <li><a href="http://www.91tuanfang.com/" title="安居客运维">家欣的天空</a></li>
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
              <li><a href="http://www.wenzizone.cn/" title="">蚊子世界</a></li>
              <li><a href="http://www.opboy.com" title="">运维小子</a></li>
              <li><a href="http://blog.liuts.com/" title="前天涯SA 刘天斯">运维进行时</a></li>
              <li><a href="http://www.lark.net.cn/" title="lark's cloud">lark's cloud</a></li>
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
              <li><a href="http://blog.liulantao.com/" title="lax">Lax</a></li>
              <li><a href="http://l09.me/" title="风声">风声</a></li>
              <li><a href="http://shellblog.info/" title="莫言">莫言</a></li>
              <li><a href="http://mooser.me/" title="牛氓">牛氓</a></li>
              <li><a href="http://http://www.yinwang.org/" title="当然我在扯淡">当然我在扯淡</a></li>
              <li><a href="http://noops.me/" title="">NoOps</a></li>
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
          </ul>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
    <!-- JiaThis Button BEGIN -->
    <script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1589850" charset="utf-8"></script>
    <!-- JiaThis Button END -->
    <!-- UJian Button BEGIN -->
    <script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&uid=1589850"></script>
    <!-- UJian Button END -->
  </body>
</html>
