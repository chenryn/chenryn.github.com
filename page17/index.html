<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">归档</a></li>
      	<li><a href="/categories.html">分类</a></li>
      	<li><a href="/errata.html">《网站运维技术与实践》勘误</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/projects.html">学习记录</a></li>
      	<li><a href="/tags.html">标签</a></li>
            <li><a href="http://chenlinux.com/poetry/index.html" />诗文集</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/24/shell-script-for-train-setting" title="CUshell版惊见中国特色脚本" rel="bookmark">CUshell版惊见中国特色脚本</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-24 00:00:00 +0800">24 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>58同城：
      <a href="/2010/01/24/shell-script-for-train-setting" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/23/automate-configure-squid-in-website" title="squid自动配置web化" rel="bookmark">squid自动配置web化</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-23 00:00:00 +0800">23 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>[root@test data]# cat index.htm
      <a href="/2010/01/23/automate-configure-squid-in-website" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/19/sysctl-about-tcp" title="系统优化——TCP参数" rel="bookmark">系统优化——TCP参数</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-19 00:00:00 +0800">19 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>tcp_syn_retries ：INTEGER
默认值是5
对于一个新建连接，内核要发送多少个 SYN 连接请求才决定放弃。不应该大于255，默认值是5，对应于180秒左右时间。(对于大负载而物理通信良好的网络而言,这个值偏高,可修改为2.这个值仅仅是针对对外的连接,对进来的连接,是由tcp_retries1决定的)
      <a href="/2010/01/19/sysctl-about-tcp" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/13/refresh-cache-of-interrogation-url" title="squid刷新缓存" rel="bookmark">squid刷新缓存</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-13 00:00:00 +0800">13 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>这篇博文的起因是最近犯的一个低级错误。某客户要求立刻刷新掉一批url。格式是http://a.b.com/index.jsp?pid=123456&amp;id=654321这样的。
我也没多想，上去就执行“squidclient -p 80  -m purge
http://a.b.com/index.jsp?pid=123456&amp;id=654321”。结果硬是刷不掉……明明访问源站已经没有这个url了。我wget居然还能MISS/200~~~
直到同事提醒。才赫然发现其实我一直在purge和wget的，不是http://a.b.com/index.jsp?pid=123456&amp;id=654321，而是http://a.b.com/index.jsp?pid=123456。linux把url里的&amp;当作后台运行的命令执行了……而access.log中为了安全又没记录?后的具体参数，于是傻傻的跟客户客服扯皮了N久……
“squidclient -p 80  -m purge &lsquo;http://a.b.com/index.jsp?pid=123456&amp;amp;id=654321&rsquo;”这么一刷立刻就好了~~
由此告诫自己，以后一定要严谨行事，引号最好还是要养成习惯都给带上~~
      <a href="/2010/01/13/refresh-cache-of-interrogation-url" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/13/refresh-cache-by-php" title="刷新squid缓存的php脚本" rel="bookmark">刷新squid缓存的php脚本</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-13 00:00:00 +0800">13 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Flush_Cache</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">Flush_Cache_HTTP_Header_Impl</span> <span class="k">implements</span> <span class="nx">Flush_Cache</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">flush</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$url</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$url_component</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
        <span class="k">global</span> <span class="nv">$g_squid_servers</span><span class="p">;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$g_squid_servers</span> <span class="k">as</span> <span class="nv">$server</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$squid_params</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span> <span class="p">,</span> <span class="nv">$server</span><span class="p">);</span>
            <span class="nv">$fsocket</span> <span class="o">=</span> <span class="nb">fsockopen</span><span class="p">(</span><span class="nv">$squid_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$squid_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nv">$errono</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="k">FALSE</span> <span class="o">!=</span> <span class="nv">$fsocket</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$head</span> <span class="o">=</span> <span class="s2">&quot;HEAD </span><span class="si">{</span><span class="nv">$url_component</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> HTTP/1.1rn&quot;</span><span class="p">;</span>
                <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Accept: */*rn&quot;</span><span class="p">;</span>
                <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Host: </span><span class="si">{</span><span class="nv">$url_component</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">rn&quot;</span><span class="p">;</span>
                <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Cache-Control: no-cachern&quot;</span><span class="p">;</span>
                <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;rn&quot;</span><span class="p">;</span>
                <span class="k">echo</span> <span class="nv">$head</span><span class="p">;</span>
                <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fsocket</span> <span class="p">,</span> <span class="nv">$head</span><span class="p">);</span>
                <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fsocket</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fsocket</span> <span class="p">,</span> <span class="mi">4096</span><span class="p">);</span>
                    <span class="k">echo</span> <span class="nv">$line</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fsocket</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$g_squid_servers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;192.168.2.88:80&#39;</span><span class="p">);</span>
<span class="nv">$flush_cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Flush_Cache_HTTP_Header_Impl</span><span class="p">();</span>
<span class="nv">$flush_cache</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">(</span><span class="s1">&#39;http://ent.cdqss.com/index.html&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>
      <a href="/2010/01/13/refresh-cache-by-php" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/10/zz-intro-acls-in-squid" title="Squid的ACL分类" rel="bookmark">Squid的ACL分类</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-10 00:00:00 +0800">10 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>在找http_status的acl用法时，看到这么一句“This clause supports both fast and slow acl types”。acl还分快慢呢~~赶紧去wiki看：<a href="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs</a>
      <a href="/2010/01/10/zz-intro-acls-in-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/09/keep-sessions-between-client-cache-origin" title="client-cache-origin之间的session问题" rel="bookmark">client-cache-origin之间的session问题</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-09 00:00:00 +0800">09 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>昨天，突然接到某客户的邮件，表示他们质疑我们cache对其多originserver的轮询不均等，以至于影响到网站的访问。
听起来不是什么难题，把服务器上的DNSCache进程中止掉，不就能平均轮询了么？可是操作完成后，客户依然不认可……于是开始细细探讨具体的错误问题所在。
原来实际情况是这样：点击其网站的回复、收藏等动态页面时，时常会弹出错误页面。对这个错误页面，客户的解释是“session状态CDN加速未保留”。
由此解释，我觉得cache上的问题恰恰相反，正是因为均等轮询了导致的。而客户其他一些单源的域名服务正常，也证明了这点。
上cache服务器查看配置，使用的默认keep-alive设置，也就是对client和origin都开启了keep-alive，默认时间为2min。但实际上并没有起作用。在测试中，可以看到这样的日志：
      <a href="/2010/01/09/keep-sessions-between-client-cache-origin" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/09/intro-http_status" title="squid3新acl类型http_status试用（源站故障转向研究）" rel="bookmark">squid3新acl类型http_status试用（源站故障转向研究）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-09 00:00:00 +0800">09 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>今天试着自己编译安装了squid3.1，然后开始移植2.6的配置文件。在squid.conf.document（2.6里的squid.conf.default）里看了很久，发现不少新东西。跟转向有关的，便发现一个：
      <a href="/2010/01/09/intro-http_status" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/05/principle-and-solution-of-the-vm-date-problem" title="虚拟机时间问题的机制原理及解决办法" rel="bookmark">虚拟机时间问题的机制原理及解决办法</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-05 00:00:00 +0800">05 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cloud-ref" title="cloud" rel="category tag">cloud</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>对于CDN来说，时间是个非常重要的概念，squid的缓存刷新控制，全都是以服务器时间为基准。在我博客的前不知道几篇的某文中，就提到过因为时间的原因引起的刷新事故。而最新的一次，是公司在日志流量统计时，因为相差太大导致截取失败——这可都是钱呢。
实际工作中，大多会搭建一个NTP服务器，给应用服务器提供时间同步服务。但虚拟机在这方面有个问题。虚拟机的时间是读取的宿主机的硬件时钟，随便你date
-s 1234怎么改，下一次date查看，都会恢复成原样。
这样看起来是个好事，因为这样可以省略掉大批机器的NTP服务器同步时间的压力。但糟糕的事情在后头：一大批重要客户的虚拟机，在运行上半年以上时间后，date都比真实时间超前了（偶然我也看到过一次滞后的）。或许是几分钟，或许是几小时！！
这一度让我很无奈，因为即使我重启虚拟机，这个诡异的date也依然倔强的按照它自己的时钟前进。看起来办法只有一个：把虚拟平台整个的重启——好在这种试验的结果是有效的，不然真不知道怎么办了。
从这个无奈的办法中，也应该可以推测出一个结论，虚拟机的时钟，应该是另有文件存储在虚拟平台的某个临时文件里。所以关闭虚拟机，该文件还存在并继续计时；重启动虚拟平台，该文件才会重计。至于这个文件叫什么，存放在哪里，一时半会我就找不到了，或许这个问题不算什么特别大的问题，至少我在linuxsir.org的《xen初学指南》中，没有找到关于时钟的配置说明。
不过再小的问题也顶不住人的研究。于是我找到了另一篇很对口的文章：《虚拟机中GUEST OS时钟(TIMEKEEP)问题的探讨》。
文章告诉我们：虚拟机的时钟，与真实机的时钟区别，其一在于其处理不是抢占中断而是延迟处理；其二在于其中断模拟软件可能因资源占用问题被推迟。
这两点区别，导致的结果却是一个，就是一旦服务器负载变高，时钟中断就被排到后头去了……
文章也提出了解决办法，一个是编程，让系统补上中断的时间，这个俺就不说了；一个是修改内核，让系统不断修正date；
进一步问题：不管哪个办法，第一，加重了虚拟机负载；第二，这又依赖与系统去更新date的进程的精准度，而这个进程的中断时钟如果有偏差的话，……
再进一步方法……有兴趣的还是自己点文章看吧。
看起来这个问题就要永远终结在此了。
不过变通的主意及时的出现了——既然虚拟机跟虚拟平台之间的异步时钟同步没法解决，我们就干脆不要虚拟机跟虚拟平台同步了。这样虽然对NTP的压力大了，但毕竟保证了CDN的正常。而且从上头的原理可以知道，能够导致date偏差到这个程度的原因，大概也是因为虚拟机的负载压力太大。事实上，我们为了保证冗余，也是尽量避免这种压力出现的。那么date偏差的服务器，其实也就是少数了。
顺着这个思路一查，原来办法其实很简单——修改虚拟机的independent_wallclock值即可：
echo 1 &gt; /proc/sys/xen/independent_wallclock
或sysctl xen.independent_wallclock=1
启用虚拟机独立系统时间；
/etc/init.d/ntpd stop
ntpdate 192.168.0.1
就能完成NTP时间同步了；
再date看看，时间果然就更正了~~
/proc下的文件都是进程使用中的文件，如果要让虚拟机开机自动读取配置，把这个修改写进/etc/sysctl.conf才行哦：
echo &ldquo;xen.independent_wallclock = 1&rdquo;&nbsp;&raquo; /etc/sysctl.conf
就这么简单~~~
      <a href="/2010/01/05/principle-and-solution-of-the-vm-date-problem" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/01/01/limit-speed-in-squid" title="squid限速" rel="bookmark">squid限速</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-01-01 00:00:00 +0800">01 Jan 2010</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>squid有个delay_pool，可以做限速，虽然效果不太准~（嗯，就像限制并发连接数的maxconn一样）
首先搬个老虎皮做大旗——《Squid: The Definitive Guide》的相关段落：
      <a href="/2010/01/01/limit-speed-in-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/31/process-of-request-to-squid" title="squid请求处理流程（源站故障转向研究）" rel="bookmark">squid请求处理流程（源站故障转向研究）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-31 00:00:00 +0800">31 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>今天继续想别的办法，第一，当然还是修改源代码，这个C++可惜俺不懂，只是大略的通过百大哥谷大婶知道了squid的请求处理流程：
      <a href="/2009/12/31/process-of-request-to-squid" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/system-function-in-awk" title="awk中让人郁闷的system()函数" rel="bookmark">awk中让人郁闷的system()函数</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>发现一个特尴尬的事实。我辛辛苦苦去百度资料，想用rewrite实现针对不同域名源站故障后的自动跳转功能，但整个思路里遗漏了一个严重的问题。
      <a href="/2009/12/30/system-function-in-awk" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/squid-gzip" title="squid3 的 gzip 支持" rel="bookmark">squid3 的 gzip 支持</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>标题很简单，内容很复杂，而且我也用不上。姑且存档吧：
原标题《VIGOS eCAP GZIP Adapter for SQUID Proxy Cache》
第一句话就让我很绝望，本插件只适用于squid3.1及以上版本——squid有比3.1更高的版本么——前文提到的有session控制的squid2.7我都还没看呢~哭
      <a href="/2009/12/30/squid-gzip" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/a-reverse-example-of-url_rewrite_program" title="url_rewrite_program（squid游戏恶搞~）" rel="bookmark">url_rewrite_program（squid游戏恶搞~）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>标题很引人吧。其实是我在查找squid的rewrite资料时，看到的一篇文章。原作者突发奇想，准备让公司的同事们上网时，看到的所有图片全都倒过来180°。嘿嘿，小样，还不拧断你们脖子~~
      <a href="/2009/12/30/a-reverse-example-of-url_rewrite_program" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/a-location-example-of-url_rewrite_program" title="url_rewrite_program（首次访问跳转）" rel="bookmark">url_rewrite_program（首次访问跳转）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>上文提到，squid大多数的rewrite_program是用perl编写的。现在就转几个简洁明了的redirect.pl。虽说我至今没把perl基础教程看完。不过从中领会一下squid的rewrite流程，还是可以的：
      <a href="/2009/12/30/a-location-example-of-url_rewrite_program" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/a-location-example-of-squid_session" title="squid_session（首次访问跳转）" rel="bookmark">squid_session（首次访问跳转）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>上文perl例二中提到的第一次上某网站时先跳转公司主页。在CU上看到另一种办法。即在squid2.7以上版本中，有个squid_session。操作如下：
首先是安装：
安装squid ( for 2.7 stable )
修改源代码：vi src/errorpage.c 60行处将
      <a href="/2009/12/30/a-location-example-of-squid_session" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/30/502-error-in-nginx" title="nginx502错误" rel="bookmark">nginx502错误</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-30 00:00:00 +0800">30 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#nginx-ref" title="nginx" rel="category tag">nginx</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>NGINX 502 Bad Gateway错误是FastCGI有问题，造成NGINX 502错误的可能性比较多。将网上找到的一些和502 Bad Gateway错误有关的问题和排查方法列一下，先从FastCGI配置入手：
      <a href="/2009/12/30/502-error-in-nginx" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/27/zz-diff-cdn-between-china-and-usa" title="看上去很美——国内CDN现状与美国对比（转）" rel="bookmark">看上去很美——国内CDN现状与美国对比（转）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-27 00:00:00 +0800">27 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>遵嘱注明：本文转载自：<a href="http://www.php-oa.com">扶凯</a>
原链接:<a href="http://blog.csdn.net/fayu0903/archive/2009/03/25/4022979.aspx">http://blog.csdn.net/fayu0903/archive/2009/03/25/4022979.aspx</a>
      <a href="/2009/12/27/zz-diff-cdn-between-china-and-usa" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/13/show-some-common-apps-compiler-options" title="查看一些常见应用的编译选项" rel="bookmark">查看一些常见应用的编译选项</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-13 00:00:00 +0800">13 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <ul>
  <li>nginx：</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>rao@localhost ~<span class="o">]</span><span class="nv">$ </span>/home/nginx/sbin/nginx -V<span class="p">|</span>grep conf
nginx version: 0.7.54
built by gcc 4.1.2 <span class="m">20080704</span> <span class="o">(</span>Red Hat 4.1.2-44<span class="o">)</span>
configure arguments: --prefix<span class="o">=</span>/home/nginx --with-pcre
--with-http_stub_status_module --without-http_memcached_module
--without-http_fastcgi_module
apache:
<span class="o">[</span>rao@localhost ~<span class="o">]</span><span class="nv">$ </span>cat /home/apache2/build/config.nice
<span class="c">#! /bin/sh</span>
<span class="c">#</span>
<span class="c"># Created by configure</span>
<span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&quot;</span><span class="p">;</span> <span class="nb">export</span>
CFLAGS
<span class="s2">&quot;./configure&quot;</span>
<span class="s2">&quot;--prefix=/home/apache2&quot;</span>
<span class="s2">&quot;--enable-static-support&quot;</span>
<span class="s2">&quot;--enable-rewrite&quot;</span>
<span class="s2">&quot;--with-mpm=worker&quot;</span>
<span class="s2">&quot;--enable-logio&quot;</span>
<span class="s2">&quot;--enable-so&quot;</span>
<span class="s2">&quot;--enable-mime-magic&quot;</span>
<span class="s2">&quot;--disable-cgid&quot;</span>
<span class="s2">&quot;--disable-cgi&quot;</span>
<span class="s2">&quot;--disable-userdir&quot;</span>
<span class="s2">&quot;--disable-dir&quot;</span>
<span class="s2">&quot;--disable-include&quot;</span>
<span class="s2">&quot;--disable-filter&quot;</span>
<span class="s2">&quot;--disable-env&quot;</span>
<span class="s2">&quot;--disable-setenvif&quot;</span>
<span class="s2">&quot;--disable-status&quot;</span>
<span class="s2">&quot;--disable-autoindex&quot;</span>
<span class="s2">&quot;--disable-asis&quot;</span>
<span class="s2">&quot;--disable-alias&quot;</span>
<span class="s2">&quot;--disable-actions&quot;</span>
<span class="s2">&quot;--disable-authn-file&quot;</span>
<span class="s2">&quot;--disable-authn-default&quot;</span>
<span class="s2">&quot;--disable-authz-default&quot;</span>
<span class="s2">&quot;--disable-authz-groupfile&quot;</span>
<span class="s2">&quot;--disable-authz-user&quot;</span>
<span class="s2">&quot;--disable-auth-basic&quot;</span>
<span class="s2">&quot;CFLAGS=-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&quot;</span>
<span class="s2">&quot;$@&quot;</span></code></pre></div>
<ul>
  <li>php:</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>rao@localhost ~<span class="o">]</span><span class="nv">$ </span>php -i<span class="p">|</span>grep configure
Configure <span class="nv">Command</span> <span class="o">=</span>&gt;  <span class="s1">&#39;./configure&#39;</span>
<span class="s1">&#39;--build=x86_64-redhat-linux-gnu&#39;</span> <span class="s1">&#39;--host=x86_64-redhat-linux-gnu&#39;</span>
<span class="s1">&#39;--target=x86_64-redhat-linux-gnu&#39;</span> <span class="s1">&#39;--program-prefix=&#39;</span>
<span class="s1">&#39;--prefix=/usr&#39;</span> <span class="s1">&#39;--exec-prefix=/usr&#39;</span> <span class="s1">&#39;--bindir=/usr/bin&#39;</span>
<span class="s1">&#39;--sbindir=/usr/sbin&#39;</span> <span class="s1">&#39;--sysconfdir=/etc&#39;</span> <span class="s1">&#39;--datadir=/usr/share&#39;</span>
<span class="s1">&#39;--includedir=/usr/include&#39;</span> <span class="s1">&#39;--libdir=/usr/lib64&#39;</span>
<span class="s1">&#39;--libexecdir=/usr/libexec&#39;</span> <span class="s1">&#39;--localstatedir=/var&#39;</span>
<span class="s1">&#39;--sharedstatedir=/usr/com&#39;</span> <span class="s1">&#39;--mandir=/usr/share/man&#39;</span>
<span class="s1">&#39;--infodir=/usr/share/info&#39;</span> <span class="s1">&#39;--cache-file=../config.cache&#39;</span>
<span class="s1">&#39;--with-libdir=lib64&#39;</span> <span class="s1">&#39;--with-config-file-path=/etc&#39;</span>
<span class="s1">&#39;--with-config-file-scan-dir=/etc/php.d&#39;</span> <span class="s1">&#39;--disable-debug&#39;</span>
<span class="s1">&#39;--with-pic&#39;</span> <span class="s1">&#39;--disable-rpath&#39;</span> <span class="s1">&#39;--without-pear&#39;</span> <span class="s1">&#39;--with-bz2&#39;</span>
<span class="s1">&#39;--with-curl&#39;</span> <span class="s1">&#39;--with-exec-dir=/usr/bin&#39;</span> <span class="s1">&#39;--with-freetype-dir=/usr&#39;</span>
<span class="s1">&#39;--with-png-dir=/usr&#39;</span> <span class="s1">&#39;--enable-gd-native-ttf&#39;</span> <span class="s1">&#39;--without-gdbm&#39;</span>
<span class="s1">&#39;--with-gettext&#39;</span> <span class="s1">&#39;--with-gmp&#39;</span> <span class="s1">&#39;--with-iconv&#39;</span> <span class="s1">&#39;--with-jpeg-dir=/usr&#39;</span>
<span class="s1">&#39;--with-openssl&#39;</span> <span class="s1">&#39;--with-png&#39;</span> <span class="s1">&#39;--with-pspell&#39;</span>
<span class="s1">&#39;--with-expat-dir=/usr&#39;</span> <span class="s1">&#39;--with-pcre-regex=/usr&#39;</span> <span class="s1">&#39;--with-zlib&#39;</span>
<span class="s1">&#39;--with-layout=GNU&#39;</span> <span class="s1">&#39;--enable-exif&#39;</span> <span class="s1">&#39;--enable-ftp&#39;</span>
<span class="s1">&#39;--enable-magic-quotes&#39;</span> <span class="s1">&#39;--enable-sockets&#39;</span> <span class="s1">&#39;--enable-sysvsem&#39;</span>
<span class="s1">&#39;--enable-sysvshm&#39;</span> <span class="s1">&#39;--enable-sysvmsg&#39;</span> <span class="s1">&#39;--enable-track-vars&#39;</span>
<span class="s1">&#39;--enable-trans-sid&#39;</span> <span class="s1">&#39;--enable-yp&#39;</span> <span class="s1">&#39;--enable-wddx&#39;</span>
<span class="s1">&#39;--with-kerberos&#39;</span> <span class="s1">&#39;--enable-ucd-snmp-hack&#39;</span>
<span class="s1">&#39;--with-unixODBC=shared,/usr&#39;</span> <span class="s1">&#39;--enable-memory-limit&#39;</span>
<span class="s1">&#39;--enable-shmop&#39;</span> <span class="s1">&#39;--enable-calendar&#39;</span> <span class="s1">&#39;--enable-dbx&#39;</span> <span class="s1">&#39;--enable-dio&#39;</span>
<span class="s1">&#39;--with-mime-magic=/usr/share/file/magic.mime&#39;</span> <span class="s1">&#39;--without-sqlite&#39;</span>
<span class="s1">&#39;--with-libxml-dir=/usr&#39;</span> <span class="s1">&#39;--with-xml&#39;</span> <span class="s1">&#39;--with-system-tzdata&#39;</span>
<span class="s1">&#39;--enable-force-cgi-redirect&#39;</span> <span class="s1">&#39;--enable-pcntl&#39;</span> <span class="s1">&#39;--with-imap=shared&#39;</span>
<span class="s1">&#39;--with-imap-ssl&#39;</span> <span class="s1">&#39;--enable-mbstring=shared&#39;</span>
<span class="s1">&#39;--enable-mbstr-enc-trans&#39;</span> <span class="s1">&#39;--enable-mbregex&#39;</span>
<span class="s1">&#39;--with-ncurses=shared&#39;</span> <span class="s1">&#39;--with-gd=shared&#39;</span> <span class="s1">&#39;--enable-bcmath=shared&#39;</span>
<span class="s1">&#39;--enable-dba=shared&#39;</span> <span class="s1">&#39;--with-db4=/usr&#39;</span> <span class="s1">&#39;--with-xmlrpc=shared&#39;</span>
<span class="s1">&#39;--with-ldap=shared&#39;</span> <span class="s1">&#39;--with-ldap-sasl&#39;</span> <span class="s1">&#39;--with-mysql=shared,/usr&#39;</span>
<span class="s1">&#39;--with-mysqli=shared,/usr/bin/mysql_config&#39;</span> <span class="s1">&#39;--enable-dom=shared&#39;</span>
<span class="s1">&#39;--with-dom-xslt=/usr&#39;</span> <span class="s1">&#39;--with-dom-exslt=/usr&#39;</span>
<span class="s1">&#39;--with-pgsql=shared&#39;</span> <span class="s1">&#39;--with-snmp=shared,/usr&#39;</span>
<span class="s1">&#39;--enable-soap=shared&#39;</span> <span class="s1">&#39;--with-xsl=shared,/usr&#39;</span>
<span class="s1">&#39;--enable-xmlreader=shared&#39;</span> <span class="s1">&#39;--enable-xmlwriter=shared&#39;</span>
<span class="s1">&#39;--enable-fastcgi&#39;</span> <span class="s1">&#39;--enable-pdo=shared&#39;</span>
<span class="s1">&#39;--with-pdo-odbc=shared,unixODBC,/usr&#39;</span>
<span class="s1">&#39;--with-pdo-mysql=shared,/usr&#39;</span> <span class="s1">&#39;--with-pdo-pgsql=shared,/usr&#39;</span>
<span class="s1">&#39;--with-pdo-sqlite=shared,/usr&#39;</span> <span class="s1">&#39;--enable-dbase=shared&#39;</span></code></pre></div>
<ul>
  <li>mysql:
据网上都说是cat /usr/bin/mysqlbug|grep conf，但我这的结果是压根没用……</li>
</ul>
      <a href="/2009/12/13/show-some-common-apps-compiler-options" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/12/04/magic-of-quotes" title="引号的魔力" rel="bookmark">引号的魔力</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-12-04 00:00:00 +0800">04 Dec 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@neteasesquid1 ~<span class="o">]</span><span class="c"># i=1.2.3.4;awk -v OFS=&quot;tt&quot; &#39;BEGIN{print &#39;&quot;$i&quot;&#39;,&quot;&#39;&quot;$i&quot;&#39;&quot;,&quot;&#39;$i&#39;&quot;,&quot;&quot;&#39;$i&#39;&quot;&quot;}&#39;</span>
1.20.30.4
1.2.3.4
1.2.3.4
1.20.30.4</code></pre></div>
<p>以前用awk调用shell变量时，一般都是文字字符串，看不出什么问题来；今天突然用上ip，发现输出结果显示不正常。于是做了如上实验。
但是原因嘛，还是不知道……
继续做下一个实验：
      <a href="/2009/12/04/magic-of-quotes" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/11/23/sub-commands-in-sed" title="sed子命令集" rel="bookmark">sed子命令集</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-11-23 00:00:00 +0800">23 Nov 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>1．：
用法：
：lable
在脚本中标记一行，用于实现由b或t的控制转移。Label最多可以包含7个字符
      <a href="/2009/11/23/sub-commands-in-sed" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/11/22/a-dynamic-data-storage-solution-for-cdn-ubdp" title="一种CDN中的动态数据存储方案——UbDP" rel="bookmark">一种CDN中的动态数据存储方案——UbDP</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-11-22 00:00:00 +0800">22 Nov 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>上回百度到这篇文章，于是上维普下载了来看，为方便阅读，贴在这里。
      <a href="/2009/11/22/a-dynamic-data-storage-solution-for-cdn-ubdp" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/11/21/zz-nginx-compile-optimization-test" title="nginx编译优化压力测试（转）" rel="bookmark">nginx编译优化压力测试（转）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-11-21 00:00:00 +0800">21 Nov 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#nginx-ref" title="nginx" rel="category tag">nginx</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>默认nginx使用的GCC编译参数是-O，需要更加优化可以使用以下两个参数：
      <a href="/2009/11/21/zz-nginx-compile-optimization-test" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/11/21/squidclient-usage" title="squidclient用法" rel="bookmark">squidclient用法</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-11-21 00:00:00 +0800">21 Nov 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>squidclient是squid自带的一个小工具，一般用的最多的，就是-m purge URL了。
其实还有别的用法（看看help吧，不过这个慢慢来~~）先说一个大全式的用法（其他的具体用法，大不了用这里rep出来好了）：squidclient -p 80 mgr:info，显示如下：
      <a href="/2009/11/21/squidclient-usage" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2009/11/21/show-full-path-in-squid-access-log" title="让squid访问日志显示完整url" rel="bookmark">让squid访问日志显示完整url</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2009-11-21 00:00:00 +0800">21 Nov 2009</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#squid-ref" title="squid" rel="category tag">squid</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>一大串的header结束了，从上篇开始回到squid.conf本身的设置上来。
      <a href="/2009/11/21/show-full-path-in-squid-access-log" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
    <li>
      <a href="/page16">Previous</a>
    </li>
    <li class="page">
      <a href="/">1</a>
    </li>
    <li class="page">
      <a href="/page2">2</a>
    </li>
    <li class="page">
      <a href="/page3">3</a>
    </li>
    <li class="page">
      <a href="/page4">4</a>
    </li>
    <li class="page">
      <a href="/page5">5</a>
    </li>
    <li class="page">
      <a href="/page6">6</a>
    </li>
    <li class="page">
      <a href="/page7">7</a>
    </li>
    <li class="page">
      <a href="/page8">8</a>
    </li>
    <li class="page">
      <a href="/page9">9</a>
    </li>
    <li class="page">
      <a href="/page10">10</a>
    </li>
    <li class="page">
      <a href="/page11">11</a>
    </li>
    <li class="page">
      <a href="/page12">12</a>
    </li>
    <li class="page">
      <a href="/page13">13</a>
    </li>
    <li class="page">
      <a href="/page14">14</a>
    </li>
    <li class="page">
      <a href="/page15">15</a>
    </li>
    <li class="page">
      <a href="/page16">16</a>
    </li>
    <li class="page active">
      <a href="#">17</a>
    </li>
    <li class="page">
      <a href="/page18">18</a>
    </li>
    <li class="page">
      <a href="/page19">19</a>
    </li>
    <li>
      <a href="/page18">Next</a>
    </li>
  </ul>
</div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(英文)</li>
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
              <li><a href="http://neilb.org/" title="The good,the bad,and the beautiful">neilb</a></li>
              <li><a href="http://www.reddit.com/r/perl/" title="">reddit perl 频道</a></li>
              <li><a href="http://jpetazzo.github.io/" title="">~jpetazzo</a></li>
              <li><a href="http://www.perfplanet.com/" title="News and views from the web performance blogosphere">Performance Planet</a></li>
              <li><a href="http://cuddletech.com/blog/" title="Use UNIX or die">Cuddle Tech</a></li>
              <li><a href="http://showmetheco.de/" title="Viacheslav Tykhanovskyi(PocketIO/Text::Haml)">No time to wait</a></li>
              <li><a href="http://blog.dataloop.io/" title="A new SaaS monitoring tool for DevOps & Operations">Dataloop.IO</a></li>
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
              <li><a href="http://planeteria.org/perl6/" title="Perl6 文集">Planet Perl 6</a></li>
              <li><a href="http://www.metaforsoftware.com/blog/" title="">metafor</a></li>
              <li><a href="http://blog.kablamo.org/" title="Eric Johnson，一个游走在伦敦和北京的 Perler">kablamo</a></li>
              <li><a href="http://aphyr.com/posts" title="call me maybe 吐槽系列">Aphyr</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(中文)</li>
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
              <li><a href="http://timo.piqiu.me/" title="TIMO IS MY OASIS">Timo</a></li>
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
              <li><a href="http://www.lark.net.cn/" title="王剑">lark's cloud</a></li>
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
              <li><a href="http://blog.liulantao.com/" title="刘兰涛">Lax</a></li>
              <li><a href="http://niubie.me/" title="莫言">莫言</a></li>
              <li><a href="http://noops.me/" title="小米运维部">NoOps</a></li>
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
              <li><a href="http://www.usefulshare.com" title="当当网安全运维">UsefulShare</a></li>
              <li><a href="http://junqili.com/" title="深入研究puppet">纸飞机</a></li>
              <li><a href="http://www.chinaxing.org/" title="">ChinaXing</a></li>
              <li><a href="http://bubbyroom.com/" title="守住每一天">Liuyu's blog</a></li>
              <li><a href="http://blog.aka-cool.net/" title="">Aka.Why</a></li>
              <li><a href="http://blog.l8ii.com/" title="刘侨">LairdNote</a></li>
              <li><a href="http://flw.tools/" title="">flw的工具箱</a></li>
              <li><a href="http://blog.mcshell.org/" title="">mcshell</a></li>
              <li><a href="http://novoland.github.io/" title="">克鲁斯卡尔的博客</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="booklists" class="nav nav-list">
          <li class="nav-header">我写的技术书籍</li>
          <li><a href='http://product.china-pub.com/3769604'><img src='http://images.china-pub.com/ebook3765001-3770000/3769604/shupi.jpg' border='0' alt='网站运维技术与实践'/></a></li>
          <li class="nav-header">我参与翻译的技术书籍</li>
          <li><a href='http://product.china-pub.com/4582714'><img src='http://images.china-pub.com/ebook4580001-4585000/4582714/shupi.jpg' border='0' alt='Puppet 实战手册'/></a></li>
          <li class="nav-header">我写的电子书籍</li>
          <li><a href='http://chenryn.gitbooks.io/logstash-best-practice/'><img src='https://sm3lir.cloudimage.io/s/cdn/x/https://www.gitbook.io/cover/book/chenryn/logstash-best-practice?build=1416299695472' border='0' alt='LogStash 最佳实践'/></a></li>
          <li><a href='http://kibana.logstash.es/'><img src='https://sm3lir.cloudimage.io/s/cdn/x/https://www.gitbook.io/cover/book/chenryn/kibana-guide-cn?build=1415872457562' border='0' alt='Kibana 中文指南'/></a></li>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2015 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
  </body>
</html>
