<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>mysqlreport指南</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">归档</a></li>
      	<li><a href="/categories.html">分类</a></li>
      	<li><a href="/errata.html">《网站运维技术与实践》勘误</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/projects.html">学习记录</a></li>
      	<li><a href="/tags.html">标签</a></li>
            <li><a href="http://chenlinux.com/poetry/index.html" />诗文集</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="page-header">
    <h1>mysqlreport指南 <small></small></h1>
    <div class="date"><span>10 January 2011</span></div>
    <ul class="tag_box pull-right">
    	<li><a href="/tags.html#MySQL-ref">MySQL <span>9</span></a></li>
    </ul>
  </div>
  <div style='background-color: #FFF;'>
    <p>mysqlreport是mysql性能监测时最常用的工具，对了解mysql运行状态和配置调整都有很大的帮助。找了一些mysql的资料，发现大多数是关于php+mysql开发的，服务配置基本就是固定的几条。干脆找上mysqlreport的官网，啃下来这篇指南。翻译都是随着我个人的语言习惯，对直接能用mysql命令上看到结果的英文则保留下来。方便以后查找：</p>
<p>原文地址：<a href="http://hackmysql.com/mysqlreportguide">http://hackmysql.com/mysqlreportguide</a></p>
<h1 id="mysqlreport">《mysqlreport指南》</h1>
<p>本指南的写作目的是解释mysqlreport上出具的各种数据。通过指南，你可以在阅读完mysqlreport的报告后，完整的解释并且理解一个最根本的问题——而这也正是你使用mysqlreport的目的所在——（我的）MySQL服务器到底运行的怎么样？</p>
<p>当前的mysqlreport版本会自动生成一份尽可能完整的数据报表，最多可达14节121行。您不必再像以前那样输入各种各样的参数定义了。不过如果您的mysql服务配置上关闭了某些部分的话，报表的相关部分也会随之关闭。比如，你关闭了<code>query cache</code>，那么mysqlreport的第4节&rsquo;Query Cache&rsquo;也就不存在了。所以报表长度是浮动的。</p>
<p>为了便于理解和观察，本指南采用了对一份完整报表做出逐行解释的方法。下面就是将要被详细解析的那份报表，为了方便，在最前端加上了行号。</p>
<div class="highlight"><pre><code class="language-mysql" data-lang="mysql"><span class="mi">1</span> <span class="n">MySQL</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span>              <span class="n">uptime</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">26</span>       <span class="n">Fri</span> <span class="n">Sep</span>  <span class="mi">1</span> <span class="mi">19</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">02</span> <span class="mi">2006</span>
<span class="mi">2</span>
<span class="mi">3</span> <span class="n">__</span> <span class="k">Key</span> <span class="n">_________________________________________________________________</span>
<span class="mi">4</span> <span class="n">Buffer</span> <span class="n">used</span>   <span class="mi">380</span><span class="p">.</span><span class="mi">00</span><span class="n">k</span> <span class="n">of</span> <span class="mi">512</span><span class="p">.</span><span class="mi">00</span><span class="n">M</span>  <span class="o">%</span><span class="n">Used</span><span class="p">:</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">07</span>
<span class="mi">5</span>   <span class="n">Current</span>      <span class="mi">59</span><span class="p">.</span><span class="mi">32</span><span class="n">M</span>            <span class="o">%</span><span class="k">Usage</span><span class="p">:</span>  <span class="mi">11</span><span class="p">.</span><span class="mi">59</span>
<span class="mi">6</span> <span class="k">Write</span> <span class="n">hit</span>      <span class="mi">97</span><span class="p">.</span><span class="mi">04</span><span class="o">%</span>
<span class="mi">7</span> <span class="k">Read</span> <span class="n">hit</span>       <span class="mi">99</span><span class="p">.</span><span class="mi">58</span><span class="o">%</span>
<span class="mi">8</span>
<span class="mi">9</span> <span class="n">__</span> <span class="n">Questions</span> <span class="n">___________________________________________________________</span>
<span class="mi">10</span> <span class="n">Total</span>          <span class="mi">98</span><span class="p">.</span><span class="mi">06</span><span class="n">k</span>   <span class="mi">47</span><span class="p">.</span><span class="mi">46</span><span class="o">/</span><span class="n">s</span>
<span class="mi">11</span>   <span class="n">DMS</span>          <span class="mi">81</span><span class="p">.</span><span class="mi">23</span><span class="n">k</span>   <span class="mi">39</span><span class="p">.</span><span class="mi">32</span><span class="o">/</span><span class="n">s</span>  <span class="o">%</span><span class="n">Total</span><span class="p">:</span>  <span class="mi">82</span><span class="p">.</span><span class="mi">84</span>
<span class="mi">12</span>   <span class="n">QC</span> <span class="n">Hits</span>      <span class="mi">16</span><span class="p">.</span><span class="mi">58</span><span class="n">k</span>    <span class="mi">8</span><span class="p">.</span><span class="mi">02</span><span class="o">/</span><span class="n">s</span>           <span class="mi">16</span><span class="p">.</span><span class="mi">91</span>
<span class="mi">13</span>   <span class="n">COM_QUIT</span>        <span class="mi">200</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">10</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">20</span>
<span class="mi">14</span>   <span class="n">Com_</span>            <span class="mi">131</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">06</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">13</span>
<span class="mi">15</span>   <span class="o">-</span><span class="n">Unknown</span>         <span class="mi">82</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">04</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">08</span>
<span class="mi">16</span> <span class="n">Slow</span> <span class="mi">5</span> <span class="n">s</span>            <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>  <span class="o">%</span><span class="n">DMS</span><span class="p">:</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>  <span class="n">Log</span><span class="p">:</span>  <span class="k">ON</span>
<span class="mi">17</span> <span class="n">DMS</span>            <span class="mi">81</span><span class="p">.</span><span class="mi">23</span><span class="n">k</span>   <span class="mi">39</span><span class="p">.</span><span class="mi">32</span><span class="o">/</span><span class="n">s</span>           <span class="mi">82</span><span class="p">.</span><span class="mi">84</span>
<span class="mi">18</span>   <span class="k">SELECT</span>       <span class="mi">64</span><span class="p">.</span><span class="mi">44</span><span class="n">k</span>   <span class="mi">31</span><span class="p">.</span><span class="mi">19</span><span class="o">/</span><span class="n">s</span>           <span class="mi">65</span><span class="p">.</span><span class="mi">72</span>         <span class="mi">79</span><span class="p">.</span><span class="mi">33</span>
<span class="mi">19</span>   <span class="k">INSERT</span>       <span class="mi">16</span><span class="p">.</span><span class="mi">75</span><span class="n">k</span>    <span class="mi">8</span><span class="p">.</span><span class="mi">11</span><span class="o">/</span><span class="n">s</span>           <span class="mi">17</span><span class="p">.</span><span class="mi">08</span>         <span class="mi">20</span><span class="p">.</span><span class="mi">61</span>
<span class="mi">20</span>   <span class="k">UPDATE</span>           <span class="mi">41</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">04</span>          <span class="mi">0</span><span class="p">.</span><span class="mi">05</span>
<span class="mi">21</span>   <span class="k">REPLACE</span>           <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>          <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">22</span>   <span class="k">DELETE</span>            <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>          <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">23</span> <span class="n">Com_</span>              <span class="mi">131</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">06</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">13</span>
<span class="mi">24</span>   <span class="n">change_db</span>       <span class="mi">119</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">06</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">12</span>
<span class="mi">25</span>   <span class="n">show_fields</span>       <span class="mi">9</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">01</span>
<span class="mi">26</span>   <span class="n">show_status</span>       <span class="mi">2</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">27</span>
<span class="mi">28</span> <span class="n">__</span> <span class="k">SELECT</span> <span class="k">and</span> <span class="n">Sort</span> <span class="n">_____________________________________________________</span>
<span class="mi">29</span> <span class="n">Scan</span>               <span class="mi">38</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="o">/</span><span class="n">s</span> <span class="o">%</span><span class="k">SELECT</span><span class="p">:</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">06</span>
<span class="mi">30</span> <span class="n">Range</span>              <span class="mi">14</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">02</span>
<span class="mi">31</span> <span class="n">Full</span> <span class="k">join</span>           <span class="mi">3</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">32</span> <span class="n">Range</span> <span class="k">check</span>         <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">33</span> <span class="n">Full</span> <span class="n">rng</span> <span class="k">join</span>       <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">34</span> <span class="n">Sort</span> <span class="n">scan</span>          <span class="mi">14</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="o">/</span><span class="n">s</span>
<span class="mi">35</span> <span class="n">Sort</span> <span class="n">range</span>         <span class="mi">26</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="o">/</span><span class="n">s</span>
<span class="mi">36</span> <span class="n">Sort</span> <span class="n">mrg</span> <span class="n">pass</span>       <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">37</span>
<span class="mi">38</span> <span class="n">__</span> <span class="n">Query</span> <span class="n">Cache</span> <span class="n">_________________________________________________________</span>
<span class="mi">39</span> <span class="n">Memory</span> <span class="k">usage</span>   <span class="mi">17</span><span class="p">.</span><span class="mi">81</span><span class="n">M</span> <span class="n">of</span>  <span class="mi">32</span><span class="p">.</span><span class="mi">00</span><span class="n">M</span>  <span class="o">%</span><span class="n">Used</span><span class="p">:</span>  <span class="mi">55</span><span class="p">.</span><span class="mi">66</span>
<span class="mi">40</span> <span class="n">Block</span> <span class="n">Fragmnt</span>  <span class="mi">13</span><span class="p">.</span><span class="mi">05</span><span class="o">%</span>
<span class="mi">41</span> <span class="n">Hits</span>           <span class="mi">16</span><span class="p">.</span><span class="mi">58</span><span class="n">k</span>    <span class="mi">8</span><span class="p">.</span><span class="mi">02</span><span class="o">/</span><span class="n">s</span>
<span class="mi">42</span> <span class="n">Inserts</span>        <span class="mi">48</span><span class="p">.</span><span class="mi">50</span><span class="n">k</span>   <span class="mi">23</span><span class="p">.</span><span class="mi">48</span><span class="o">/</span><span class="n">s</span>
<span class="mi">43</span> <span class="n">Prunes</span>         <span class="mi">33</span><span class="p">.</span><span class="mi">46</span><span class="n">k</span>   <span class="mi">16</span><span class="p">.</span><span class="mi">20</span><span class="o">/</span><span class="n">s</span>
<span class="mi">44</span> <span class="n">Insrt</span><span class="p">:</span><span class="n">Prune</span>    <span class="mi">1</span><span class="p">.</span><span class="mi">45</span><span class="p">:</span><span class="mi">1</span>    <span class="mi">7</span><span class="p">.</span><span class="mi">28</span><span class="o">/</span><span class="n">s</span>
<span class="mi">45</span> <span class="n">Hit</span><span class="p">:</span><span class="k">Insert</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">34</span><span class="p">:</span><span class="mi">1</span>
<span class="mi">46</span>
<span class="mi">47</span> <span class="n">__</span> <span class="k">Table</span> <span class="n">Locks</span> <span class="n">_________________________________________________________</span>
<span class="mi">48</span> <span class="n">Waited</span>          <span class="mi">1</span><span class="p">.</span><span class="mi">01</span><span class="n">k</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">49</span><span class="o">/</span><span class="n">s</span>  <span class="o">%</span><span class="n">Total</span><span class="p">:</span>   <span class="mi">1</span><span class="p">.</span><span class="mi">24</span>
<span class="mi">49</span> <span class="n">Immediate</span>      <span class="mi">80</span><span class="p">.</span><span class="mi">04</span><span class="n">k</span>   <span class="mi">38</span><span class="p">.</span><span class="mi">74</span><span class="o">/</span><span class="n">s</span>
<span class="mi">50</span>
<span class="mi">51</span> <span class="n">__</span> <span class="kp">Tables</span> <span class="n">______________________________________________________________</span>
<span class="mi">52</span> <span class="n">Open</span>              <span class="mi">107</span> <span class="n">of</span> <span class="mi">1024</span>    <span class="o">%</span><span class="n">Cache</span><span class="p">:</span>  <span class="mi">10</span><span class="p">.</span><span class="mi">45</span>
<span class="mi">53</span> <span class="n">Opened</span>            <span class="mi">118</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">06</span><span class="o">/</span><span class="n">s</span>
<span class="mi">54</span>
<span class="mi">55</span> <span class="n">__</span> <span class="n">Connections</span> <span class="n">_________________________________________________________</span>
<span class="mi">56</span> <span class="n">Max</span> <span class="n">used</span>           <span class="mi">77</span> <span class="n">of</span>  <span class="mi">600</span>      <span class="o">%</span><span class="n">Max</span><span class="p">:</span>  <span class="mi">12</span><span class="p">.</span><span class="mi">83</span>
<span class="mi">57</span> <span class="n">Total</span>             <span class="mi">202</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">10</span><span class="o">/</span><span class="n">s</span>
<span class="mi">58</span>
<span class="mi">59</span> <span class="n">__</span> <span class="n">Created</span> <span class="n">Temp</span> <span class="n">________________________________________________________</span>
<span class="mi">60</span> <span class="n">Disk</span> <span class="k">table</span>         <span class="mi">10</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">61</span> <span class="k">Table</span>              <span class="mi">26</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="o">/</span><span class="n">s</span>    <span class="n">Size</span><span class="p">:</span>  <span class="mi">4</span><span class="p">.</span><span class="mi">00</span><span class="n">M</span>
<span class="mi">62</span> <span class="n">File</span>                <span class="mi">3</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">63</span>
<span class="mi">64</span> <span class="n">__</span> <span class="n">Threads</span> <span class="n">_____________________________________________________________</span>
<span class="mi">65</span> <span class="n">Running</span>            <span class="mi">55</span> <span class="n">of</span>   <span class="mi">77</span>
<span class="mi">66</span> <span class="n">Cache</span>               <span class="mi">0</span>              <span class="o">%</span><span class="n">Hit</span><span class="p">:</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">5</span>
<span class="mi">67</span> <span class="n">Created</span>           <span class="mi">201</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">10</span><span class="o">/</span><span class="n">s</span>
<span class="mi">68</span> <span class="n">Slow</span>                <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">69</span>
<span class="mi">70</span> <span class="n">__</span> <span class="n">Aborted</span> <span class="n">_____________________________________________________________</span>
<span class="mi">71</span> <span class="n">Clients</span>             <span class="mi">0</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">72</span> <span class="n">Connects</span>            <span class="mi">8</span>    <span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="o">/</span><span class="n">s</span>
<span class="mi">73</span>
<span class="mi">74</span> <span class="n">__</span> <span class="n">Bytes</span> <span class="n">_______________________________________________________________</span>
<span class="mi">75</span> <span class="n">Sent</span>           <span class="mi">38</span><span class="p">.</span><span class="mi">46</span><span class="n">M</span>  <span class="mi">18</span><span class="p">.</span><span class="mi">62</span><span class="n">k</span><span class="o">/</span><span class="n">s</span>
<span class="mi">76</span> <span class="n">Received</span>        <span class="mi">7</span><span class="p">.</span><span class="mi">98</span><span class="n">M</span>   <span class="mi">3</span><span class="p">.</span><span class="mi">86</span><span class="n">k</span><span class="o">/</span><span class="n">s</span>
<span class="mi">77</span>
<span class="mi">78</span> <span class="n">__</span> <span class="n">InnoDB</span> <span class="n">Buffer</span> <span class="n">Pool</span> <span class="n">__________________________________________________</span>
<span class="mi">79</span> <span class="k">Usage</span>           <span class="mi">3</span><span class="p">.</span><span class="mi">95</span><span class="n">M</span> <span class="n">of</span>   <span class="mi">7</span><span class="p">.</span><span class="mi">00</span><span class="n">M</span>  <span class="o">%</span><span class="n">Used</span><span class="p">:</span>  <span class="mi">56</span><span class="p">.</span><span class="mi">47</span>
<span class="mi">80</span> <span class="k">Read</span> <span class="n">hit</span>       <span class="mi">99</span><span class="p">.</span><span class="mi">99</span><span class="o">%</span>
<span class="mi">81</span> <span class="n">Pages</span>
<span class="mi">82</span>   <span class="n">Free</span>            <span class="mi">195</span>            <span class="o">%</span><span class="n">Total</span><span class="p">:</span>  <span class="mi">43</span><span class="p">.</span><span class="mi">53</span>
<span class="mi">83</span>   <span class="n">Data</span>            <span class="mi">249</span>                     <span class="mi">55</span><span class="p">.</span><span class="mi">58</span> <span class="o">%</span><span class="n">Drty</span><span class="p">:</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">84</span>   <span class="n">Misc</span>              <span class="mi">4</span>                      <span class="mi">0</span><span class="p">.</span><span class="mi">89</span>
<span class="mi">85</span>   <span class="n">Latched</span>           <span class="mi">0</span>                      <span class="mi">0</span><span class="p">.</span><span class="mi">00</span>
<span class="mi">86</span> <span class="k">Reads</span>         <span class="mi">574</span><span class="p">.</span><span class="mi">56</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">s</span>
<span class="mi">87</span>   <span class="k">From</span> <span class="n">file</span>       <span class="mi">176</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>            <span class="mi">0</span><span class="p">.</span><span class="mi">03</span>
<span class="mi">88</span>   <span class="n">Ahead</span> <span class="n">Rnd</span>         <span class="mi">4</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">89</span>   <span class="n">Ahead</span> <span class="k">Sql</span>         <span class="mi">2</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">90</span> <span class="n">Writes</span>        <span class="mi">160</span><span class="p">.</span><span class="mi">82</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">2</span><span class="o">/</span><span class="n">s</span>
<span class="mi">91</span> <span class="n">Flushes</span>         <span class="mi">1</span><span class="p">.</span><span class="mi">04</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">92</span> <span class="n">Wait</span> <span class="n">Free</span>           <span class="mi">0</span>       <span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">93</span>
<span class="mi">94</span> <span class="n">__</span> <span class="n">InnoDB</span> <span class="k">Lock</span> <span class="n">_________________________________________________________</span>
<span class="mi">95</span> <span class="n">Waits</span>               <span class="mi">0</span>       <span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">96</span> <span class="n">Current</span>             <span class="mi">0</span>
<span class="mi">97</span> <span class="kt">Time</span> <span class="n">acquiring</span>
<span class="mi">98</span>   <span class="n">Total</span>             <span class="mi">0</span> <span class="n">ms</span>
<span class="mi">99</span>   <span class="n">Average</span>           <span class="mi">0</span> <span class="n">ms</span>
<span class="mi">100</span>  <span class="n">Max</span>               <span class="mi">0</span> <span class="n">ms</span>
<span class="mi">101</span>
<span class="mi">102</span> <span class="n">__</span> <span class="n">InnoDB</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Pages</span><span class="p">,</span> <span class="n">Rows</span> <span class="n">____________________________________________</span>
<span class="mi">103</span> <span class="n">Data</span>
<span class="mi">104</span>   <span class="k">Reads</span>           <span class="mi">225</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">105</span>   <span class="n">Writes</span>          <span class="mi">799</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">106</span>   <span class="n">fsync</span>           <span class="mi">541</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">107</span>   <span class="n">Pending</span>
<span class="mi">108</span>     <span class="k">Reads</span>           <span class="mi">0</span>
<span class="mi">109</span>     <span class="n">Writes</span>          <span class="mi">0</span>
<span class="mi">110</span>     <span class="n">fsync</span>           <span class="mi">0</span>
<span class="mi">111</span>
<span class="mi">112</span> <span class="n">Pages</span>
<span class="mi">113</span>   <span class="n">Created</span>          <span class="mi">23</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">114</span>   <span class="k">Read</span>            <span class="mi">226</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">115</span>   <span class="n">Written</span>       <span class="mi">1</span><span class="p">.</span><span class="mi">04</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">116</span>
<span class="mi">117</span> <span class="n">Rows</span>
<span class="mi">118</span>   <span class="n">Deleted</span>      <span class="mi">25</span><span class="p">.</span><span class="mi">04</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">119</span>   <span class="n">Inserted</span>     <span class="mi">25</span><span class="p">.</span><span class="mi">04</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">s</span>
<span class="mi">120</span>   <span class="k">Read</span>         <span class="mi">81</span><span class="p">.</span><span class="mi">91</span><span class="n">k</span>     <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="n">s</span>
<span class="mi">121</span>   <span class="n">Updated</span>           <span class="mi">0</span>       <span class="mi">0</span><span class="o">/</span><span class="n">s</span></code></pre></div>
<h1 id="section">报表抬头：第1行</h1>
<p>本行包括三部分信息：MySQL版本，MySQL运行时间，服务器当前时间。显示版本是为了提醒有些功能可能这台mysql没有；显示运行时间是为了评估报表数据的精准度。事实上，如果一台mysql运行时间连几个小时都没有的，生成的很可能是一份扭曲并且充满误导意见的报表。甚至几个小时都不够，因为它可能是在半夜没啥访问量的时候运行的几个小时。所以建议最少要运行过一个24小时，时间越长越能反应真实情况。
在本例中，运行时间只有34分钟，所以报表也不具有真实的代表意义。</p>
<h1 id="section-1">索引报表：3-7行</h1>
<p>索引报表是第一个主要章节，因为索引(key或者说index)对于mysql数据库，是最最最重要的。虽然报表不可能直接告诉你这个库的索引好还是不好，但它能告诉你这个索引缓冲区(key buffer)被利用的怎么样了。
注意：本报表仅汇总默认的MyISAM表的共享key buffer信息，而不会管管理员自建的其他空间。</p>
<h1 id="section-2">缓冲区使用情况：第4行</h1>
<p>对于mysql，我们的第一个问题就是：到底用了多少key buffer？如果不太多，没问题~因为mysql只会在有需求的时候才分配系统内存给key buffer。也就是说，my.cnf中定义了<code>key_buffer_size=512M</code>，不代表mysql启动时就创建一个512M大小的key buffer。</p>
<p>本行显示的，是mysql曾经使用过的key buffer峰值大小。而事实上，mysql应该用的更少，或者诡异的更多。这个更多的情况，mysql的术语叫“高水位”这个情况和my.cnf里的<code>key_buffer_size</code>是否足够大密切相关。当“水位”已经达到80-90%的时候，赶紧加大你的<code>key_buffer_size</code>吧。</p>
<p>注意：永远不用“担心”这个值超过95%，mysql文档指出，key buffer中的一部分会被mysql主程序用于内部数据结构，这些是mysqlreport无法统计的内容。所以，所谓的95%，其实已经是100%了……</p>
<h1 id="section-3">当前情况：第5行</h1>
<p>这行只有在mysql版本高于4.1.2时出现，因为之前mysql的<code>show status</code>中没有<code>key_blocks_unused</code>。这行数据显示的是mysql当前使用的key buffer大小。如果上行的used%太大的话，那么这行必然不会超过used，除非碰上那个传说中的bug了。综合这两行，相信对<code>key_buffer_size</code>的设置是否合理就有谱了~</p>
<p>本例中，mysql使用了60M的key buffer(12%)，这就很不错，离满负荷运行还早着呢。</p>
<h1 id="section-4">写命中：第6行</h1>
<p>从本质上说，索引是基于内存的。因为访问内存的速度比硬盘快太多了。不过，mysql从磁盘里进行一点点读写操作总是不可避免的。</p>
<p>这行数据显示了写索引的效率(具体意思是：写入磁盘的key与写入内存的key的比值)。这个值没有什么参考答案，而是取决于业务类型。如果mysql主要执行的是update/insert之类的操作，那么正常比值接近0%；如果执行的select居多，那比值超过90%也是正常的。不过如果你看到的是一个负数，那说明mysql总是在往那个慢的要死的磁盘里写索引，这就很不妙了。</p>
<p>要想知道到底比值正常与否，请参考之后的DMS报表内容。</p>
<h1 id="section-5">读命中：第7行</h1>
<p>比写命中重要多了的就是读命中。同样，这个值就是读自磁盘的key与读自内存的比值。这个比值最好别低于99%！！再低就有问题了——很可能就是key buffer太小。mysql没法从内存里读到，只好找硬盘了……
当然，如果你刚重启过一次mysql，那在一两个小时内，命中率低一点也是正常的。</p>
<h1 id="section-6">请求报表：9-26行</h1>
<p>第二个主要章节。它展示了很多关于mysql在做什么以及做的怎么样的内容。请求(question)包括SQL查询(query)，也包括mysql协议通讯。大家经常关注的一个性能是mysql的qps(每秒执行查询数)。不过从一个更广泛的眼光看来，这个衡量标准其实是很随意的……mysql需要处理很多其他的请求。本报表试图展现的，就是这么一个更完整的内容。</p>
<h1 id="section-7">总值：第10行</h1>
<p>本行第一列，回答自运行起mysql一共处理多少请求，第二列，得出自运行起平均每秒钟处理多少请求。大家可能以为第二列这个值就是我们想要的qps了。但mysql真的做了这么多事情么？继续往下看。
（再次提醒大家注意questions和queries的区别）</p>
<h1 id="dtq11-15">查询的总体分布报表(DTQ)：第11-15行</h1>
<p>所有的请求都可以被粗略的分入五类：数据操作语句(DMS)，查询缓存命中(QC Hits)，COM_QUIT，其他的COM_命令以及其他未知的东东。接下来的五行分别显示这些，从大到小排列。这样你可以一眼看出mysql最重要的任务是什么了。一般的说，DMS和QCHits是主角，COM_是必须的，额，路人甲……</p>
<p>再详细解释每行之前，提示一下，第三列的比值分母是上面那行的总值。比如本例中DMS占到了82.84%就挺不错的。</p>
<p>DMS包括：select/insert/replace/update/delete(其他的比较偏门，mysqlreport干脆就排除他们了)。正常的说，mysql最应该做的事情，就是这些DMS了。详细内容见17-22行。</p>
<p><code>QC Hits</code>是mysql从查询缓存里直接获取结果的数量。我们梦寐以求的就是让这个命中率变高，因为这意味着mysql响应变的相当快。但这也意味着你必须接受一定的数据差异性。详细理由见QC报表中的insert/prune和hit/insert比值部分。</p>
<p>在本例中QC Hits达到了16.91%，看来很不错的样子。可别被这么一条数据迷惑了，38-45行的QC报表会给你一个完全不一样的结论。</p>
<p>COM_QUIT，嗯，凑数的。</p>
<p>COM_，如果这个值比较高的话，或许会有些问题，详见23-26行。</p>
<p>Unknown，理想情况下，有上面四个类别就够了。因为有时候，mysql处理了几个请求，却没有记录相应的操作数。所以Unknown有+-两种。+说明mysqlreport统计的多了，-就是少了。这个类别浮动性很大，某些特定情况下，可能会排名很靠前，不过最好还是在最底下吧。</p>
<h1 id="section-8">慢查询：第16行</h1>
<p>第16行非常重要，展示的是mysql执行的慢查询数。默认情况下，配置的<code>long_query_time</code>是10秒钟。事实上，大家都觉得这太长了，一般都改成1秒，甚至更短，mysql在版本5以后，支持到微妙us级别的。</p>
<p>配置的<code>long_query_time</code>会在&rsquo;Slow&rsquo;后面显示，默认8个字符，所以如果配置的是&rsquo;9.999999 ms&rsquo;，只会显示成&rsquo;999.999 &lsquo;，不过应该不会这么无聊吧~</p>
<p>理想情况下最好这里永远都是0，不过不太可能，多少还是有点。只要第三列的比例低于0.05%就行。</p>
<p>第四列，DMS中的slow比值；第五列，慢查询日志是否记录。强烈建议选择ON。</p>
<h1 id="dms17-22">DMS：17-22行</h1>
<p>和DTQ一样，第一行也是总值，其余内容也是动态排名。这部分内容可以解释mysql服务器偏重于什么类型：select还是insert，或者其他。一般来说会是select吧。明确这个问题，对我们理解其他数值有很大的帮助。比如说：一个insert型的mysql，他的写比率接近1.0，同时带来比较高的表锁。然后很可能用innodb表；一个select型的mysql则相反，读比率高，表锁少，而且很可能用的是MyISAM表。</p>
<p>本例就是一个select型的。65.72%的总请求是select(在DMS的比例提高到79.33%)，显然我们可以朝着select的方向进行优化了。</p>
<h1 id="com23-26">COM_：23-26行</h1>
<p>这部分内容都很直观，在mysql协议里都有，像 <code>com_change_db</code> ，一眼就知道是干嘛的。</p>
<p>如果在DTQ排名里COM_比较高，那说明mysql忙着干自己的事情而不是响应SQL查询。比如说，如果一台mysql的 <code>com_rollback</code> 高，可能糟糕了，你的事物回滚失败了。结合之前的DTQ报表分析这个东西吧~
一般这些东西不能出什么问题，不过时不时看一眼还是有必要的。</p>
<h1 id="selectsort28-36">select/sort报表：28-36行</h1>
<p>select和sort都是select_的内容。其中最主要的是29和31行：scan和full join。scan展示的是对全表进行扫描的select语句个数。full join和scan很像，除了它还出现于多表查询。程序联合多表进行全表扫描，听起来就慢的可怕……总之，对于这两个数值，只有更低，没有最低！</p>
<h1 id="qc38-45">QC报表：38-45行</h1>
<p>只有mysql版本支持QC并且my.cnf开启了QC的时候该报表才会出现。</p>
<h1 id="section-9">内存使用：39行</h1>
<p>如果内存使用的接近最大设置值，在更下面的Prune数据上也会有反应，因为QC里的查询会被踢出来。</p>
<h1 id="section-10">内存碎片：40行</h1>
<p>内存块碎片(block fragmnt)的详细解释参见《MYSQL手册》的5.14.3章节所述：</p>
<pre><code>`query_cache_min_res_unit` 的默认值是4KB，大多数情况下足够用了。如果你有一个返回超小结果的海量查询，默认的块大小(即4KB)可能会导致大量的内存碎片，同样也浪费了很多空闲内存块。因为内存不足，碎片会强制删除(prune，我也不知道为啥不叫delete或者purge)QC里的部分内容。这时候你就得降低这个 `query_cache_min_res_unit` 设置。至于空闲块和QC的删除阀值，分别由 `Qcache_free_blocks` 和 `Qcache_lowmem_prunes` 定义。
</code></pre>
<p>内存碎片的计算方法是空闲内存块除以总内存块数。比值越大，碎片越多，10-20%就已经超出平均水平了。</p>
<p>本例的13.05%还是可以接受的，不过最好还是检查一下 <code>query_cache_min_res_unit</code> 是不是能调调~</p>
<h1 id="hitsinsertsprunes41-43">Hits/Inserts/Prunes：41-43行</h1>
<p>Hits是最重要的，它反映了select有多少是从QC里获得的应答，当然越多越好。至于insert和prune，或许从44行的比值中更好理解一下。之前有提到prune多说明qc太小，当然这只是一种可能而已。</p>
<p>本例中，只有55%的QC被利用，而碎片又不是太高。prune达到每秒16次，比QCHits高了一倍！打个不太恰当的（这话我加的，感觉比直接理解技术更难懂的比喻）比方：这台mysql的QC就像苹果树一样，苹果还没摘呢，树枝已经被砍掉了……</p>
<h1 id="insertprunehitinsert44-45">insert/prune和hit/insert比：44-45行</h1>
<p>insert/prune是一个波动性的QC指标。一个稳定运行中的QC，insert进QC的查询数量应该大于prune掉的查询数量。而一个不稳定的QC，比值或许是1:1，甚至偏向prune。这说明两个问题：1、QC大小不够；2、mysql试图缓存一切，结果帮了倒忙~</p>
<p>如果是第一种情况，简单的加大QC大小就够了。然后再观察碎片和内存使用率的情况。</p>
<p>但更多的时候是第二种情况。因为QC设置里开启的默认type1就是要求mysql尽可能的缓存一切东西。</p>
<p>mysql官方说明里这么解释这个<code>type 1</code>的：</p>
<pre><code>“缓存一切查询结果，除非查询时使用'select sql_no_cache'方式”。
</code></pre>
<p>可惜这个 <code>sql_no_cache</code> 基本没人用。另一个稍微好一些的方式是 <code>type 2 demand</code> ，解释如下：</p>
<pre><code>“只有在查询使用 `select sql_cache` 时才缓存查询结果”。
</code></pre>
<p>这个type对开发人员要求比较多，因为他们得明确指出哪些要缓存，哪些不要。不过也没人比他们更清楚到底哪些是该缓存的啦~</p>
<p>hit/insert用来反映QC的有效性。理想情况是：mysql插入一批稳定的查询到QC里，然后源源不断的命中这批结果……所以，如果QC的有效性足够，这个比值应该是偏向hit的。如果不幸的偏向了insert，那说明QC其实没起到太大的作用。比如说1:1，一次insert用了一次hit，然后就被替换了，这完全违背了使用QC的初衷。不过还有更糟的，比如0.34:1,一次都没用上，就被prune掉了……</p>
<p>本例的QCHits不低，hit/insert却不高。再考虑到内存使用和碎片情况也还可以。或许真的有必要换成type2的DEMAND了~~</p>
<h1 id="section-11">表锁报表：47-49行</h1>
<p>表锁报表包括两行，一行是总数，一行是当前数。锁等待对于数据库来说永远是糟糕的事情。第三列的总比值反应了一个综述的情况，无论如何不能高过10%，否则肯定就带来一大堆的索引和慢查询问题！</p>
<h1 id="section-12">表报表：51-53行</h1>
<p>也是两行，一行是当前mysql打开表的个数、表缓存的使用率，一行是mysql运行以来的平均值。</p>
<p>这里有两个值比较重要。一个是表缓存使用率，哪怕高到100%都行。不过要是真高到100%了，可能你的&rsquo;table_cache&rsquo;设置已经不够了，赶紧加大吧。第二个是当前打开表的比率，这个也能协助判断&rsquo;table_cache&rsquo;设置是否合理。一般这个值应该小于每秒1次。不过一个负载比较高而又运行的还不错的mysql，可能能达到每秒打开7次表，依然保持100%的表缓存~</p>
<h1 id="section-13">连接数报表：55-57行</h1>
<p>如果最大连接数曾经接近过100%，请加大&rsquo;max_connection&rsquo;设置。不过事实上，默认的100已经足够绝大多数哪怕相当繁忙的mysql使用了，盲目加大这个设置其实不对。一个mysql链接持续1秒钟，100个就是足足100秒。所以如果连接数太高，或者说一直在慢慢涨，问题很可能在别的地方，比如慢查询、糟糕的索引、甚至DNS解析太慢。在修改这个数的事情，还是先去研究一下为什么100个还不够呢？</p>
<p>至于每秒连接数，只要mysql运行正常，高低无所谓。不过大多数mysql这个值在每秒5次以下~~</p>
<h1 id="section-14">临时表报表：59-62行</h1>
<p>mysql可以在内存、磁盘甚至临时文件上创建临时表。这三种情况分别对应下面的三条报告。这些数据没有标准值，不过必须要知道的是磁盘上的临时表示最慢的。mysql一般也避免在磁盘上创建临时表，除非达到了&rsquo;tmp_table_size&rsquo;的阀值。这个阀值会显示在内存(Table)那行的Size列后面。至于内存和临时文件的数值到底该多少，取决于mysql数据库的硬件配置。</p>
<h1 id="section-15">线程、中断、流量报表：64-76行</h1>
<p>这三个报表是最重要的，系统级别的问题不用多说了都……</p>
<p>这里面有一个需要注意的地方：66行的线程命中率。每个mysql的连接都是一个单独的线程。mysql启动时，只创建不多的几个线程和一个线程缓存，以节省不断创建和销毁线程的开销，哪怕这个开销不怎么明显。当mysql的连接数超过了线程缓存数(由 <code>thread_cache_size</code> 定义)时，MySQL开始出现线程抖动(&lsquo;thread thrash&rsquo;)。为了接纳新的连接，mysql疯狂的创建新线程，结果自然是线程命中率大幅下滑。</p>
<p>线程抖动是问题么？Yahoo的Jeremy Zawondy在博客中写了如下一段话：</p>
<pre><code>所以上面这个故事的教训就是：如果你的服务器老是接受一些快速连接，想办法加大你的线程缓存吧，直到你的`show status`命令里`threads_created`不再飙升为止！你的CPU绝对会感谢你的。线程缓存不是啥大问题。可是你解决完真的大问题后，它就是最大的问题了……(汗)
</code></pre>
<p>所以，如果真出现线程抖动的话，加大&rsquo;thread_cache_size&rsquo;吧。</p>
<p>比如本例，线程缓存命中率只有可怜的0.05%！基本意味着每个连接都是新创建了线程。不过看看报表其他的内容，这也是必然的：缓存里一个线程都没有(66行)，201个线程被创建(67行),202个连接(57行)……</p>
<h1 id="innodb78-92">innodb缓冲池报表：78-92行</h1>
<p>mysql版本5.0.2之后才在<code>show status</code>里加入了innodb_内容。所以这部分报表只在该版本之后有效。</p>
<p>innodb存储引擎的重要特性就是它把表数据和索引都缓存在缓冲池里。缓冲池内的页大小是16KB，可以包含各种不同的数据类型。本报表就展示了这些页的数值。</p>
<p>注：因为mysqlreport比较老，对innodb的采集分析不如myisam多。</p>
<h1 id="section-16">使用率：79行</h1>
<p>这个可以类比第4行的 <code>key buffer used</code>。不过myisam引擎只缓存索引，而innodb也存数据。所以要想知道这个使用率的详细情况，还得看81-85行的内容。</p>
<p>显然，必须避免mysql运行到缓冲池溢出的地步。myisam溢出，只会导致性能下降(索引读写变慢)，而innodb的溢出问题就多了，因为几乎所有东西都依赖缓冲池。所以最好还是配置好自增长缓冲池(&lsquo;auto-extending buffer pool&rsquo;)吧。</p>
<h1 id="section-17">读命中：80行</h1>
<p>同样跟地7行的<code>key read hit</code>类似。不过对innodb来说这个数值更重要。缓冲池显示的是从内存读取的比例，所以一般都接近100%，绝大多数情况至少大于99.98%。</p>
<h1 id="section-18">页：81-85行</h1>
<p>各种各样的关于缓冲池中页的指标。比如82行的空闲页、83行的数据页、84行的杂页、85行的锁定页。</p>
<p>空闲页就是79行使用率的对立方。</p>
<p>数据页和空闲页一样是自描述的。我们没法知道这些页里有哪些数据类型。本行还有一列%Dirty，展示已经被修改过，但还没有被刷新到磁盘存储的数据页的比率。</p>
<p>另两样就更没什么可说的了。mysql手册上只是简单的这么描述这两样页：“用于管理分配行锁和自适应哈希索引导致的开销使用的页”和“目前正在读写、或者因为其他原因无法被刷新的页”。</p>
<h1 id="section-19">读：86-89行</h1>
<p>接下来的四行是关于innodb缓冲池的读情况的。86行是从内存读取的数量。在一个比较繁忙的innoDB引擎mysql服务器上，这个值应该非常大，因为innodb总是试图从内存里的缓冲池读取页。这个数值可以用来衡量innodb缓冲池的吞吐量。因为几乎所有inondb需要的东西都是在缓冲池里，所以缓冲池的读性能是越快越好。哪怕超过每秒200000次也不是不可能的。</p>
<p>87行的数值就小的多了。官方解释叫做“innodb无法从缓冲池获得而只能进行单页读取的逻辑读操作数”，其实就是从磁盘读的数量。</p>
<p>88行，随机读。官方解释“innodb启动的随机读取数。只有对表的大部分内容进行随机扫描的时候才会出现”。</p>
<p>89行，顺序读。官方解释“innodb启动的顺序读取数。只有进行全表扫描的时候才会出现”。全表扫描可不是什么好事，这个数值还是小点好。</p>
<h1 id="section-20">写：90行</h1>
<p>和86行类似，也可以用来衡量innodb的吞吐量。本行显示写的数量以及读写的比率。如果服务器主要操作是update和insert的话，这个值也会比较高。</p>
<h1 id="section-21">刷新：91行</h1>
<p>缓冲池的页刷新请求数。</p>
<h1 id="section-22">空闲等待：92行</h1>
<p>mysql手册上这么描述这个变量：
    一般情况下，innodb缓冲池的写操作是后台运行的。不过，如果出现必须要读写一个页可偏偏没有可用的新页时，（innodb）就只能先等待页的刷新了。这个变量就是这些等待的总数。只要缓冲池的大小设置得当，等待数应该会很小。</p>
<h1 id="innodb94-100">innodb锁报表：94-100行</h1>
<p>innodb的行锁变量是mysql5.0.3之后加入的。MyISAM引擎是表锁，而innoDB是行锁。所以当你使用innodb时这几个变量的值非常重要。</p>
<h1 id="section-23">等待：95行</h1>
<p>“等待某行解锁的累积次数”，最好是0次。</p>
<h1 id="section-24">当前：96行</h1>
<p>“当前正在等待解锁的行个数”，最好是0次。</p>
<h1 id="section-25">时间分析：97-100行</h1>
<p>98-100行显示了毫秒(ms)级行锁等待数据。分别是总值、平均值和最大值。同样最好是0次。</p>
<h1 id="innodb102-121">innoDB数据、页、行报表：102-121行</h1>
<p>这部分报告，一般广泛的用于衡量innodb引擎的吞吐量指标。</p>
<h1 id="section-26">数据：103-110行</h1>
<p>第一部分，数据，列出了四种类型的操作：读、写、刷新(fsync)和等待(pending)。</p>
<ol>
  <li>第一个类型：读，指的是整个innodb引擎完成所有的数据读取次数——注意：不是整个数据读取字节数或者类型，而是innodb完成的数据读取次数。</li>
  <li>第二个类型：写，和读一样也是次数的统计。</li>
  <li>第三个类型：刷新，同样的，innodb从内存写入磁盘的次数。这个值应该会比前两个小。</li>
  <li>第四个类型：等待，又被分成了三行(108-110)，分别是读、写、刷新的等待次数。</li>
</ol>
<h1 id="section-27">页：112-115行</h1>
<p>这部分包括三种自描述类型：创建、读取、写入，分别用来表示缓冲池中页的创建、读取和写入的数量和速率(即每秒操作数)。由于没有指出具体是哪种页，这几个数值也就是用来概述一下innodb引擎的吞吐量罢了。</p>
<h1 id="section-28">行：117-121行</h1>
<p>最后一部分，行，只是一些比较泛泛的数值。包括对行的delete/insert/read/update操作。这些数值会比较大，而速率部分同样也是些概述参考……</p>
<h1 id="section-29">结论</h1>
<p>现在我们已经阅读甚至分析完了整个报表，可以对本例mysql做出一个总体的评价了。</p>
<p>总的来说，这个服务器运行情况还是不错的，几个关键指标都很好：key buffer只用了12%，DMS和QCHits占了请求的99%，也没有什么Com_问题，表锁也不错，表缓存只用了10%，连接数很低。</p>
<p>至于innodb引擎，服务器也在使用，但比重不大。目前这些innodb的状态变量反映出的情况看，一些正常。</p>
<p>不过还是有些优化的余地。首先一点，也是最重要的一点，就是查询缓存QC不太稳定；然后是线程缓存，建议调高 <code>thread_cache_size</code>，知道线程缓存命中率回升到满意值~~</p>
    <hr>
    <div class="pagination">
      <ul>
        <li class="prev"><a href="/2011/01/07/compute-flow-from-access_log-by-awk-2" title="日志计算(awk进阶)">&larr; Previous</a></li>
        <li><a href="/archive.html">Archive</a></li>
        <li class="next"><a href="/2011/01/11/construct-http-auth-header" title="HTTP的auth请求模拟">Next &rarr;</a></li>
      </ul>
    </div>
    <hr>
  <!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1589850" async=""></script>
<!-- UY END -->
  </div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
                 <li><a href="/2014/10/07/kibana-4-beta-1-released">【翻译】Kibana 4 beta 1 发版日志</a></li>
                 <li><a href="/2014/10/07/kibana-3-migration-faq">【翻译】Kibana 3 升级到 4 的常见问答</a></li>
                 <li><a href="/2014/10/01/custom-mojolicious-app-command">Mojolicious 应用的自定义子命令</a></li>
                 <li><a href="/2014/09/24/howto-use-custom-rubygem-in-logstash">在 logstash 里使用其他 RubyGems 模块</a></li>
                 <li><a href="/2014/09/23/kibana-auth">Kibana 认证鉴权方案</a></li>
                 <li><a href="/2014/09/04/spark-to-elasticsearch">用 Spark 处理数据导入 Elasticsearch</a></li>
                 <li><a href="/2014/08/29/implement-source-context-function-for-elk">山寨一个 Splunk 的 source 上下文查看功能</a></li>
                 <li><a href="/2014/08/18/intro-range-facet-and-implement-panel-for-it">用 ES 的 RangeFacets 接口实现一个查看区间占比的 Kibana 面板</a></li>
                 <li><a href="/2014/07/28/dynamic-dashboard-for-kibana">Kibana 动态仪表板的使用</a></li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(英文)</li>
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
              <li><a href="http://neilb.org/" title="The good,the bad,and the beautiful">neilb</a></li>
              <li><a href="http://www.reddit.com/r/perl/" title="">reddit perl 频道</a></li>
              <li><a href="http://jpetazzo.github.io/" title="">~jpetazzo</a></li>
              <li><a href="http://www.perfplanet.com/" title="News and views from the web performance blogosphere">Performance Planet</a></li>
              <li><a href="http://cuddletech.com/blog/" title="Use UNIX or die">Cuddle Tech</a></li>
              <li><a href="http://showmetheco.de/" title="Viacheslav Tykhanovskyi(PocketIO/Text::Haml)">No time to wait</a></li>
              <li><a href="http://blog.dataloop.io/" title="A new SaaS monitoring tool for DevOps & Operations">Dataloop.IO</a></li>
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
              <li><a href="http://planeteria.org/perl6/" title="Perl6 文集">Planet Perl 6</a></li>
              <li><a href="http://www.metaforsoftware.com/blog/" title="">metafor</a></li>
              <li><a href="http://blog.kablamo.org/" title="Eric Johnson，一个游走在伦敦和北京的 Perler">kablamo</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(中文)</li>
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
              <li><a href="http://timo.piqiu.me/" title="TIMO IS MY OASIS">Timo</a></li>
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
              <li><a href="http://www.lark.net.cn/" title="王剑">lark's cloud</a></li>
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
              <li><a href="http://blog.liulantao.com/" title="刘兰涛">Lax</a></li>
              <li><a href="http://niubie.me/" title="莫言">莫言</a></li>
              <li><a href="http://noops.me/" title="小米运维部">NoOps</a></li>
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
              <li><a href="http://www.usefulshare.com" title="当当网安全运维">UsefulShare</a></li>
              <li><a href="http://junqili.com/" title="深入研究puppet">纸飞机</a></li>
              <li><a href="http://www.chinaxing.org/" title="">ChinaXing</a></li>
              <li><a href="http://bubbyroom.com/" title="守住每一天">Liuyu's blog</a></li>
              <li><a href="http://blog.aka-cool.net/" title="">Aka.Why</a></li>
              <li><a href="http://blog.l8ii.com/" title="刘侨">LairdNote</a></li>
              <li><a href="http://flw.tools/" title="">flw的工具箱</a></li>
              <li><a href="http://blog.mcshell.org/" title="">mcshell</a></li>
              <li><a href="http://novoland.github.io/" title="">克鲁斯卡尔的博客</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="booklists" class="nav nav-list">
          <li class="nav-header">我写的第一本技术书籍</li>
          <li><a href='http://product.china-pub.com/3769604'><img src='http://images.china-pub.com/ebook3765001-3770000/3769604/shupi.jpg' border='0' alt='网站运维技术与实践'/></a></li>
          <li class="nav-header">我写的两本电子书籍</li>
          <li><a href='https://www.gitbook.io/book/chenryn/logstash-best-practice'><img src='https://sm3lir.cloudimage.io/s/width/313/https://www.gitbook.io/cover/book/chenryn/logstash-best-practice?build=1411488954525' border='0' alt='LogStash 最佳实践'/></a></li>
          <li><a href='https://www.gitbook.io/book/chenryn/kibana-guide-cn'><img src='https://sm3lir.cloudimage.io/s/width/313/https://www.gitbook.io/cover/book/chenryn/kibana-guide-cn?build=1411570851764' border='0' alt='Kibana 中文指南'/></a></li>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
    <!-- JiaThis Button BEGIN -->
    <script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1589850" charset="utf-8"></script>
    <!-- JiaThis Button END -->
    <!-- UJian Button BEGIN -->
    <script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&uid=1589850"></script>
    <!-- UJian Button END -->
  </body>
</html>
