
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">归档</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/errata.html">《网站运维技术与实践》勘误</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/projects.html">学习记录</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  




            <li><a href="http://chenlinux.com/poetry/index.html" />诗文集</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
        
<div class="row">
  

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/21/bsd_flow_monitor_by_awk" title="BSD上的流量监控脚本" rel="bookmark">BSD上的流量监控脚本</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-21 00:00:00 +0800">21 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>之前有过一篇linux上的流量监控脚本的博文，是利用procfs进行数据运算。但BSD上的procfs和linux有所不同，它只包含了进程的信息，没有系统的统计。所以只能通过其他方法。
linux上另一种获取网卡总流量的方法是ifconfig命令，这个命令其实也是读取proc；但是BSD上的ifconfig输出里也没有……
不过BSD上倒不是没法查流量上，事实上另外有两个命令，在实时观测中更加好用，一个是systat -if 1，几乎就是一个无色版的iptraf；另一个是netstat -idbhI bce0 1。
解释一下，systat是bsd上用来查看系统信息的一个超级利器，-if是-ifstat的简写，类似还有-vmstat等等。netstat是专门用来显示网络状态的，最常用的就是-ant显示所有的TCP链接，这里用的idbhI，表示interface、drop、bytes、human，也就是用方便读取的格式输出某网卡的流量值。
但是这两个命令，都是持续输出，必须接到^C信号才会退出运行。在实时管理时很好用，在做监控脚本的时候，就弄巧成拙了……
好在netstat参数多，调整一下，使用idbnf参数（family）即可输出网卡总流量值，然后按照linux上一样的思路进行计算了。
最终脚本如下：

      <a href="/2011/03/21/bsd_flow_monitor_by_awk" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/18/gearmand-test-on-single-server" title="gearman单机试验" rel="bookmark">gearman单机试验</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-18 00:00:00 +0800">18 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>想把前端缓存几十台服务器的访问日志数据计入数据库中，以便核算各频道带宽。按照一般流量统计的惯例，在服务器上设定crontab每5分钟rotate一次access.log。但是想到一个问题——当A服务器select了数据库里的数据但还没来得及update时，B服务器也开始执行任务select数据来了，最后的结果就不准确了——我相信这个问题对coder来说很低级，不过我是op，搞不来……

      <a href="/2011/03/18/gearmand-test-on-single-server" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/17/initctl-error" title="linux小报错一例" rel="bookmark">linux小报错一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-17 00:00:00 +0800">17 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>需要给某台服务器加内存，准备关机的时候，却一直报错。考虑直接断电危害比较大，还是找找原因，报错如下：
shutdown: timeout opening/writing control channel /dev/initctl 
init: timeout opening/writing control channel /dev/initctl 
从messages日志里没有发现任何附加信息。只能求助百度。好在解答很多：
是原有的initscripts和SysVinit找不到了导致的。
传上去initscripts-8.45.19.EL-1.x86_64.rpm和SysVinit-2.86-14.x86_64.rpm两个包，rpm -ivh安装。
重新poweroff还是报错；但强制-f跳过shutdown过程后，成功了。稍后再启动设备，试着再敲一次poweroff，这次就不报错，成功关机了。

      <a href="/2011/03/17/initctl-error" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/15/simple-test-between-squid-varnish-ats" title="squid/varnish/ats简单测试" rel="bookmark">squid/varnish/ats简单测试</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-15 00:00:00 +0800">15 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>简单的试试varnish和apache traffic server。跟squid进行一下对比。
介于varnish和ats都是出现不太久的东西（至少是开源流行不长），选择其最新开发版本测试，正巧都是2.15版。呵呵~
varnish配置文件，只修改了backend到具体某台nginx发布点上。其他都是反向代理缓存的标配。（可参考张宴博客http://blog.s135.com和varnish权威指南http://linuxguest.blog.51cto.com/195664/354889）
ats说明更少，从目前的资料看，修改了records.config中的监听，cache.config遵循源站未改，remap.config添加了map一条，绑定域名到同一台nginx上。
注：varnish和ats都没有修改缓存路径，即分别为var/varnish/varnish.cache和var/trafficserver，都是磁盘。

      <a href="/2011/03/15/simple-test-between-squid-varnish-ats" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/03/zz-a-day-in-the-life-of-facebook-operations" title="Facebook运维工程师的一天" rel="bookmark">Facebook运维工程师的一天</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-03 00:00:00 +0800">03 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>原文地址：http://linuxsysadminblog.com/2010/09/a-day-in-the-life-of-facebook-operations/
顺便说一句，这个linuxsysadminblog.com确实不错。
文章是笔者在现场听Facebook系统工程师汤姆·库克在2010年的surge可扩展和性能大会上的讲演时记录下来的——
这是到目前为止最火爆的讲座了，还没开始就只剩下点站着的空间……
Facebook运维需要支持多大的应用环境：
1、在facebook花上每个月7亿分钟（不太明白这个意思，一个月明明只有43200分钟）
2、60亿次内容更新；
3、30亿张图片；
4、实现100万连接；
5、5亿活跃用户。
基础设施建设的发展：
1、租用IDC达到瓶颈；
2、开始自建；
3、目前已为加利福尼亚和弗吉尼亚两州服务。
发展历程：
从LAMP起步，然后拆分负载均衡，web服务器，app服务器，memcached，数据库。
最早的Facebook是一个单纯的发布在apache上的php站点。但后来php不足以支持Facebook的访问了，现在，Facebook已经开始编译一些php功能成C++程序，这就是业界闻名的HipHop。
Facebook大概拥有世上最大的memcached集群，超过300TB的数据存储在memcached内存中。
使用flashcache来改善mysql性能。
已实现支持的服务：
新闻feed、搜索、缓存。
服务使用中的编程语言：
C++、php（前台）、python、ruby、java、erlang（聊天室）
各种编程语言间如何交互数据？json？soap？都不是。Facebook专用一个为各编程语言开发服务的软件框架。所有的Facebook系统后面，都是统一的一个平台。
Facebook每天都在担心：
开发、监控、数据管理、代码上线。
Facebook使用centos操作系统！
系统管理：
配置管理；
系统管理——用CFengine；
按需管理。
开发：
前台部分——每天都有新代码上线。代码统一协调，所有人都在IRC的频道里交流。每个人都可以知道发生了什么，而不单单是工程师自己。
1、程序推送按需分发；
2、代码分发通过BT的方式；
3、php是经过编译的，数百MB的二进制文件通过极小的BT种子迅速下发；
4、完成全网更新只需要1分钟。
后台部分——只有开发和运维。开发工程师写代码、测试、演示。
1、这样能迅速得到性能数据；
2、揭露各环节的真实交互（这里翻译的应该不对，看不懂……）；
3、没有所谓的“提交、退出”；
4、全面参与应用变成产品的过程；
5、运维被“嵌入”每个开发团队。
代码的每一处修改和推送，都必须详细记录。
Facebook的服务器性能指标在线监控
ganglia监控系统：快速、便捷、超过500万的监控指标、可以通过网格和池的方式进行规划。
自主的监控系统
nagios监控系统：用来给各团队发报警，最开始是用的email。
Scribe高性能日志系统：最开始用的是syslogd，同时在用hadoop和hive。
怎么运行的呢：
1、定义要明确的依赖关系；
2、固定的失败次数；
3、服务器是第一步，系统架构设计。
4、现在重点是搞集群。通过功能不同进行逻辑关系划分（web、db、feed等）
5、下一步是数据中心。尤其是灾备。
6、不断的沟通——信息永远在共享中。
7、IRC。
8、大量的自动化数据获取和设置。
9、内部新闻更新。
10、内部工具的&rsquo;headers&rsquo;；
11、变更日志。
12、团队要短小精悍。
一个有趣的数字：平均每台Facebook的服务器8分钟就升级一次。
一个有趣的事实：Facebook最忙的时候是万圣节后的那天。

      <a href="/2011/03/03/zz-a-day-in-the-life-of-facebook-operations" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/03/01/perl-game-of-chinaunix" title="CU的perl大赛" rel="bookmark">CU的perl大赛</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-03-01 00:00:00 +0800">01 Mar 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>原帖地址：http://bbs.chinaunix.net/thread-1860259-1-1.html
刚看到帖子，试着自己做做，首先必须承认做的过程是重新去翻过资料了……

      <a href="/2011/03/01/perl-game-of-chinaunix" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/24/delete-rt-attachment-from-mysql" title="RT故障处理操作一例" rel="bookmark">RT故障处理操作一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-24 00:00:00 +0800">24 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#database-ref" title="database" rel="category tag">database</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>公司RT系统某工单页面无法打开。通过httpwatch发现是图片附件比较大，卡住了页面加载最终导致。
询问当事人后，决定把图片删除掉。
右键菜单查看图片url，是http://rt.domain.com/Ticket/Attachment/123456/654321/12.jpg这样的格式~
于是在服务器的DocumentRoot下查找相关路径，发现Ticket/Attachment下只有一个文件dhandler，这是一段perl程序。
相关部分如下：

      <a href="/2011/02/24/delete-rt-attachment-from-mysql" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/24/a-awk-example-about-gsub-function" title="awk一例" rel="bookmark">awk一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-24 00:00:00 +0800">24 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>一个小需求，某目录下有五万多个模板文件，其中大概两万个是链接文件。当碰到如下情况：
lrwxrwxrwx  1 nobody nobody       59 Dec 27 15:06 10000053.mod -&gt; /var/www/html/category/model/10000050.mod
就需要创建同名的另一个模板文件10000053.wap文件，指向10000050.wap。
怎么做？
我用了如下命令：

      <a href="/2011/02/24/a-awk-example-about-gsub-function" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/22/redhat-tech-questions" title="没事试试RH的技能测试" rel="bookmark">没事试试RH的技能测试</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-22 00:00:00 +0800">22 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>上redhat官网看资料的时候想起来上面有RHCE报名前的技能水平测试（用来预估水平，省掉一些基础课程的）。然后做了一下试试。地址如右：<a href="http://www.redhat.com/explore/pre-assessment">http://www.redhat.com/explore/pre-assessment</a>
结果如下：

      <a href="/2011/02/22/redhat-tech-questions" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/19/conns-diff-between-browsers" title="浏览器连接数的小区别" rel="bookmark">浏览器连接数的小区别</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-19 00:00:00 +0800">19 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>读百度UEO博客的文章《<a href="http://www.baiduux.com/blog/2011/02/15/browser-loading/" target="_blank">浏览器的加载与页面性能优化</a>》，其中关于浏览器对单个域名连接数有一段描述，与一般的概述稍有差别。由此可见像百度这种级别的公司，对性能细节抓到什么程度——让我想起之前在腾讯大讲堂里看到的&rdquo;页面代码大小要求是MTU倍数&rdquo;。

      <a href="/2011/02/19/conns-diff-between-browsers" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/16/pseudo-static-problem-of-js-rewrite" title="apache的rewrite伪静态化问题一例" rel="bookmark">apache的rewrite伪静态化问题一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-16 00:00:00 +0800">16 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#apache-ref" title="apache" rel="category tag">apache</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>某应用系统有一个产品翻页浏览，为了利于搜索引擎，准备把/search.html?param=1-2-3-4-5做伪静态化，变成/search/1-2-3-4-5.html的url显示。

      <a href="/2011/02/16/pseudo-static-problem-of-js-rewrite" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/02/14/compile-and-upgrading-of-the-linux-kernel" title="linux内核编译升级" rel="bookmark">linux内核编译升级</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-02-14 00:00:00 +0800">14 Feb 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>N年没更新的ipvsadm终于在今年春节前更新了，正好手头有lvs的任务，赶紧试试。lvs上说的很清楚，ipvsadm的1.2.26版仅工作于linux kernel2.6.28以上版本。所以首先要把现有的2.6.18的linux kernel升级。

      <a href="/2011/02/14/compile-and-upgrading-of-the-linux-kernel" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/26/direct-operate-xen-vm-image" title="直接操作xen虚拟机镜像的办法" rel="bookmark">直接操作xen虚拟机镜像的办法</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-26 00:00:00 +0800">26 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#cloud-ref" title="cloud" rel="category tag">cloud</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>一台xen虚拟机，root密码忘记了，必须进入single模式修改root密码。步骤很熟练，xm shutdown domain &amp;&amp; xm create -c domain——但是出问题了——没出现grub的启动界面，直接进入系统启动过程了！

      <a href="/2011/01/26/direct-operate-xen-vm-image" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/20/problem-about-move-crossing-partition" title="图片分离小故障一例" rel="bookmark">图片分离小故障一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-20 00:00:00 +0800">20 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>有需求对某应用的图片和页面内容进行拆分。计划进行的很顺利，存储设备上成功分成了/vol/html和/vol/image，然后分别挂载在应用服务器上发布为html.domain.com和image.domain.com。但在恢复应用运行后出现一个问题：新图片的上传总是提示失败。

      <a href="/2011/01/20/problem-about-move-crossing-partition" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/20/awk-efficiency" title="awk的效率" rel="bookmark">awk的效率</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-20 00:00:00 +0800">20 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>偶然和某人谈到日志处理。最简单常见的需求，日志中访问量最大的前十个IP及其访问次数。

      <a href="/2011/01/20/awk-efficiency" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/13/learning-accel-dynamic-data" title="读《基于动态内容的缓存加速技术》笔记" rel="bookmark">读《基于动态内容的缓存加速技术》笔记</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-13 00:00:00 +0800">13 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#cdn-ref" title="cdn" rel="category tag">cdn</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>《程序员》2010年11月刊的86-89四页，刊登了F5售前技术顾问，原VIACDN(TOM的CDN部门，后来独立运营)架构师徐超的文章《基于动态内容的缓存加速技术——F5 Web Accelerator产品技术剖析》。

      <a href="/2011/01/13/learning-accel-dynamic-data" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/12/resin-status" title="resin-status" rel="bookmark">resin-status</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-12 00:00:00 +0800">12 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>和apache、nginx一样，resin也自带了一个比较简易的status模块，只需要在resin.conf里配置就行了。在里添加如下一段：

      <a href="/2011/01/12/resin-status" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/11/construct-http-auth-header" title="HTTP的auth请求模拟" rel="bookmark">HTTP的auth请求模拟</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-11 00:00:00 +0800">11 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>开发同事需要在程序中调用一个“安全级别比较高”的url，起初没觉得有啥问题，我们wget或者curl的时候，按照标准url的格式（即&rsquo;请求方法://用户名:密码@域名/文件路径&rsquo;）写就完全OK了。不过很快同事转来了报错：

      <a href="/2011/01/11/construct-http-auth-header" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/10/mysqlreport-guide" title="mysqlreport指南" rel="bookmark">mysqlreport指南</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-10 00:00:00 +0800">10 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#database-ref" title="database" rel="category tag">database</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>mysqlreport是mysql性能监测时最常用的工具，对了解mysql运行状态和配置调整都有很大的帮助。找了一些mysql的资料，发现大多数是关于php+mysql开发的，服务配置基本就是固定的几条。干脆找上mysqlreport的官网，啃下来这篇指南。翻译都是随着我个人的语言习惯，对直接能用mysql命令上看到结果的英文则保留下来。方便以后查找：

      <a href="/2011/01/10/mysqlreport-guide" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/01/07/compute-flow-from-access_log-by-awk-2" title="日志计算(awk进阶)" rel="bookmark">日志计算(awk进阶)</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-01-07 00:00:00 +0800">07 Jan 2011</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <table>
  <tbody>
    <tr>
      <td>曾经用awk写过一个日志流量计算的单行命令。因为awk中没有sort函数，所以在中途采用了</td>
      <td>sort</td>
      <td>的方式，导致效率很低。在计算50GB+的日志时，运算时间慢的不可忍受。</td>
    </tr>
  </tbody>
</table>

<p>设想了很多方法来加快运算，比如舍弃awk改用perl来完成，如下：

      <a href="/2011/01/07/compute-flow-from-access_log-by-awk-2" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/12/30/resin-ipv6" title="resin与ipv6" rel="bookmark">resin与ipv6</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-12-30 00:00:00 +0800">30 Dec 2010</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#web-ref" title="web" rel="category tag">web</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>一台nginx+resin的应用服务器出现大量的ipv6下的CLOSE_WAIT。重启后十五分钟就累积到了1500+。

      <a href="/2010/12/30/resin-ipv6" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/12/28/intro-tcprstat" title="TCP响应时间监测" rel="bookmark">TCP响应时间监测</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-12-28 00:00:00 +0800">28 Dec 2010</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>对于squid等服务器，其日志中就含有响应时间。但是，这个时间只是服务器软件处理过程的时间，进程一旦交出去，在网卡等处的时间，它就管不着了。而percona出品一款迷你型小工具，叫做tcprstat，正好派上用场~

      <a href="/2010/12/28/intro-tcprstat" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/12/23/if-modified-since-process-in-nginx" title="ims在nginx上的处理（无责任猜测）" rel="bookmark">ims在nginx上的处理（无责任猜测）</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-12-23 00:00:00 +0800">23 Dec 2010</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#nginx-ref" title="nginx" rel="category tag">nginx</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>最近得知CDN方面默认配置了reload-into-ims，而我们的html因为采用了ssi的include方式的原因，是没有last-modified的。在这种情况下的处理结果，让人好奇~

      <a href="/2010/12/23/if-modified-since-process-in-nginx" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/12/23/diff-between-wget-curl" title="wget和curl测试时的小区别" rel="bookmark">wget和curl测试时的小区别</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-12-23 00:00:00 +0800">23 Dec 2010</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>在对网站内容是否更新进行测试时，最常用的两个工具就是wget和curl。不过两个工具之间还是有一些小区别，甚至很可能影响到测试结论的。记录一下：

      <a href="/2010/12/23/diff-between-wget-curl" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>

  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2010/12/22/monitor-netapp-by-net-snmp" title="通过snmp协议监控NetApp" rel="bookmark">通过snmp协议监控NetApp</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2010-12-22 00:00:00 +0800">22 Dec 2010</abbr>
      </span>
        
      <span>
      </span>
      Posted in&nbsp;
      
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
      
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>

    <p>NetApp作为专业存储，用起来还是比较让人放心的，不过放心不代表放手不管，一些重要的监控还是要做的。比如基本的CPU负载、网卡流量、磁盘使用率，作为数据存储特别关注的IOPS、DiskIO（因为有cache的原因，所以NetIO和DiskIO是不同时的，单从网卡进出不能判定磁盘的真实读写）。

      <a href="/2010/12/22/monitor-netapp-by-net-snmp" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>


  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
  
    <li>
    
      <a href="/page8">Previous</a>
    
    </li>
  
  
    <li class="page">
      <a href="/">1</a>
    </li>
  
  
    
    <li class="page">
      <a href="/page2">2</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page3">3</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page4">4</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page5">5</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page6">6</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page7">7</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page8">8</a>
    </li>
    
  
    
    <li class="page active">
      <a href="#">9</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page10">10</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page11">11</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page12">12</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page13">13</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page14">14</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page15">15</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page16">16</a>
    </li>
    
  
    
    <li class="page">
      <a href="/page17">17</a>
    </li>
    
  
  
    <li>
      <a href="/page10">Next</a>
    </li>
  
  </ul>
</div>



</div>


      </div>
      <div class="span4">
          
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
               
            </ul>
          </div>
        
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(英文)</li>
            
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
            
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
            
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
            
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
            
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
            
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
            
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
            
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
            
              <li><a href="http://neilb.org/" title="The good,the bad,and the beautiful">neilb</a></li>
            
              <li><a href="http://www.reddit.com/r/perl/" title="">reddit perl 频道</a></li>
            
              <li><a href="http://jpetazzo.github.io/" title="">~jpetazzo</a></li>
            
              <li><a href="http://www.perfplanet.com/" title="News and views from the web performance blogosphere">Performance Planet</a></li>
            
              <li><a href="http://cuddletech.com/blog/" title="Use UNIX or die">Cuddle Tech</a></li>
            
              <li><a href="http://showmetheco.de/" title="Viacheslav Tykhanovskyi(PocketIO/Text::Haml)">No time to wait</a></li>
            
              <li><a href="http://blog.dataloop.io/" title="A new SaaS monitoring tool for DevOps & Operations">Dataloop.IO</a></li>
            
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
            
              <li><a href="http://planeteria.org/perl6/" title="Perl6 文集">Planet Perl 6</a></li>
            
              <li><a href="http://www.metaforsoftware.com/blog/" title="">metafor</a></li>
            
              <li><a href="http://blog.kablamo.org/" title="Eric Johnson，一个游走在伦敦和北京的 Perler">kablamo</a></li>
            
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(中文)</li>
            
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
            
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
            
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
            
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
            
              <li><a href="http://zauc.wordpress.com/" title="">Timo</a></li>
            
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
            
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
            
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
            
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
            
              <li><a href="http://www.lark.net.cn/" title="王剑">lark's cloud</a></li>
            
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
            
              <li><a href="http://blog.liulantao.com/" title="刘兰涛">Lax</a></li>
            
              <li><a href="http://niubie.me/" title="莫言">莫言</a></li>
            
              <li><a href="http://noops.me/" title="小米运维部">NoOps</a></li>
            
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
            
              <li><a href="http://www.usefulshare.com" title="当当网安全运维">UsefulShare</a></li>
            
              <li><a href="http://junqili.com/" title="深入研究puppet">纸飞机</a></li>
            
              <li><a href="http://www.chinaxing.org/" title="">ChinaXing</a></li>
            
              <li><a href="http://bubbyroom.com/" title="守住每一天">Liuyu's blog</a></li>
            
              <li><a href="http://blog.aka-cool.net/" title="">Aka.Why</a></li>
            
              <li><a href="http://blog.l8ii.com/" title="刘侨">LairdNote</a></li>
            
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="booklists" class="nav nav-list">
          <li class="nav-header">我写的第一本技术书籍</li>
          <li><a href='http://product.china-pub.com/3769604'><img src='http://images.china-pub.com/ebook3765001-3770000/3769604/shupi.jpg' border='0' alt='网站运维技术与实践'/></a></li>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
    

    <!-- JiaThis Button BEGIN -->
    <script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1589850" charset="utf-8"></script>
    <!-- JiaThis Button END -->
    <!-- UJian Button BEGIN -->
    <script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&uid=1589850"></script>
    <!-- UJian Button END -->
  </body>
</html>

