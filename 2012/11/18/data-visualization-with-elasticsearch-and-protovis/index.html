<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>【翻译】用ElasticSearch和Protovis实现数据可视化</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive.html">归档</a></li>
      	<li><a href="/categories.html">分类</a></li>
      	<li><a href="/errata.html">《网站运维技术与实践》勘误</a></li>
      	<li><a href="/pages.html">Pages</a></li>
      	<li><a href="/projects.html">学习记录</a></li>
      	<li><a href="/tags.html">标签</a></li>
            <li><a href="http://chenlinux.com/poetry/index.html" />诗文集</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="page-header">
    <h1>【翻译】用ElasticSearch和Protovis实现数据可视化 <small></small></h1>
    <div class="date"><span>18 November 2012</span></div>
    <ul class="tag_box pull-right">
    	<li><a href="/tags.html#elasticsearch-ref">elasticsearch <span>31</span></a></li>
    	<li><a href="/tags.html#javascript-ref">javascript <span>12</span></a></li>
    </ul>
  </div>
  <div style='background-color: #FFF;'>
    <p>搜索引擎最重要的目的，嗯，不出意料就是<code>搜索</code>。你传给它一个请求，然后它依照相关性返回你一串匹配的结果。我们可以根据自己的内容创造各种请求结构，试验各种不同的分析器，搜索引擎都会努力尝试提供最好的结果。</p>
<p>不过，一个现代的全文搜索引擎可以做的比这个更多。因为它的核心是基于一个为了高效查询匹配文档而高度优化过的数据结构——<a href="http://en.wikipedia.org/wiki/Index_\(search_engine\)#Inverted_indices">倒排索引</a>。它也可以为我们的数据完成复杂的<code>聚合</code>运算，在这里我们叫它facets。(不好翻译，后文对这个单词都保留英文)</p>
<p>facets通常的目的是提供给用户某个方面的导航或者搜索。 当你在网上商店搜索“相机”，你可以选择不同的制造商，价格范围或者特定功能来定制条件，这应该就是点一下链接的事情，而不是通过修改一长串查询语法。</p>
<p>一个<a href="http://blog.linkedin.com/2009/12/14/linkedin-faceted-search/">LinkedIn的导航</a>范例如下图所示：</p>
<p><img src="http://www.elasticsearch.cn/blog/images/dashboards/linkedin-faceted-search.png" alt="图片1" /></p>
<p>Facet搜索为数不多的几个可以把强大的请求能力开放给最终用户的办法之一，详见Moritz Stefaner的试验<a href="http://well-formed-data.net/archives/54/elastic-lists">“Elastic Lists”</a>，或许你会有更多灵感。</p>
<p>但是，除了链接和复选框，其实我们还能做的更多。比如利用这些数据画图，而这就是我们在这篇文章中要讲的。</p>
<h1 id="section">实时仪表板</h1>
<p>在几乎所有的分析、监控和数据挖掘服务中，或早或晚的你都会碰到这样的需求：“我们要一个仪表板！”。因为大家都爱仪表板，可能因为真的有用，可能单纯因为它漂亮~这时候，我们不用写任何<a href="http://en.wikipedia.org/wiki/Online_analytical_processing">OLAP</a>实现，用facets就可以完成一个很漂亮很给力的分析引擎。</p>
<p>下面的截图就是从一个<a href="http://ataxosocialinsider.cz/">社交媒体监控应用</a>上获取的。这个应用不单用ES来搜索和挖掘数据，还通过交互式仪表板提供数据聚合功能。</p>
<p><img src="http://www.elasticsearch.cn/blog/images/dashboards/dashboard.png" alt="图片2" /></p>
<p>当用户深入数据，添加一个关键字，使用一个自定义查询，所有的图都会实时更新，这就是facet聚合的工作方式。仪表板上不是数据定期计算好的的静态快照，而是一个用于数据探索的真正的交互式工具。</p>
<p>在本文中，我们将会学习到怎样从ES中获取数据，然后怎么创建这些图表。</p>
<h1 id="terms-facet">关系聚合(terms facet)的饼图</h1>
<p>第一个图，我们用ES中比较简单的<a href="http://elasticsearch.org/guide/reference/api/search/facets/terms-facet.html">terms</a>facet来做。这个facet会返回一个字段中最常见的词汇和它的计数值。</p>
<p>首先我们先插入一些数据。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl -X DELETE <span class="s2">&quot;http://localhost:9200/dashboard&quot;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">             { &quot;title&quot; : &quot;One&quot;,</span>
<span class="s1">               &quot;tags&quot;  : [&quot;ruby&quot;, &quot;java&quot;, &quot;search&quot;]}</span>
<span class="s1">&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">             { &quot;title&quot; : &quot;Two&quot;,</span>
<span class="s1">               &quot;tags&quot;  : [&quot;java&quot;, &quot;search&quot;] }</span>
<span class="s1">&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">             { &quot;title&quot; : &quot;Three&quot;,</span>
<span class="s1">               &quot;tags&quot;  : [&quot;erlang&quot;, &quot;search&quot;] }</span>
<span class="s1">&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">             { &quot;title&quot; : &quot;Four&quot;,</span>
<span class="s1">               &quot;tags&quot;  : [&quot;search&quot;] }</span>
<span class="s1">&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/_refresh&quot;</span></code></pre></div>
<p>你们都看到了，我们存储了一些文章的标签，每个文章可以多个标签，数据以JSON格式发送，这也是ES的文档格式。</p>
<p>现在，要知道文档的十大标签，我们只需要简单的请求：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/_search?pretty=true&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">    &quot;query&quot; : { &quot;match_all&quot; : {} },</span>
<span class="s1">    &quot;facets&quot; : {</span>
<span class="s1">        &quot;tags&quot; : { &quot;terms&quot; : {&quot;field&quot; : &quot;tags&quot;, &quot;size&quot; : 10} }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">&#39;</span></code></pre></div>
<p>你看到了，我接受所有文档，然后定义一个terms facet叫做“tags”。这个请求会返回如下样子的数据：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
    <span class="s2">&quot;took&quot;</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="c1">// ... snip ...</span>
    <span class="s2">&quot;hits&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="c1">// ... snip ...</span>
    <span class="p">},</span>
    <span class="s2">&quot;facets&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;tags&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;_type&quot;</span> <span class="o">:</span> <span class="s2">&quot;terms&quot;</span><span class="p">,</span>
            <span class="s2">&quot;missing&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;terms&quot;</span> <span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;term&quot;</span> <span class="o">:</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">4</span> <span class="p">},</span>
                <span class="p">{</span> <span class="s2">&quot;term&quot;</span> <span class="o">:</span> <span class="s2">&quot;java&quot;</span><span class="p">,</span>   <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">2</span> <span class="p">},</span>
                <span class="p">{</span> <span class="s2">&quot;term&quot;</span> <span class="o">:</span> <span class="s2">&quot;ruby&quot;</span><span class="p">,</span>   <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="s2">&quot;term&quot;</span> <span class="o">:</span> <span class="s2">&quot;erlang&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>JSON中<code>facets</code>部分是我们关心的，特别是<code>facets.tags.terms</code>数组。它告诉我们有四篇文章打了search标签，两篇java标签，等等…….(当然，我们或许应该给请求添加一个<code>size</code>参数跳过前面的结果)</p>
<p>这种比例类型的数据最合适的可视化方案就是饼图，或者它的变体：油炸圈饼图。最终结果如下(你可能希望看这个<a href="http://www.elasticsearch.cn/blog/assets/dashboards/donut.html">可运行的实例</a>)：</p>
<p><img src="http://www.elasticsearch.cn/blog/images/dashboards/donut_chart.png" alt="图片3" /></p>
<p>我们将使用<a href="http://vis.stanford.edu/protovis/">Protovis</a>一个JavaScript的数据可视化工具集。Protovis是100%开源的，你可以想象它是数据可视化方面的RoR。和其他类似工具形成鲜明对比的是，它没有附带一组图标类型来供你“选择”。而是定义了一组原语和一个灵活的DSL，这样你可以非常简单的创建自定义的可视化。创建<a href="http://vis.stanford.edu/protovis/ex/pie.html">饼图</a>就非常简单。</p>
<p>因为ES返回的是JSON数据，我们可以通过Ajax调用加载它。不要忘记你可以clone或者下载实例的<a href="https://gist.github.com/966338">全部源代码</a>。</p>
<p>首先需要一个HTML文件来容纳图标然后从ES里加载数据：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>ElasticSearch Terms Facet Donut Chart<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- Load JS libraries --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery-1.5.1.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;protovis-r3.2.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;donut.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="nx">$</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">load_data</span><span class="p">();</span> <span class="p">});</span>
        <span class="kd">var</span> <span class="nx">load_data</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>   <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:9200/dashboard/article/_search?pretty=true&#39;</span>
                     <span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span>
                     <span class="p">,</span> <span class="nx">data</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
                           <span class="s2">&quot;query&quot;</span> <span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;match_all&quot;</span> <span class="o">:</span> <span class="p">{}</span> <span class="p">},</span>
                           <span class="s2">&quot;facets&quot;</span> <span class="o">:</span> <span class="p">{</span>
                               <span class="s2">&quot;tags&quot;</span> <span class="o">:</span> <span class="p">{</span>
                                   <span class="s2">&quot;terms&quot;</span> <span class="o">:</span> <span class="p">{</span>
                                       <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;size&quot;</span>  <span class="o">:</span> <span class="s2">&quot;10&quot;</span>
                                   <span class="p">}</span>
                               <span class="p">}</span>
                           <span class="p">}</span>
                       <span class="p">})</span>
                     <span class="p">,</span> <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;json&#39;</span>
                     <span class="p">,</span> <span class="nx">processData</span><span class="o">:</span> <span class="kc">false</span>
                     <span class="p">,</span> <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">statusText</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
                           <span class="k">return</span> <span class="nx">display_chart</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
                       <span class="p">}</span>
                     <span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                           <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error while loading data from ElasticSearch&quot;</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
                           <span class="k">throw</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
                       <span class="p">}</span>
            <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">display_chart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Donut</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">facets</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">terms</span><span class="p">).</span><span class="nx">draw</span><span class="p">();</span>
            <span class="p">};</span>
        <span class="p">};</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="c">&lt;!-- Placeholder for the chart --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;chart&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>
<p>文档加载后，我们通过Ajax收到和之前<code>curl</code>测试中一样的facet。在jQuery的Ajaxcallback里我们通过封装的<code>display_chart()</code>把返回的JSON传给<code>Donut()</code>函数.</p>
<p><code>Donut()</code>函数及注释如下： </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// =====================================================================================================</span>
<span class="c1">// A donut chart with Protovis - See http://vis.stanford.edu/protovis/ex/pie.html</span>
<span class="c1">// =====================================================================================================</span>
<span class="kd">var</span> <span class="nx">Donut</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dom_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">dom_id</span><span class="p">)</span>  <span class="p">{</span>                <span class="c1">// Set the default DOM element ID to bind</span>
        <span class="nx">dom_id</span> <span class="o">=</span> <span class="s1">&#39;chart&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>                         <span class="c1">// Set the data for the chart</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">json</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Sort the data by term names, so the</span>
            <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">term</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">term</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>            <span class="c1">// color scheme for wedges is preserved</span>
        <span class="p">}),</span>                                             <span class="c1">// with any order</span>
        <span class="nx">values</span>  <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">entries</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>         <span class="c1">// Create an array holding just the counts</span>
            <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="c1">// console.log(&#39;Drawing&#39;, entries, values);</span>
        <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>                                    <span class="c1">// Dimensions and color scheme for the chart</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
            <span class="nx">colors</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Colors</span><span class="p">.</span><span class="nx">category10</span><span class="p">().</span><span class="nx">range</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">()</span>                        <span class="c1">// Create the basis panel</span>
            <span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">margin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Wedge</span><span class="p">)</span>                               <span class="c1">// Create the &quot;wedges&quot; of the chart</span>
            <span class="p">.</span><span class="nx">def</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>                          <span class="c1">// Auxiliary variable to hold mouse over state</span>
            <span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">)</span>               <span class="c1">// Pass the normalized data to Protovis</span>
            <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="nx">w</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>                                  <span class="c1">// Set-up chart position and dimension</span>
            <span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="nx">w</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">outerRadius</span><span class="p">(</span><span class="nx">w</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>                            <span class="c1">// Create a &quot;donut hole&quot; in the center</span>
            <span class="p">.</span><span class="nx">angle</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>                       <span class="c1">// Compute the &quot;width&quot; of the wedge</span>
                <span class="k">return</span> <span class="nx">d</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
             <span class="p">})</span>
            <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s2">&quot;#fff&quot;</span><span class="p">)</span>                        <span class="c1">// Add white stroke</span>
            <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>            <span class="c1">// On &quot;mouse over&quot;, set the &quot;wedge&quot; as active</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">cursor</span><span class="p">(</span><span class="s1">&#39;pointer&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
             <span class="p">})</span>
            <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span>  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>            <span class="c1">// On &quot;mouse out&quot;, clear the active state</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>           <span class="c1">// On &quot;mouse down&quot;, perform action,</span>
                <span class="kd">var</span> <span class="nx">term</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">term</span><span class="p">;</span>    <span class="c1">// such as filtering the results...</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Filter the results by &#39;&quot;</span><span class="o">+</span><span class="nx">term</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">));</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Dot</span><span class="p">)</span>                <span class="c1">// Add the left part of he &quot;inline&quot; label,</span>
                                                        <span class="c1">// displayed inside the donut &quot;hole&quot;</span>
            <span class="p">.</span><span class="nx">visible</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>                      <span class="c1">// The label is visible when its wedge is active</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                       <span class="p">.</span><span class="nx">active</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;#222&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Bar</span><span class="p">)</span>               <span class="c1">// Add the middle part of the label</span>
            <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;#222&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>                        <span class="c1">// Compute width:</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">d</span><span class="o">*</span><span class="mi">100</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>               <span class="c1">// add pixels for percents</span>
                              <span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span>
                       <span class="mi">10</span> <span class="o">+</span>                             <span class="c1">// add pixels for glyphs (%, etc)</span>
                       <span class="nx">entries</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>              <span class="c1">// add pixels for letters (very rough)</span>
                           <span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">length</span><span class="o">*</span><span class="mi">9</span><span class="p">;</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">top</span><span class="p">((</span><span class="nx">w</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">14</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Dot</span><span class="p">)</span>                <span class="c1">// Add the right part of the label</span>
            <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;#222&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>          <span class="c1">// Add the text to label</span>
                   <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">left</span><span class="p">((</span><span class="nx">w</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>                         <span class="c1">// Combine the text for label</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">d</span><span class="o">*</span><span class="mi">100</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span>
                       <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">entries</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">term</span> <span class="o">+</span>
                       <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="s2">&quot;#fff&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">canvas</span><span class="p">(</span><span class="nx">dom_id</span><span class="p">)</span>                        <span class="c1">// Bind the chart to DOM element</span>
            <span class="p">.</span><span class="nx">render</span><span class="p">();</span>                                  <span class="c1">// And render it.</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="p">{</span>                                            <span class="c1">// Create the public API</span>
        <span class="nx">data</span>   <span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
        <span class="nx">draw</span>   <span class="o">:</span> <span class="nx">draw</span>
    <span class="p">};</span>
<span class="p">};</span></code></pre></div>
<p>现在你们看到了，一个简单的JSON数据转换，我们就可以创建出丰富的有吸引力的关于我们文章标签分布的可视化图标。完整的例子在<a href="http://www.elasticsearch.cn/blog/assets/dashboards/donut.html">这里</a>。</p>
<p>当你使用完全不同的请求，比如显示某个特定作者的文章，或者特定日期内发表的文章，整个可视化都照样正常工作，代码是可以重用的。</p>
<h1 id="date-histogram-facets">日期直方图(date histogram facets)时间线</h1>
<p>Protovis让创建另一种常见的可视化类型也非常容易：<a href="http://vis.stanford.edu/protovis/ex/zoom.html">时间线</a>。任何类型的数据，只要和特定日期相关的，比如文章发表，事件发生，目标达成，都可以被可视化成时间线。</p>
<p>最终结果就像下面这样(同样可以看<a href="http://www.elasticsearch.cn/blog/assets/dashboards/timeline.html">运行版</a>)：</p>
<p><img src="http://www.elasticsearch.cn/blog/images/dashboards/timeline_chart.png" alt="图片4" /></p>
<p>好了，让我们往索引里存一些带有发表日期的文章吧：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl -X DELETE <span class="s2">&quot;http://localhost:9200/dashboard&quot;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;1&quot;,  &quot;published&quot; : &quot;2011-01-01&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;2&quot;,  &quot;published&quot; : &quot;2011-01-02&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;3&quot;,  &quot;published&quot; : &quot;2011-01-02&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;4&quot;,  &quot;published&quot; : &quot;2011-01-03&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;5&quot;,  &quot;published&quot; : &quot;2011-01-04&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;6&quot;,  &quot;published&quot; : &quot;2011-01-04&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;7&quot;,  &quot;published&quot; : &quot;2011-01-04&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;8&quot;,  &quot;published&quot; : &quot;2011-01-04&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;9&quot;,  &quot;published&quot; : &quot;2011-01-10&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;10&quot;, &quot;published&quot; : &quot;2011-01-12&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;11&quot;, &quot;published&quot; : &quot;2011-01-13&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;12&quot;, &quot;published&quot; : &quot;2011-01-14&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;13&quot;, &quot;published&quot; : &quot;2011-01-14&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;14&quot;, &quot;published&quot; : &quot;2011-01-15&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;15&quot;, &quot;published&quot; : &quot;2011-01-20&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;16&quot;, &quot;published&quot; : &quot;2011-01-20&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;17&quot;, &quot;published&quot; : &quot;2011-01-21&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;18&quot;, &quot;published&quot; : &quot;2011-01-22&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;19&quot;, &quot;published&quot; : &quot;2011-01-23&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/article&quot;</span> -d <span class="s1">&#39;{ &quot;t&quot; : &quot;20&quot;, &quot;published&quot; : &quot;2011-01-24&quot; }&#39;</span>
curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/_refresh&quot;</span></code></pre></div>
<p>我们用ES的<a href="http://www.elasticsearch.org/guide/reference/api/search/facets/date-histogram-facet.html">date histogram facet</a>来获取文章发表的频率。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl -X POST <span class="s2">&quot;http://localhost:9200/dashboard/_search?pretty=true&quot;</span> -d <span class="s1">&#39;</span>
<span class="s1">{</span>
<span class="s1">    &quot;query&quot; : { &quot;match_all&quot; : {} },</span>
<span class="s1">    &quot;facets&quot; : {</span>
<span class="s1">        &quot;published_on&quot; : {</span>
<span class="s1">            &quot;date_histogram&quot; : {</span>
<span class="s1">                &quot;field&quot;    : &quot;published&quot;,</span>
<span class="s1">                &quot;interval&quot; : &quot;day&quot;</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">&#39;</span></code></pre></div>
<p>注意我们是怎么设置间隔为天的。这个很容易就可以替换成周，月 ，或者年。</p>
<p>请求会返回像下面这样的JSON：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
    <span class="s2">&quot;took&quot;</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="c1">// ... snip ...</span>
    <span class="s2">&quot;hits&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;total&quot;</span> <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="c1">// ... snip ...</span>
    <span class="p">},</span>
    <span class="s2">&quot;facets&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;published&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;_type&quot;</span> <span class="o">:</span> <span class="s2">&quot;histogram&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entries&quot;</span> <span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;time&quot;</span> <span class="o">:</span> <span class="mi">1293840000000</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
                <span class="p">{</span> <span class="s2">&quot;time&quot;</span> <span class="o">:</span> <span class="mi">1293926400000</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span> <span class="o">:</span> <span class="mi">2</span> <span class="p">}</span>
                <span class="c1">// ... snip ...</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>我们要注意的是<code>facets.published.entries</code>数组，和上面的例子一样。同样需要一个HTML页来容纳图标和加载数据。机制既然一样，代码就直接看<a href="https://gist.github.com/900542/#file_chart.html">这里</a>吧。</p>
<p>既然已经有了JSON数据，用protovis创建时间线就很简单了，用一个自定义的<a href="http://vis.stanford.edu/protovis/ex/area.html">area chart</a>即可。</p>
<p>完整带注释的<code>Timeline()</code>函数如下：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// =====================================================================================================</span>
<span class="c1">// A timeline chart with Protovis - See http://vis.stanford.edu/protovis/ex/area.html</span>
<span class="c1">// =====================================================================================================</span>
<span class="kd">var</span> <span class="nx">Timeline</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dom_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">==</span> <span class="k">typeof</span> <span class="nx">dom_id</span><span class="p">)</span> <span class="p">{</span>                 <span class="c1">// Set the default DOM element ID to bind</span>
        <span class="nx">dom_id</span> <span class="o">=</span> <span class="s1">&#39;chart&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>                         <span class="c1">// Set the data for the chart</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">json</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>                        <span class="c1">// Set-up the data</span>
            <span class="nx">entries</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>                              <span class="c1">// Add the last &quot;blank&quot; entry for proper</span>
              <span class="nx">count</span> <span class="o">:</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">count</span>   <span class="c1">// timeline ending</span>
            <span class="p">});</span>
        <span class="c1">// console.log(&#39;Drawing, &#39;, entries);</span>
        <span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>                                    <span class="c1">// Set-up dimensions and scales for the chart</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="nx">max</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">entries</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">count</span><span class="p">;}),</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">w</span><span class="p">),</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">max</span><span class="p">).</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">()</span>                        <span class="c1">// Create the basis panel</span>
            <span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">right</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
         <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>                              <span class="c1">// Add the chart legend at top left</span>
            <span class="p">.</span><span class="nx">top</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                 <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">time</span><span class="p">);</span>
                 <span class="kd">var</span> <span class="nx">last</span>  <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">2</span><span class="p">].</span><span class="nx">time</span><span class="p">);</span>
                 <span class="k">return</span> <span class="s2">&quot;Articles published between &quot;</span> <span class="o">+</span>
                     <span class="p">[</span> <span class="nx">first</span><span class="p">.</span><span class="nx">getDate</span><span class="p">(),</span>
                       <span class="nx">first</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="nx">first</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
                     <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span>
                     <span class="s2">&quot; and &quot;</span> <span class="o">+</span>
                     <span class="p">[</span> <span class="nx">last</span><span class="p">.</span><span class="nx">getDate</span><span class="p">(),</span>
                       <span class="nx">last</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="nx">last</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
                     <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
             <span class="p">})</span>
            <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="s2">&quot;#B1B1B1&quot;</span><span class="p">)</span>
         <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>                               <span class="c1">// Add the X-ticks</span>
            <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">visible</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">time</span><span class="p">;})</span>
            <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s2">&quot;#33A3E1&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>              <span class="c1">// Add the tick label (DD/MM)</span>
            <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                 <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">time</span><span class="p">);</span>
                 <span class="k">return</span> <span class="p">[</span>
                     <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">(),</span>
                     <span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
                 <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
             <span class="p">})</span>
            <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="s2">&quot;#2C90C8&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">textMargin</span><span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
         <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Rule</span><span class="p">)</span>                               <span class="c1">// Add the Y-ticks</span>
            <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="nx">max</span><span class="p">))</span>                         <span class="c1">// Compute tick levels based on the &quot;max&quot; value</span>
            <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s2">&quot;#eee&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">tickFormat</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="s2">&quot;#c0c0c0&quot;</span><span class="p">)</span>
        <span class="nx">vis</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Panel</span><span class="p">)</span>                               <span class="c1">// Add container panel for the chart</span>
           <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Area</span><span class="p">)</span>                                <span class="c1">// Add the area segments for each entry</span>
           <span class="p">.</span><span class="nx">def</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>                           <span class="c1">// Auxiliary variable to hold mouse state</span>
           <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span>                               <span class="c1">// Pass the data to Protovis</span>
           <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);})</span>   <span class="c1">// Compute x-axis based on scale</span>
           <span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">count</span><span class="p">);})</span>    <span class="c1">// Compute y-axis based on scale</span>
           <span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="s1">&#39;cardinal&#39;</span><span class="p">)</span>                     <span class="c1">// Make the chart curve smooth</span>
           <span class="p">.</span><span class="nx">segmented</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>                             <span class="c1">// Divide into &quot;segments&quot; (for interactivity)</span>
           <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;#79D0F3&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>             <span class="c1">// On &quot;mouse over&quot;, set segment as active</span>
               <span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
               <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
           <span class="p">})</span>
           <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span>  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>             <span class="c1">// On &quot;mouse out&quot;, clear the active state</span>
               <span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
               <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
           <span class="p">})</span>
           <span class="p">.</span><span class="nx">event</span><span class="p">(</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>            <span class="c1">// On &quot;mouse down&quot;, perform action,</span>
               <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">].</span><span class="nx">time</span><span class="p">;</span>     <span class="c1">// eg filtering the results...</span>
               <span class="k">return</span> <span class="p">(</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Timestamp: &#39;&quot;</span><span class="o">+</span><span class="nx">time</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">));</span>
           <span class="p">})</span>
           <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Line</span><span class="p">)</span>                  <span class="c1">// Add thick stroke to the chart</span>
           <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">strokeStyle</span><span class="p">(</span><span class="s1">&#39;#33A3E1&#39;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Dot</span><span class="p">)</span>                   <span class="c1">// Add the circle &quot;label&quot; displaying</span>
                                                        <span class="c1">// the count for this day</span>
           <span class="p">.</span><span class="nx">visible</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>                       <span class="c1">// The label is only visible when</span>
               <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>           <span class="c1">// its segment is active</span>
                          <span class="p">.</span><span class="nx">active</span><span class="p">()</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
            <span class="p">})</span>
           <span class="p">.</span><span class="nx">left</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span> <span class="p">})</span>
           <span class="p">.</span><span class="nx">bottom</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="p">})</span>
           <span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="s2">&quot;#33A3E1&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">lineWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">anchor</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">pv</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>             <span class="c1">// Add text to the label</span>
           <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">count</span><span class="p">;})</span>
           <span class="p">.</span><span class="nx">textStyle</span><span class="p">(</span><span class="s2">&quot;#E7EFF4&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">canvas</span><span class="p">(</span><span class="nx">dom_id</span><span class="p">)</span>                        <span class="c1">// Bind the chart to DOM element</span>
           <span class="p">.</span><span class="nx">render</span><span class="p">();</span>                                  <span class="c1">// And render it.</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="p">{</span>                                            <span class="c1">// Create the public API</span>
        <span class="nx">data</span>   <span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
        <span class="nx">draw</span>   <span class="o">:</span> <span class="nx">draw</span>
    <span class="p">};</span>
<span class="p">};</span></code></pre></div>
<p>完整示例代码在<a href="http://www.elasticsearch.cn/blog/assets/dashboards/timeline.html">这里</a>。不过先去下载protovis提供的关于<a href="http://vis.stanford.edu/protovis/docs/area.html">area</a>的原始文档，然后观察当你修改<code>interpolate('cardinal')</code>成<code>interpolate('step-after')</code>后发生了什么。对于多个facet，画叠加的区域图，添加交互性，然后完全定制可视化应该都不是什么问题了。</p>
<p>重要的是注意，这个图表完全是根据你传递给ES的请求做出的响应，使得你有可能做到简单立刻的完成某项指标的可视化需求。比如“显示这个作者在这个主题上最近三个月的出版频率”。只需要提交这样的请求就够了：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">author:John AND topic:Search AND published:<span class="o">[</span>2011-03-01 TO 2011-05-31<span class="o">]</span></code></pre></div>
<h1 id="section-1">总结</h1>
<p>当你需要为复杂的自定义查询做一个丰富的交互式的数据可视化时，使用ES的facets应该是最容易的办法之一，你只需要传递ES的JSON响应给<a href="http://vis.stanford.edu/protovis/">Protovis</a>这样的工具就好了。</p>
<p>通过模仿本文中的方法和代码，你可以在几小时内给你的数据跑通一个示例。</p>
    <hr>
    <div class="pagination">
      <ul>
        <li class="prev"><a href="/2012/11/18/coro" title="【翻译】Coro模块文档">&larr; Previous</a></li>
        <li><a href="/archive.html">Archive</a></li>
        <li class="next"><a href="/2012/11/19/syslog-realtime-warning-to-speech" title="syslog实时报警"说出来"">Next &rarr;</a></li>
      </ul>
    </div>
    <hr>
  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_tsina">新浪微博</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_renren">人人网</a>
<a class="jiathis_button_ydnote">有道云笔记</a>
<a class="jiathis_button_gmail">Gmail邮箱</a>
<a class="jiathis_button_twitter">Twitter</a>
<a class="jiathis_button_googleplus">Google+</a>
<a class="jiathis_button_hi">百度空间</a>
<a class="jiathis_button_fb">Facebook</a>
<a class="jiathis_button_douban">豆瓣</a>
<a href="http://www.jiathis.com/share?uid=1589850" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
	data_track_clickback:true,
	summary:"",
	ralateuid:{
		"tsina":"1035836154"
	},
	shortUrl:false,
	hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1589850" charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1589850" async=""></script>
<!-- UY END -->
  </div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
                 <li><a href="/2015/03/06/kibana4-for-slowlog">用 Kibana4 实现 PHP 慢日志函数堆栈分析</a></li>
                 <li><a href="/2015/02/25/kibana-aggregation-execution-order-and-you">【翻译】kibana 的聚合执行次序</a></li>
                 <li><a href="/2015/02/25/kibana-4-rc1-is-now-available">【翻译】Kibana 4 RC1 发布</a></li>
                 <li><a href="/2015/02/25/kibana-4-literally">【翻译】kibana 4 正式就位</a></li>
                 <li><a href="/2015/02/25/kibana-4-for-investigating-pacs-super-pacs-and-your-neighbors">【翻译】用 kibana 4 调查你邻居可能投票给的人</a></li>
                 <li><a href="/2015/02/14/spark-streaming-transform">spark streaming 的 transform 操作示例</a></li>
                 <li><a href="/2015/02/14/spark-streaming-state">spark streaming 的 state 操作示例</a></li>
                 <li><a href="/2015/02/13/spark-streaming-sql">spark streaming 和 spark sql 结合示例</a></li>
                 <li><a href="/2015/02/12/rsyslog-forwarder-testing">rsyslog 的 TCP 转发性能测试</a></li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(英文)</li>
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
              <li><a href="http://neilb.org/" title="The good,the bad,and the beautiful">neilb</a></li>
              <li><a href="http://www.reddit.com/r/perl/" title="">reddit perl 频道</a></li>
              <li><a href="http://jpetazzo.github.io/" title="">~jpetazzo</a></li>
              <li><a href="http://www.perfplanet.com/" title="News and views from the web performance blogosphere">Performance Planet</a></li>
              <li><a href="http://cuddletech.com/blog/" title="Use UNIX or die">Cuddle Tech</a></li>
              <li><a href="http://showmetheco.de/" title="Viacheslav Tykhanovskyi(PocketIO/Text::Haml)">No time to wait</a></li>
              <li><a href="http://blog.dataloop.io/" title="A new SaaS monitoring tool for DevOps & Operations">Dataloop.IO</a></li>
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
              <li><a href="http://planeteria.org/perl6/" title="Perl6 文集">Planet Perl 6</a></li>
              <li><a href="http://www.metaforsoftware.com/blog/" title="">metafor</a></li>
              <li><a href="http://blog.kablamo.org/" title="Eric Johnson，一个游走在伦敦和北京的 Perler">kablamo</a></li>
              <li><a href="http://aphyr.com/posts" title="call me maybe 吐槽系列">Aphyr</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(中文)</li>
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
              <li><a href="http://timo.piqiu.me/" title="TIMO IS MY OASIS">Timo</a></li>
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
              <li><a href="http://www.lark.net.cn/" title="王剑">lark's cloud</a></li>
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
              <li><a href="http://blog.liulantao.com/" title="刘兰涛">Lax</a></li>
              <li><a href="http://niubie.me/" title="莫言">莫言</a></li>
              <li><a href="http://noops.me/" title="小米运维部">NoOps</a></li>
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
              <li><a href="http://www.usefulshare.com" title="当当网安全运维">UsefulShare</a></li>
              <li><a href="http://junqili.com/" title="深入研究puppet">纸飞机</a></li>
              <li><a href="http://www.chinaxing.org/" title="">ChinaXing</a></li>
              <li><a href="http://bubbyroom.com/" title="守住每一天">Liuyu's blog</a></li>
              <li><a href="http://blog.aka-cool.net/" title="">Aka.Why</a></li>
              <li><a href="http://blog.l8ii.com/" title="刘侨">LairdNote</a></li>
              <li><a href="http://flw.tools/" title="">flw的工具箱</a></li>
              <li><a href="http://blog.mcshell.org/" title="">mcshell</a></li>
              <li><a href="http://novoland.github.io/" title="">克鲁斯卡尔的博客</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="booklists" class="nav nav-list">
          <li class="nav-header">我写的第一本技术书籍</li>
          <li><a href='http://product.china-pub.com/3769604'><img src='http://images.china-pub.com/ebook3765001-3770000/3769604/shupi.jpg' border='0' alt='网站运维技术与实践'/></a></li>
          <li class="nav-header">我写的两本电子书籍</li>
          <li><a href='http://chenryn.gitbooks.io/logstash-best-practice/'><img src='https://sm3lir.cloudimage.io/s/cdn/x/https://www.gitbook.io/cover/book/chenryn/logstash-best-practice?build=1416299695472' border='0' alt='LogStash 最佳实践'/></a></li>
          <li><a href='http://kibana.logstash.es/'><img src='https://sm3lir.cloudimage.io/s/cdn/x/https://www.gitbook.io/cover/book/chenryn/kibana-guide-cn?build=1415872457562' border='0' alt='Kibana 中文指南'/></a></li>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
  </body>
</html>
