<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>三斗室</title>
    <meta name="author" content="陈子">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygments/default.css" rel="stylesheet" type="text/css">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">三斗室</a>
          <ul class="nav">
      	<li><a href="/archive/">归档</a></li>
      	<li><a href="/categories/">分类</a></li>
      	<li><a href="/elk-errata/">《ELK stack权威指南》勘误</a></li>
      	<li><a href="/errata/">《网站运维技术与实践》勘误</a></li>
      	<li><a href="/pages/">Pages</a></li>
      	<li><a href="/projects/">学习记录</a></li>
      	<li><a href="/tags/">标签</a></li>
            <li><a href="http://chenlinux.com/poetry/index.html" />诗文集</a></li>
            <li><link title="RSS 2.0" type="application/rss+xml" href="http://chenlinux.com/feed.xml" rel="alternate" /><a href="http://chenlinux.com/feed.xml" target="_blank">RSS订阅</a></li>
          </ul>
          <ul class="nav pull-right"><li><a href="/about.html">有关我</a></li></ul>
        </div>
      </div>
    </div>
    <div class="container">
    <div class="row">
      <div class="span7">
<div class="row">
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/27/prepare-mysql-for-self-monitor/" title="cdn自主监控(三):数据库准备工作" rel="bookmark">cdn自主监控(三):数据库准备工作</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-27 00:00:00 +0800">27 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>准备两个表，一个存储原始数据，另一个存储每5分钟归总一次的数据。之后根据时间段绘制省份运营商性能图的时候，就直接从汇总表里获取数据；原始表留给详细查询。<br />
数据库准备脚本如下：<br />
```mysqlUSE myops;<br />
CREATE TABLE IF NOT EXISTS cdn_ori_record (<br />
	id INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,<br />
	ip INT(10) NOT NULL DEFAULT &lsquo;0000000000&rsquo;,<br />
	isp ENUM(&lsquo;0&rsquo;,&rsquo;1&rsquo;,&rsquo;2&rsquo;,&rsquo;3&rsquo;,&rsquo;4&rsquo;),<br />
	area INT(4) NOT NULL DEFAULT &lsquo;0000&rsquo;,<br />
	cur_date TIMESTAMP DEFAULT NOW(),<br />
	cdn_time INT(10) NOT NULL DEFAULT &lsquo;0&rsquo;,<br />
	cdn ENUM(&lsquo;CHINACACHE&rsquo;,&rsquo;DNION&rsquo;,&rsquo;FASTWEB&rsquo;) NOT NULL,<br />
	KEY time_key (cur_date)<br />
);
      <a href="/2011/07/27/prepare-mysql-for-self-monitor/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/26/seek-iplist-for-self-monitor/" title="cdn自主监控(二):快速查找ip对应信息" rel="bookmark">cdn自主监控(二):快速查找ip对应信息</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-26 00:00:00 +0800">26 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>话接上篇，ip整理出来，然后就是接一个ip地址，快速定位查找到它属于哪个ip段，然后返回具体的省份和运营商。因为之前的ip已经转换成数字，而且是顺序排列的，所以可以采用折半算法(二分法)。perl脚本如下：<br />
```perl#!/usr/bin/perl -w<br />
#my $ip = inet_aton(&ldquo;$ARGV[0]&rdquo;);<br />
my $ip = inet_aton(get_test_ip());<br />
my $file = $ARGV[1] || &lsquo;iplist.txt&rsquo;;<br />
my $length = <code class="highlighter-rouge">cat $file | wc -l</code>;
      <a href="/2011/07/26/seek-iplist-for-self-monitor/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/25/overwrite-qqwry-for-self-monitor/" title="cdn自主监控(一):整理一个可用范围内的尽可能小的ip库" rel="bookmark">cdn自主监控(一):整理一个可用范围内的尽可能小的ip库</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-25 00:00:00 +0800">25 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>为了跟第三方监控做对比和作为备用，准备自己通过页面js返回数据做个监控。首先第一步，整理一个足够自己用的ip库。<br />
首先，考虑调用会比较频繁，打算把内容尽可能归并，到省级运营商即可；<br />
其次，未知归并完会有多大的情况下，考虑到qqwry的地区都是中文，打算统一使用电话区号代替地区，运营商也有一位数字代替，ip采用inet-aton网络值代替；这样每条记录的字节数固定，可以方便采用seek和sysread提高读取某条记录的速度。
      <a href="/2011/07/25/overwrite-qqwry-for-self-monitor/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/21/some-tests-about-perl/" title="perl小测试题(转自CU)" rel="bookmark">perl小测试题(转自CU)</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-21 00:00:00 +0800">21 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>原贴地址：http://bbs.chinaunix.net/thread-3563215-1-1.html<br />
flw回帖里有翻译，我试答如下：<br />
1. Perl 5 中变量名开头的那个字符（sigils）有哪几种、分别都有什么含义？<br />
$标量@数组%散列&amp;函数<br />
2. 访问一个数组元素时，用 $items[$index] 和用 @items[$index] 有什么区别？<br />
$是标量，@是数组切片<br />
3. 请问 == 和 eq 之间的区别是什么？<br />
分别是数值和字符的比较<br />
4. 在列表上下文中对一个 hash 求值，会得到什么？<br />
应该是得到一个数组？<br />
5. 如何查看关键字的 Perl 文档？<br />
perldoc -f <br />
6. Perl 5 中的函数和方法有什么不同？<br />
方法是bless后的函数调用？<br />
7. Perl 5 什么时候对一个变量所使用的内存进行回收？<br />
引用计数器清空后？（好像记得是）或者执行完成退出的时候<br />
8. 如何做才能够确保一个变量的缺省作用域是词法作用域？<br />
my local？<br />
9. 如何加载模块并且从中导入符号？<br />
use Module;<br />
符号是啥？<br />
10. 是什么在控制 Perl 如何加载模块？有什么办法可以指定一个目录清单告诉 Perl 从这些地方尝试加载模块？<br />
不知道。<br />
use lib qw();或者perl -I或者export PERL5LIB=<br />
11. 你怎么在 Perl 5 的文档中中查看一条错误信息说明？（加分项：了解如何为所有遇到过的错误信息启用解释）<br />
汗，这个用|less然后/搜索……有好办法么？<br />
12. 试着阐述一下把数组传递给函数的时候会发生什么事。<br />
应该是复制一个数组副本出来，然后赋值到@<em>给函数用？<br />
13. 如何传递多个独立的数组给函数？<br />
分别传递数组引用。<br />
14. 对于调用方来说，return 和 return undef 有什么区别？<br />
return的应该是上一个的结果吧？<br />
15. Where do tests go in a standard CPAN distribution?<br />
module里头都有t/目录可以test吧，然后cpan.org上有志愿者？<br />
16. 拿到一个 CPAN 模块后怎样进行测试？<br />
make test<br />
17. 你用什么命令从 CPAN 上安装新模块？<br />
cpanm Module<br />
18. 为什么要使用 open 函数的三参数形式？<br />
预防文件名带有&gt;等特殊字符串<br />
19. 如何检测（和报告）像 open 这样的系统调用产生的错误？（加分项: 知道如何开启自动检测和报告）<br />
在open的时候接上or die $@；<br />
use autodie;<br />
20. 如何在 Perl 5 中抛出一个异常？<br />
die<br />
21. 如何在 Perl 5 中捕获一个异常？<br />
eval {}<br />
22. 用 for 读文件和用 while 读文件有什么不同吗？<br />
for一次性读入；while一次一行<br />
23. 在 Perl 5 的函数或者方法中，你分别是如何处理参数的？<br />
my $abc = shift;<br />
my ($abc, $def) = @</em>;<br />
24. my ($value) = @_; 中的小括号有什么用？如果删掉会发生什么？<br />
强制为列表环境；<br />
删掉之后变成标量环境就是@_的元素个数了。<br />
25. new 是 Perl 5 的内置函数或者关键字吗？<br />
不是，模块里要自己写new方法。<br />
26. 你怎么看 Perl 的核心模块的文档？如果是 CPAN 模块的话又该如何看？<br />
perldoc查看，不过核心模块和一般模块方法有区别么？<br />
27. 怎样只访问 hash 的值？<br />
values函数
      <a href="/2011/07/21/some-tests-about-perl/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/08/mysql_history_monitor/" title="mysql_history_monitor" rel="bookmark">mysql_history_monitor</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-08 00:00:00 +0800">08 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>上篇加了bash_history的监控，这篇说mysql_history的监控。不像bash4，mysql自始至终没有提供过syslog的代码，只能自己通过守护进程去实时获取~/.mysql_history的记录了。一个小脚本如下：<br />
```perl#!/usr/bin/perl -w<br />
use POE qw(Wheel::FollowTail);<br />
use Log::Syslog::Fast qw(:all);
      <a href="/2011/07/08/mysql_history_monitor/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/07/08/bash_syslog_history/" title="bash_syslog_history" rel="bookmark">bash_syslog_history</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-07-08 00:00:00 +0800">08 Jul 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>@钚钉钬影 童鞋要试验系统日志收集处理，采用rsyslog+loganalyzer做界面，因为需求有把bash_history也带上，所以采用修改bash源码的方式。最先采用了bash4.2（bash4.2已经带了这个功能，但是默认不开启，删掉哪个/**/就行了），不过因为这个bash4.+跟redhat的network-functions脚本有点小矛盾，重启的时候报个错——虽然改起来也很简单，就是加一个./的事情——不过本着尽量改动少的原则，换回bash3.1。<br />
bash3.1里默认没有记录syslog的代码，所以从bash4.2/bashhist.c里复制有关bash_syslog_history代码段到bash3.1中——注意不是原样复制到bashhist.c，那样不顶用——需要复制到lib/readline/history.c中，如下：<br />
```c<br />
+   #include <syslog.h>
……
void
add_history (string)
     const char *string;
{
HIST_ENTRY *temp;</syslog.h>
      <a href="/2011/07/08/bash_syslog_history/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/28/a-dancer-demo-of-monitor-squid/" title="squid监控+dancer小试验" rel="bookmark">squid监控+dancer小试验</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-28 00:00:00 +0800">28 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#dancer-ref" title="dancer" rel="category tag">dancer</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>squid监控之前有一篇关于snmp的内容，不过这次是真要用上了，所以细细挑出来几个做监控。碰巧凯哥更新了一把modern perl的东西，我亦步亦趋，也试试dancer。不过花了两天时间，DBIx::Class::Schema还是没搞出来，最终还是简单的用DBI跳过了……<br />
用的database就是之前nmap试验时生成的数据，有application/channel/intranet等column。<br />
首先安装：<br />
<code class="highlighter-rouge">perlcpanm Dancer DBI DBD:mysql Template Dancer::Session::YAML
dancer -a cachemoni
</code><br />
然后修改cachemoni/lib/cachemoni.pm如下：<br />
```perl<br />
package cachemoni;<br />
use Dancer &lsquo;:syntax&rsquo;;<br />
use Dancer::Plugin::Database;<br />
use Net::SNMP;<br />
use Digest::MD5 qw(md5_hex);<br />
our $VERSION = &lsquo;0.1&rsquo;;
      <a href="/2011/06/28/a-dancer-demo-of-monitor-squid/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/23/make-patch-of-squid-snmp/" title="patch制作和使用" rel="bookmark">patch制作和使用</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-23 00:00:00 +0800">23 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>做运维几年没用过patch，说来也怪了~~趁着上一篇自己的小改动，熟悉一下这个命令的简单用法。<br />
首先是patch的制作，用diff命令。<br />
<code class="highlighter-rouge">bashtar zxvf squid-2.7.STABLE9.tar.gz
cp squid-2.7.STABLE9 squid-2.7.STABLE9-old &amp;&amp; mv squid-2.7.STABLE9 squid-2.7.STABLE9-new
#然后按照上篇的内容修改squid-2.7.STABLE9-new/里的文件
diff -uNr squid-2.7.STABLE9-old squid-2.7.STABLE9-new &gt; squid-snmp.patch</code><br />
这就完成了，好简单啊~来看看patch文件的内容吧：<br />
<code class="highlighter-rouge">cdiff -uNr squid-2.7.STABLE9-old/include/cache_snmp.h squid-2.7.STABLE9-new/include/cache_snmp.h
--- squid-2.7.STABLE9-old/include/cache_snmp.h	2006-09-22 10:49:24.000000000 +0800
+++ squid-2.7.STABLE9-new/include/cache_snmp.h	2011-06-23 13:25:04.000000000 +0800
@@ -125,6 +125,7 @@
     MESH_PTBL_KEEPAL_S,
     MESH_PTBL_KEEPAL_R,
     MESH_PTBL_INDEX,
+    MESH_PTBL_CONN_OPEN,
     MESH_PTBL_HOST,
     MESH_PTBL_END
 };
diff -uNr squid-2.7.STABLE9-old/src/snmp_agent.c squid-2.7.STABLE9-new/src/snmp_agent.c
--- squid-2.7.STABLE9-old/src/snmp_agent.c	2009-06-26 06:58:10.000000000 +0800
+++ squid-2.7.STABLE9-new/src/snmp_agent.c	2011-06-23 13:27:31.000000000 +0800
@@ -264,6 +264,11 @@
 	    index,
 	    ASN_INTEGER);
 	break;
+    case MESH_PTBL_CONN_OPEN:
+        Answer = snmp_var_new_integer(Var-&gt;name, Var-&gt;name_length,
+            p-&gt;stats.conn_open,
+            ASN_INTEGER);
+        break;
     default:
 	*ErrP = SNMP_ERR_NOSUCHNAME;
 	break;
diff -uNr squid-2.7.STABLE9-old/src/snmp_core.c squid-2.7.STABLE9-new/src/snmp_core.c
--- squid-2.7.STABLE9-old/src/snmp_core.c	2008-05-05 07:23:13.000000000 +0800
+++ squid-2.7.STABLE9-new/src/snmp_core.c	2011-06-23 20:36:54.000000000 +0800
@@ -321,7 +321,7 @@
 						snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 1, 15),
 						    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_Inst, 0)),
 					    snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 2, SQ_MESH, 1, 2),
-						LEN_SQ_MESH + 2, NULL, NULL, 15,
+						LEN_SQ_MESH + 2, NULL, NULL, 16,
 						snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 1),
 						    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0),
 						snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 2),
@@ -351,6 +351,8 @@
 						snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 14),
 						    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0),
 						snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 15),
+                                                    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0),
+                                                snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 16),
 						    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0))),
 					snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 1, SQ_MESH, 2),
 					    LEN_SQ_MESH + 1, NULL, NULL, 1,</code><br />
制作练完了，再练一次使用：<br />
<code class="highlighter-rouge">bashcd squid-2.7.STABLE9-old
mv ../squid-snmp.patch .
patch -p1 &lt; squid-snmp.patch</code><br />
-p指定从那层目录开始，因为之前diff的时候顶层目录分别叫old和new，如果在其他地方时候的话，别人的目录肯定不会这么命名的，所以就往里进一层，然后用-p1来patch。<br />
然后more一下那三个文件，确认都修改了~<br />
最后回退patch：<br />
<code class="highlighter-rouge">bashpatch -R -p1 &lt; squid-snmp.patch</code><br />
完成~
      <a href="/2011/06/23/make-patch-of-squid-snmp/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/22/extend-open_conn-output-support-to-squid-snmp/" title="给squid的snmp增加open_conn输出" rel="bookmark">给squid的snmp增加open_conn输出</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-22 00:00:00 +0800">22 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>做反向代理的squid集群监控，在单机维护时，squidclient mgr:server_list里的OPEN CONNS是经常看的一项数据，不过在开启snmp支持后，在mib里却没有找到相关的数据。还一度怀疑是不是cachePeerKeepAlRecv或者cachePeerKeepSent。今天想起来去src里grep了一把源码，顺利的在squid/src/neighbors.c里看到了OPEN CONNS等数据的来源，如下：<br />
<code class="highlighter-rouge">cstatic void
dump_peers(StoreEntry * sentry, peer * peers)
{
    peer *e = NULL;
……
    for (e = peers; e; e = e-&gt;next) {
……
        storeAppendPrintf(sentry, "OPEN CONNS : %d\n", e-&gt;stats.conn_open);
……
        storeAppendPrintf(sentry, "keep-alive ratio: %d%%\n",
            percent(e-&gt;stats.n_keepalives_recv, e-&gt;stats.n_keepalives_sent));</code><br />
然后在squid/src/snmp_agent.c里看到了这些数据的snmp输出，如下：<br />
<code class="highlighter-rouge">cvariable_list *
snmp_meshPtblFn(variable_list * Var, snint * ErrP)
{
    variable_list *Answer = NULL;
    struct in_addr *laddr;
    int loop, index = 0;
    char *cp = NULL;
    peer *p = NULL;
    int cnt = 0;
……
    switch (Var-&gt;name[LEN_SQ_MESH + 2]) {
    case MESH_PTBL_NAME:
        cp = p-&gt;name;
        Answer = snmp_var_new(Var-&gt;name, Var-&gt;name_length);
……
    case MESH_PTBL_KEEPAL_R:
        Answer = snmp_var_new_integer(Var-&gt;name, Var-&gt;name_length,
            p-&gt;stats.n_keepalives_recv,
            SMI_COUNTER32);
        break;
    case MESH_PTBL_INDEX:
        Answer = snmp_var_new_integer(Var-&gt;name, Var-&gt;name_length,
            index,
            ASN_INTEGER);
        break;
    default:
        *ErrP = SNMP_ERR_NOSUCHNAME;
        break;
    }
    return Answer;
}</code><br />
一对比，发现确实没有stats.conn_open输出……<br />
好在这个比较简单，稍微改一下，就能搞出来：<br />
1、修改squid/include/cache_snmp.h如下：<br />
<code class="highlighter-rouge">cenum {                          /* cachePeerTable */
……
    MESH_PTBL_CONN_OPEN,   /*新增这个*/
    MESH_PTBL_HOST,
    MESH_PTBL_END
};</code><br />
2、修改squid/src/snmp_core.c如下：<br />
<code class="highlighter-rouge">c
void
snmpInit(void)
{
……
                                            snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 2, SQ_MESH, 1, 2),
/* LEN_SQ_MESH + 2, NULL, NULL, 15,这里改成16，大概在324行，通过原来的MIB知道有15的地方就两个，peer的是后一个 */
                                                LEN_SQ_MESH + 2, NULL, NULL, 16,
……
                                                snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 15),
                                                    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0),
                                                snmpAddNode(snmpCreateOid(LEN_SQ_MESH + 3, SQ_MESH, 1, 2, 16), /*新增这个16*/
                                                    LEN_SQ_MESH + 3, snmp_meshPtblFn, peer_InstIndex, 0))),</code><br />
3、修改squid/src/snmp_agent.c如下：<br />
<code class="highlighter-rouge">c……
    case MESH_PTBL_INDEX:
        Answer = snmp_var_new_integer(Var-&gt;name, Var-&gt;name_length,
            index,
            ASN_INTEGER);
        break;
/*新增下面这段，case的内容在第1步cache_snmp.h里增加了；stats.conn_open由之前grep的结果得知；INTEGER是数值类型，照抄RTT的即可*/
    case MESH_PTBL_CONN_OPEN:
        Answer = snmp_var_new_integer(Var-&gt;name, Var-&gt;name_length,
            p-&gt;stats.conn_open,
            ASN_INTEGER);
        break;
</code><br />
4、重新编译squid，然后用snmpwalk获取数据观察：<br />
<code class="highlighter-rouge">bash[root@naigos myops]# snmpwalk -v 2c -c cacti_china 10.168.168.69 .1.3.6.1.4.1.3495.1.5.1.2  -Cc  | tail
SNMPv2-SMI::enterprises.3495.1.5.1.2.13.3 = Counter32: 0
SNMPv2-SMI::enterprises.3495.1.5.1.2.14.1 = INTEGER: 1
SNMPv2-SMI::enterprises.3495.1.5.1.2.14.2 = INTEGER: 2
SNMPv2-SMI::enterprises.3495.1.5.1.2.14.3 = INTEGER: 3
SNMPv2-SMI::enterprises.3495.1.5.1.2.15.1 = INTEGER: 3
SNMPv2-SMI::enterprises.3495.1.5.1.2.15.2 = INTEGER: 5
SNMPv2-SMI::enterprises.3495.1.5.1.2.15.3 = INTEGER: 6
SNMPv2-SMI::enterprises.3495.1.5.1.2.16.1 = STRING: "10.168.170.43"
SNMPv2-SMI::enterprises.3495.1.5.1.2.16.2 = STRING: "10.168.168.73"
SNMPv2-SMI::enterprises.3495.1.5.1.2.16.3 = STRING: "10.168.168.122"</code><br />
原来的SNMPv2-SMI::enterprises.3495.1.5.1.2.15.1 = STRING: &ldquo;10.168.170.43&rdquo;变成了SNMPv2-SMI::enterprises.3495.1.5.1.2.16.1 = STRING: &ldquo;10.168.170.43&rdquo;，而SNMPv2-SMI::enterprises.3495.1.5.1.2.15.1 = INTEGER: 3就是需要的open_conn数据了！
      <a href="/2011/06/22/extend-open_conn-output-support-to-squid-snmp/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/14/intro-mybench/" title="mysql测试小工具mybench试用" rel="bookmark">mysql测试小工具mybench试用</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-14 00:00:00 +0800">14 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#testing-ref" title="testing" rel="category tag">testing</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>小型的mysql测试工具，主要有自带的mysqlslap、super-smack和mybench。嗯，我这里的小型的意思是指工具安装过程简单。<br />
mysqlslap的使用方法遍地都是，就不先详细写了。根据个人偏好写写mybench吧，毕竟是perl的。<br />
安装很简单，如下：<br />
<code class="highlighter-rouge">bashcpanm DBI DBD::mysql Time::HiRes
wget http://jeremy.zawodny.com/mysql/mybench/mybench-1.0.tar.gz
tar zxvf mybench-1.0.tar.gz
cd mybench-1.0
perl MakeFile.PL &amp;&amp; make &amp;&amp; make install</code><br />
但是使用就不是太简单了——mysqlslap会自己生成（-a选项）sql，super-smack则带了一个gen-data程序生成数据然后自动导入，但是mybench没有，所以只能自己搞定数据。<br />
不过mybench还是自己生成了一个测试模版的脚本在/usr/bin/bench_example，很简单的就知道怎么做了。<br />
example如下：<br />
```perl#!/usr/bin/perl -w
      <a href="/2011/06/14/intro-mybench/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/10/java-chinese-support/" title="java的中文支持" rel="bookmark">java的中文支持</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-10 00:00:00 +0800">10 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>往论坛上传图片，有的图片上有中文字，却显示成方框。求助了一下度娘，快速解决。记录一下：<br />
* 第一步，在windows下找到simsun.ttc文件，嗯，ntfs系统下强力推荐everything小工具一个；<br />
* 第二步，上传simsun.ttc到服务器的/usr/share/fonts/zh_CN/下，其他路径也行，不过这个路径比较通用；<br />
* 第三步，在$JAVA_HOME/jrp/lib/下创建fontconfig.properties.zh文件，原型格式可见同目录下的fontconfig.properties.src。<br />
fontconfig.properties.zh文件相关内容如下：<br />
<code class="highlighter-rouge">java
allfonts.chinese-gbk=-misc-simsun-medium-r-normal--*-%d-*-*-p-*-gbk-0
allfonts.chinese-gb2312=-misc-simsun-medium-r-normal--*-%d-*-*-p-*-gb2312.1980-0
sequence.allfonts.GB18030=latin-1,chinese-gbk,chinese-cn-iso10646
sequence.allfonts.GBK=latin-1,chinese-gbk
sequence.allfonts.GB2312=latin-1,chinese-gb2312
sequence.allfonts.UTF-8.ko.KR=latin-1,korean,japanese-x0208,japanese-x0201,chinese-gbk
sequence.allfonts.UTF-8.ja.JP=latin-1,japanese-x0208,japanese-x0201,chinese-gbk,korean
sequence.fallback=lucida,chinese-big5,chinese-gbk,japanese-x0208,korean
filename.-misc-simsun-medium-r-normal--*-%d-*-*-p-*-gbk-0=/usr/share/fonts/zh_CN/simsun.ttc
filename.-misc-simsun-medium-r-normal--*-%d-*-*-p-*-gb2312.1980-0=/usr/share/fonts/zh_CN/simsun.ttc
awtfontpath.chinese-gb2312=/usr/share/fonts/zh_CN
awtfontpath.chinese-gbk=/usr/share/fonts/zh_CN
</code><br />
很简单的一件小事儿，一来作个记录，二来测试微博同步——从百度统计看我可怜的一点点访问都来自微博……
      <a href="/2011/06/10/java-chinese-support/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/09/statistics-descriptive-module-of-perl/" title="perl模块Statistics::Descriptive" rel="bookmark">perl模块Statistics::Descriptive</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-09 00:00:00 +0800">09 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>今天写基调测试报告，需要从原始的ping延时和丢包率数据中自己计算标准方差以评估波动性（直接运行ping命令可见，不过基调报告里没有）。<br />
方差是各个数据与其平均数的差的平方的平均数。标准差（均方差）则是方差的算术平方根。<br />
这个时候可以打开excel……不过作为excel只会填文字的人，只好打开CPAN来解决问题了~<br />
<code class="highlighter-rouge">perl#!/usr/bin/perl -w
use Statistics::Descriptive;
use strict;
open FH,'&lt;','data';
my $data={};
while(&lt;FH&gt;){
   my @F = split;
   push @{$data-&gt;{"快网延时"}}, $F[3];
   push @{$data-&gt;{"快网丢包"}}, $F[4];
   push @{$data-&gt;{"森华延时"}}, $F[6];
   push @{$data-&gt;{"森华丢包"}}, $F[7];
   push @{$data-&gt;{"帝联延时"}}, $F[9];
   push @{$data-&gt;{"帝联丢包"}}, $F[10];
}
close FH;
my $stat = Statistics::Descriptive::Full-&gt;new();
foreach my $key (sort keys %{$data}) {
    $stat-&gt;add_data(@{$data-&gt;{"$key"}});
    print $key."\t".$stat-&gt;standard_deviation(),"\n";
    $stat-&gt;clear();
}</code><br />
记住一定要clear，不然的话add_data会接着上一次的加，然后数据就错了。
      <a href="/2011/06/09/statistics-descriptive-module-of-perl/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/09/intro-spread/" title="spread试验" rel="bookmark">spread试验</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-09 00:00:00 +0800">09 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>spread还是半年前的时候偶然看到的，一直没有试过。前段时间用gearman收集集群日志时，发现gearman的方式，worker不会知道client来自哪里，一条job只会一个worker来做，比较适合做分布式计算，但相比我最初设想的实时系统管理需求，还是有一定距离。于是重新翻出来spread，感觉可以根据应用系统设置不同的group，然后统一再由一个回收结果的group即可。于是有了如下试验：
      <a href="/2011/06/09/intro-spread/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/09/inode-problem-of-tmpfs/" title="tmpfs的inode问题" rel="bookmark">tmpfs的inode问题</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-09 00:00:00 +0800">09 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#linux-ref" title="linux" rel="category tag">linux</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>一些squid服务器为了强调加速效果，使用tmpfs来做cache_dir。刚开始运行的时候也嗖嗖的，不过没过一两天，mgr:info就看到缓存命中率急剧下降，字节命中率甚至只剩下10%左右！检查了多次配置，绝对没有问题，但同样的url，曾经一分钟几百次的HIT，现在一分钟几百次MISS……<br />
df看，不管是tmpfs，还是logs所在的目录，都才用了不到30%。最后想起来df -i看了下，果然，tmpfs的inode使用率100%了！<br />
赶紧remount了一次，解决了问题。但不是根本出路。还是得想办法搞定这个inode。<br />
在linux代码说明里找到了关于tmpfs的文档（/usr/src/linux/Documentation/filesystems/tmpfs.txt）：<br />
    tmpfs has three mount options for sizing:<br />
    ……<br />
    nr_inodes: The maximum number of inodes for this instance. <strong>The default
               is half of the number of your physical RAM pages</strong>, or (on a<br />
               machine with highmem) the number of lowmem RAM pages,<br />
               whichever is the lower.<br />
    These parameters accept a suffix k, m or g for kilo, mega and giga and<br />
    can be changed on remount.  The size parameter also accepts a suffix %<br />
    to limit this tmpfs instance to that percentage of your physical RAM:<br />
    <strong>the default, when neither size nor nr_blocks is specified, is size=50%</strong>
      <a href="/2011/06/09/inode-problem-of-tmpfs/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/03/aggregate-multi-servers-rollback-log-by-gearmand/" title="用gearman汇总多台服务器的回滚日志" rel="bookmark">用gearman汇总多台服务器的回滚日志</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-03 00:00:00 +0800">03 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>gearman其实不是重点，因为我就是抄了一遍perldoc的样例而已。关键在服务器上的log4j日志是回滚的，所以需要配合回滚（猜测log4j的DailyRollingFile回滚方式类似mv resin.log resin.log-ymd &amp;&amp; reload，这样在回滚后，FH还在resin.log-ymd上，就读不到新日志了）重启FH。<br />
另：tail命令有个参数-F/&ndash;follow=name，可以锁定文件名而不是文件描述符，不知道这个功能是怎么做到的？<br />
一步一步来：
      <a href="/2011/06/03/aggregate-multi-servers-rollback-log-by-gearmand/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/06/01/intro-html-template/" title="HTML::Template试用" rel="bookmark">HTML::Template试用</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-06-01 00:00:00 +0800">01 Jun 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>给我自己的学习计划做个开头，从html::template开始试用。<br />
首先利用上上篇的nmap.pl脚本，提取一些数据，然后展示在页面上。<br />
cgi脚本如下：<br />
<code class="highlighter-rouge">perl#!/usr/bin/perl -w
use HTML::Template;
use XML::Simple;
use Net::MySQL;
#定期执行这个
#system("nmap -n -p 22,5666 10.168.168.0/23 10.168.170.0/24 -oX output.xml");
my $text = XMLin("output.xml");
#读取html模版
my $temp = HTML::Template-&gt;new(filename =&gt; '../template/html/server.tmpl');
my $localhost = '127.0.0.1';
my @array = ();
my $i = 0;
my $hash = {};
while ( $text-&gt;{host}-&gt;[$i] ) {
#因为新增了ssh端口扫描，所以xml解析和前例稍有不同
    my $ssh_state = $text-&gt;{host}-&gt;[$i]-&gt;{ports}-&gt;{port}-&gt;[0]-&gt;{state}-&gt;{state};
    my $nrpe_state = $text-&gt;{host}-&gt;[$i]-&gt;{ports}-&gt;{port}-&gt;[1]-&gt;{state}-&gt;{state};
    my $ip = ref($text-&gt;{host}-&gt;[$i]-&gt;{address}) eq 'ARRAY' ? $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;[0]-&gt;{addr} : $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;{addr};
    my $mac = ref($text-&gt;{host}-&gt;[$i]-&gt;{address}) eq 'ARRAY' ? $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;[1]-&gt;{addr} : '00:1E:C9:E6:E1:7C';
    $i++;
    my $channel = &amp;amp;mysql_query($mac);
#将ip按照频道排成列表，每个ip存有ssh和nrpe状态
    if ( exists $hash-&gt;{$channel} ) {
        push @{$hash-&gt;{$channel}}, { 'IP' =&gt; $ip, 'SSH' =&gt; $ssh_state, 'NRPE' =&gt; $nrpe_state, };
    } else {
        $hash-&gt;{$channel}-&gt;[0] = { 'IP' =&gt; $ip, 'SSH' =&gt; $ssh_state, 'NRPE' =&gt; $nrpe_state, };
    }
}
#将上面while生成的hash转成HTML::Template认可的array，不过array的单个元素可以是hash
foreach my $key( keys %{$hash} ) {
    my $onechannel = {};
    $onechannel-&gt;{"CHANNEL"} = $key;
    my $j = 0;
    foreach my $ip( @{$hash-&gt;{$key}} ) {
        $onechannel-&gt;{"IP_LOOP"}-&gt;[$j] = $ip;
        $j++;
    }
    push @array, $onechannel;
}
#将array传递给之前定义的html模版
#注意：不管是param还是@array里，所有的key必须都在tmpl里使用，冗余也会报错
$temp-&gt;param(CHANNEL_LOOP =&gt; \@array);
#输出成html格式
print "Content-Type: text/html\n\n", $temp-&gt;output;
#这段没什么说的，根据mac获取频道
sub mysql_query {
    my $mac = shift;
    my $mysql = Net::MySQL-&gt;new( hostname =&gt; $localhost,
                                 database =&gt; 'myops',
                                 user     =&gt; 'myops',
                                 password =&gt; 'myops',
                               );
    $mysql-&gt;query("select channel from myhost where mac='$mac'");
    &amp;amp;alert("New server") unless $mysql-&gt;has_selected_record;
    my $a_record_iterator = $mysql-&gt;create_record_iterator();
    while (my $record = $a_record_iterator-&gt;each) {
        return $record-&gt;[0];
    };
}
#留着后续继续处理
sub alert {
    print @_,"\n";
}</code><br />
然后是template文件server.tmpl：<br />
```html
      <a href="/2011/06/01/intro-html-template/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/30/intro-perl_set-image_filter/" title="nginx两个小测试(perl_set/image_filter)" rel="bookmark">nginx两个小测试(perl_set/image_filter)</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-30 00:00:00 +0800">30 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#nginx-ref" title="nginx" rel="category tag">nginx</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>第一个测试，关于http_perl_module。之前写过一篇关于nginx忽略大小写的博文，今天被朋友问上门来，url是类似/Upload/Dir/2011/123_D.jpg的形式。如果单纯的lc($r-&gt;uri)，得到的url会变成/upload/dir/2011/123_d.jpg，目录是不存在的。所以要稍微改进一下。如下：<br />
<code class="highlighter-rouge">perl    perl_set $url '
        sub {
            my $r = shift;
            return $1.lc($2) if ($r-&gt;uri =~ m/^(.+\/)([^\/]+)$/);
            return $r-&gt;uri;
        }
    ';</code><br />
这样就行了。
      <a href="/2011/05/30/intro-perl_set-image_filter/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/27/analyze-the-xml-which-nmap-output/" title="nmap扫描结果xml解析脚本" rel="bookmark">nmap扫描结果xml解析脚本</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-27 00:00:00 +0800">27 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p><code class="highlighter-rouge">perl#!/usr/bin/perl -w
use XML::Simple;
use Net::MySQL;
system("nmap -n -p 5666 10.1.1.0/23 10.1.3.0/24 -oX output.xml");
my $text = XMLin("output.xml");
my $i = 0;
while ( $text-&gt;{host}-&gt;[$i] ) {
    my $nrpe = $text-&gt;{host}-&gt;[$i]-&gt;{ports}-&gt;{port}-&gt;{state}-&gt;{state};
#因为在扫描到本机的时候，是没有mac的，所以到本机时不是ARRAY而是HASH
    my $ip = ref($text-&gt;{host}-&gt;[$i]-&gt;{address}) eq 'ARRAY' ? $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;[0]-&gt;{addr} : $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;{addr};
    my $mac = ref($text-&gt;{host}-&gt;[$i]-&gt;{address}) eq 'ARRAY' ? $text-&gt;{host}-&gt;[$i]-&gt;{address}-&gt;[1]-&gt;{addr} : '00:1E:C9:E6:E1:7C';
    &amp;mysql_query($ip, $mac, $nrpe);
    $i++;
}
sub mysql_query {
my ($ip, $mac, $nrpe) = @_;
my $mysql = Net::MySQL-&gt;new( hostname =&gt; '10.1.1.25',
                             database =&gt; 'myops',
                             user     =&gt; 'myops',
                             password =&gt; 'myops',
                           );
$mysql-&gt;query(
"insert into myhost (intranet, mac, monitorstatus) values ('$ip', '$mac', '$nrpe')"
);
}</code><br />
小脚本一个，扫描内网网段内存活的机器，获取其MAC地址，以及nrpe端口情况。后期再配合myhost里的system，如果是linux（其实用nmap -O也可以获取system，但是结果不准，耗时还特别长，200台机器花10分钟），但monitorstatus还是closed的，就expect上去安装nrpe，嗯~~
      <a href="/2011/05/27/analyze-the-xml-which-nmap-output/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/20/merge-iplist-of-qqwry/" title="续上：合并纯真ip段" rel="bookmark">续上：合并纯真ip段</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-20 00:00:00 +0800">20 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>上篇提到纯真ip库有很多行是浪费的，比如下面这种：<code class="highlighter-rouge">yaml
223.214.0.0     223.215.255.255 安徽省 电信
223.216.0.0     223.219.255.255 日本
223.220.0.0     223.220.162.1   青海省 电信
223.220.162.2   223.220.162.2   青海省海东地区 平安县九歌网吧
223.220.162.3   223.221.255.255 青海省 电信</code><br />
很简单的223.220.0.0-223.221.255.255段，却被拆成了三行。于是在通过起始ip结束ip计算子网之前，还需要合并一下这些ip段。<br />
因为涉及ip比对，所以第一反应想到了mysql里有的inet_aton函数，去CPAN上搜了一下，发现有NetAddr::IP::Util模块有inet_aton函数，结果一用，发现居然生成的不是数字……于是从网上找到了pack的办法，如下：<br />
<code class="highlighter-rouge">perl#!/usr/bin/perl -w
while(&lt;&gt;){
    next unless $_ =~ /^(\S+)\s+(\S+)\s+(\S+)/;
    my $low = unpack('N',(pack('C4',(split( /\./,$1)))));
#下面这行是IP::QQWry模块里的写法
#    print $1 * 256**3 + $2 * 256**2 + $3 * 256 + $4 if $1 =~ /(\d+)\.(\d+)\.(\d+)\.(\d+)/;;
    my $high = unpack('N',(pack('C4',(split( /\./,$2)))));
    next if $low == $high;
    my $addr = $3;
    unless ( $hash-&gt;{$addr}-&gt;{high}-&gt;[0] ) {
        $hash-&gt;{$addr}-&gt;{low}-&gt;[0] = $low;
        $hash-&gt;{$addr}-&gt;{high}-&gt;[0] = $high;
        next;
    };
#如果中间就隔几个ip的，可以无视之，合并就是了……
    if ( $low - $hash-&gt;{$addr}-&gt;{high}-&gt;[0] &lt; 16 ) {
        $hash-&gt;{$addr}-&gt;{high}-&gt;[0] = $high;
        next;
    };
    unshift @{$hash-&gt;{$addr}-&gt;{low}}, $low;
    unshift @{$hash-&gt;{$addr}-&gt;{high}}, $high;
};
foreach $addr ( keys %{$hash} ) {
    my $i = 0;
    while ( $hash-&gt;{$addr}-&gt;{low}-&gt;[$i] ) {
        print $addr . "\t" . &amp;nota($hash-&gt;{$addr}-&gt;{low}-&gt;[$i]) . "\t" . &amp;nota($hash-&gt;{$addr}-&gt;{high}-&gt;[$i]) , "\n";
        $i++;
    }
};
sub nota {
    my $aton = shift;
    @a = unpack('C4',(pack('N',$aton)));
    return (join "\.",@a);
};</code><br />
pack真复杂，基本看不懂perldoc，唉……
      <a href="/2011/05/20/merge-iplist-of-qqwry/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/19/get-iplist-from-qqwry/" title="从纯真数据库里获取ip列表" rel="bookmark">从纯真数据库里获取ip列表</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-19 00:00:00 +0800">19 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>首先申明只是一个简单的方式，因为打算的是提取总列表成bind9使用的acl格式，所以不在乎性能问题。<br />
第一步、从CZ88.NET下载QQWry数据库，然后运行IP.exe，选择“解压”，然后会在桌面生成一个qqwry.txt，这里就有四十多万行的ip记录。格式如下：<br />
起始ip    结束ip   大区域     小区域<br />
但是这个大区域也不是想像中的那么整齐，比如清华大学宿舍楼也是大区域的……<br />
好在我们DNS只需要一个大概的南北指向，根据电信占主流的现实，只要取出来联通的，其他都算电信就行了~<br />
第二步、把起始ip-结束ip改成acl需要的子网掩码格式，这一步用perl完成，全文如下：<br />
<code class="highlighter-rouge">perl
#!/usr/bin/perl -w
use Net::IPAddress::Util::Range;
while(&lt;&gt;){
    next unless $_ =~ /^(\S+)\s+(\S+)\s+(.+)/;
    my $range = Net::IPAddress::Util::Range-&gt;new({ lower =&gt; $1, upper =&gt; $2 });
    map {printf "%s\t%s\n", $_, $3 } $range-&gt;tight()-&gt;as_cidrs();
}
</code><br />
其中tight()-&gt;as_cidrs()其实是Net::IPAddress::Util::Collection的函数（Range.pm里use了这个函数）。tight将不规律的ip段划分成规律的子网，cidrs将类似(1.1.1.0 .. .1.1.1.255)改成1.1.1.0/24。<br />
如果直接采用Net::IPAddress::Util::Range的$range-&gt;as_cidr()的话，它会把一个不规律的ip段取一个最近的规律子网来显示……比方1.59.0.0-1.60.149.255会被计算成1.57.0.0/13！！<br />
不过这个还有一个问题，就是没有多行合并，导致条目太多~~这个之后再看吧~
      <a href="/2011/05/19/get-iplist-from-qqwry/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/12/script-process-link-failure/" title="链路故障应急处理脚本" rel="bookmark">链路故障应急处理脚本</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-12 00:00:00 +0800">12 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#monitor-ref" title="monitor" rel="category tag">monitor</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>话接上篇，继续完成这个perl脚本。花了今天一天的时间，基本定稿如下：<br />
```perl#!/usr/bin/perl -w<br />
use Net::Ping::External qw(ping);<br />
use Tie::File;<br />
use Getopt::Long;
      <a href="/2011/05/12/script-process-link-failure/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/12/learning-bless-and-write-pm-demo/" title="学习pm和bless的写法" rel="bookmark">学习pm和bless的写法</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-12 00:00:00 +0800">12 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>考虑到公司环境必须先rsa_auth再su的问题，一般的pssh啊mussh啊sshbatch啊，都不能直接用，决定把上篇脚本里的相关部分抽出来成为一个模块，借机学习一下package和bless的简单概念：<br />
```perl<br />
#包名，如果做pm的话，必须和(.*).pm的名字一样<br />
package raocl;<br />
use Parallel::ForkManager;<br />
use Expect;<br />
#Exporter模块是perl提供的导入模块方法的工具<br />
use base &lsquo;Exporter&rsquo;;<br />
#Exporter有两个数组，@EXPORT里存的是模块的sub，@EXPORT_OK里存的是模块的var；<br />
#使用模块时只能调用这些数组里有定义的东西<br />
our @EXPORT = qw/new cluster/;<br />
#一般模块都有一个new方法来进行初始化定义<br />
sub new {<br />
#所有sub传入的第一个参数都是本身，所以要先shift出来，然后才是脚本显式传入的参数<br />
my $class = shift;<br />
#将参数转成哈希方式，并返回一个引用；<br />
#正规做法应该在这里指定一些必须要有的参数，比如passwd =&gt; %args{&lsquo;passwd&rsquo;} || &lsquo;123456&rsquo;<br />
my $self = {@_};<br />
#bless上面返回的哈希引用到自己，再传递出去；以后在这之外的地方，使用被bless过的$self时自动就关联上new里的数据了。<br />
#这里我写的极简单，看比较正式的模块写发，这里对$class还要用ref();判断是不是引用等<br />
return bless $self,$class;<br />
}
      <a href="/2011/05/12/learning-bless-and-write-pm-demo/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/09/expect-module-of-perl/" title="perl的Expect模块" rel="bookmark">perl的Expect模块</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-09 00:00:00 +0800">09 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#perl-ref" title="perl" rel="category tag">perl</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>手头一批机器，因为历史的原因，有些密码登录、有些密钥登录，有些wheel组免密码su - root、有些又不行。为了统一管理操作，得想办法找一个能适应这四种情况的自动登录方法。
      <a href="/2011/05/09/expect-module-of-perl/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/05/06/awk_variable_example_in_linux_system_script/" title="linux系统脚本中的awk一例" rel="bookmark">linux系统脚本中的awk一例</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-05-06 00:00:00 +0800">06 May 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#bash-ref" title="bash" rel="category tag">bash</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>感谢@snowave童鞋，摘取了/usr/bin/run-parts最后一段的awk内容给我看：
      <a href="/2011/05/06/awk_variable_example_in_linux_system_script/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div class="full" style='background-color: #FFF;'>
    <h2 class="entry-title">
      <a href="/2011/04/13/test-inode-support-of-reiserfs-xfs/" title="reiserfs和xfs的inode测试" rel="bookmark">reiserfs和xfs的inode测试</a>
    </h2>
    <p class="alt-font tight">
      <span class="date full-date">
        <abbr class="published" title="2011-04-13 00:00:00 +0800">13 Apr 2011</abbr>
      </span>
      <span>
      </span>
      Posted in&nbsp;
      <a href="/categories.html#testing-ref" title="testing" rel="category tag">testing</a>
    </p>
    <div class="entry-content full-content" style='background-color: #FFF; margin-left: 24px; padding: 10px;'>
    <p>某应用的碎文件生成太多，大量消耗inode，不得不做迁移调整。<br />
原先的使用的NetApp存储，虽然可以调节inode，但是有一个上限，最高就是40000000——说实话真的挺小的啊~~<br />
一个同样大小的普通服务器ext3文件系统，在没有强行指定的情况下，inode都有将近3个亿，是netapp的7倍。<br />
了解了一下ext3文件系统在分区时指定inode最大可用数的情况，大致可以理解为小于可用空间大小/256。详细分析测试情况见：http://blog.wgzhao.com/2008/04/13/how-much-inodes-do-you-need.html，大意是inode个数由block大小和单个inode的字节决定。理论上最小block是1024，实际（采用-N强行指定的话）可能是256左右。
      <a href="/2011/04/13/test-inode-support-of-reiserfs-xfs/" class="read_more span2 pull-right">继续阅读……</a>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <div class="rule"><hr/></div>
  <div id="post-pagination" class="pagination pagination-centered">
  <ul class="pages nav nav-pills">
    <li>
      <a href="/page9">Previous</a>
    </li>
    <li class="page">
      <a href="/">1</a>
    </li>
    <li class="page">
      <a href="/page2">2</a>
    </li>
    <li class="page">
      <a href="/page3">3</a>
    </li>
    <li class="page">
      <a href="/page4">4</a>
    </li>
    <li class="page">
      <a href="/page5">5</a>
    </li>
    <li class="page">
      <a href="/page6">6</a>
    </li>
    <li class="page">
      <a href="/page7">7</a>
    </li>
    <li class="page">
      <a href="/page8">8</a>
    </li>
    <li class="page">
      <a href="/page9">9</a>
    </li>
    <li class="page active">
      <a href="#">10</a>
    </li>
    <li class="page">
      <a href="/page11">11</a>
    </li>
    <li class="page">
      <a href="/page12">12</a>
    </li>
    <li class="page">
      <a href="/page13">13</a>
    </li>
    <li class="page">
      <a href="/page14">14</a>
    </li>
    <li class="page">
      <a href="/page15">15</a>
    </li>
    <li class="page">
      <a href="/page16">16</a>
    </li>
    <li class="page">
      <a href="/page17">17</a>
    </li>
    <li class="page">
      <a href="/page18">18</a>
    </li>
    <li class="page">
      <a href="/page19">19</a>
    </li>
    <li>
      <a href="/page11">Next</a>
    </li>
  </ul>
</div>
</div>
      </div>
      <div class="span4">
          <div class="well sidebar-nav">
             <ul id="relate_blog" class="nav nav-list">
               <li class="nav-header">最近文章</li>
                 <li><a href="/2016/03/16/juttle-intro/">juttle 介绍</a></li>
                 <li><a href="/2016/01/27/kibana-server-plugin-develop/">Kibana4 服务器端插件开发</a></li>
                 <li><a href="/2015/12/27/report-of-this-year/">2015 年度个人总结</a></li>
                 <li><a href="/2015/11/25/rsyslog-mmnormalize/">Rsyslog 的 mmnormalize 模块用法</a></li>
                 <li><a href="/2015/10/29/siren/">SIREn 插件试用</a></li>
                 <li><a href="/2015/10/25/escc/">ESCC 参会笔记</a></li>
                 <li><a href="/2015/10/20/escc/">ESCC 参会笔记</a></li>
                 <li><a href="/2015/09/24/condition-in-rsyslog/">rsyslog 中 if 条件判断的限制</a></li>
                 <li><a href="/2015/08/25/kibana-custom-field-formatters/">【翻译】Kibana 字段的自定义展示格式开发</a></li>
            </ul>
          </div>
        <div class="well sidebar-nav">
          <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1035836154&verifier=a26926d5&dpc=1"></iframe>
        </div>
        <div class="well sidebar-nav">
            <div id="uyan_list_time_frame"></div>
            <script type="text/javascript" id="UYScriptTime" src="http://v1.uyan.cc/js/iframe_time_list.js?UYUserId=1589850&rankType=time" async=""></script>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(英文)</li>
              <li><a href="http://codeascraft.com/" title="Etsy 运维团队博客">Code as Craft</a></li>
              <li><a href="http://devopsanywhere.blogspot.jp/" title="">devopsanywhere</a></li>
              <li><a href="http://www.jedi.be/blog/" title="">Jong En Dynamische Informatica</a></li>
              <li><a href="http://www.planetdevops.net/" title="">planetdevops</a></li>
              <li><a href="http://www.kitchensoap.com/" title="《网站运维》作者，Etsy 运维">Kitchen Soap</a></li>
              <li><a href="http://blog.johngoulah.com" title="Musings of linux, open source, cloud computing and systems">John Goulah</a></li>
              <li><a href="http://serverfault.com/" title="stackexchange下属的系统工程师问答网站">serverfault</a></li>
              <li><a href="http://www.thegeekstuff.com/" title="各种超酷Linux命令用法">TheGeekStuff</a></li>
              <li><a href="http://neilb.org/" title="The good,the bad,and the beautiful">neilb</a></li>
              <li><a href="http://www.reddit.com/r/perl/" title="">reddit perl 频道</a></li>
              <li><a href="http://jpetazzo.github.io/" title="">~jpetazzo</a></li>
              <li><a href="http://www.perfplanet.com/" title="News and views from the web performance blogosphere">Performance Planet</a></li>
              <li><a href="http://cuddletech.com/blog/" title="Use UNIX or die">Cuddle Tech</a></li>
              <li><a href="http://showmetheco.de/" title="Viacheslav Tykhanovskyi(PocketIO/Text::Haml)">No time to wait</a></li>
              <li><a href="http://blog.dataloop.io/" title="A new SaaS monitoring tool for DevOps & Operations">Dataloop.IO</a></li>
              <li><a href="http://www.ducea.com/" title="">MDLog:/sysadmin</a></li>
              <li><a href="http://planeteria.org/perl6/" title="Perl6 文集">Planet Perl 6</a></li>
              <li><a href="http://www.metaforsoftware.com/blog/" title="">metafor</a></li>
              <li><a href="http://blog.kablamo.org/" title="Eric Johnson，一个游走在伦敦和北京的 Perler">kablamo</a></li>
              <li><a href="http://aphyr.com/posts" title="call me maybe 吐槽系列">Aphyr</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="linklists" class="nav nav-list">
            <li class="nav-header">友情链接(中文)</li>
              <li><a href="http://www.nginxs.com/" title="">eric</a></li>
              <li><a href="http://www.hellodb.net/" title="Ali DBA 张瑞">Hello DBA</a></li>
              <li><a href="http://blog.nosqlfan.com/" title="not only sql信息集散地">NoSQLfan</a></li>
              <li><a href="http://ourmysql.com/" title="">OurMySQL</a></li>
              <li><a href="http://timo.piqiu.me/" title="TIMO IS MY OASIS">Timo</a></li>
              <li><a href="http://www.liurongxing.com/" title="">刘荣星</a></li>
              <li><a href="http://www.cnadn.net/" title="F5工程师">应用交付学习之路</a></li>
              <li><a href="http://scmbob.org/" title="杭州NSN工程师，shell高人~">扛一肩记忆</a></li>
              <li><a href="http://www.php-oa.com/" title="音悦台技术经理">扶凯</a></li>
              <li><a href="http://www.lark.net.cn/" title="王剑">lark's cloud</a></li>
              <li><a href="http://log.heartoutside.com/" title="HeartOutSide">HeartOutside</a></li>
              <li><a href="http://blog.liulantao.com/" title="刘兰涛">Lax</a></li>
              <li><a href="http://niubie.me/" title="莫言">莫言</a></li>
              <li><a href="http://noops.me/" title="小米运维部">NoOps</a></li>
              <li><a href="http://www.searchtech.pro/" title="">云端分布式搜索技术</a></li>
              <li><a href="http://www.usefulshare.com" title="当当网安全运维">UsefulShare</a></li>
              <li><a href="http://junqili.com/" title="深入研究puppet">纸飞机</a></li>
              <li><a href="http://www.chinaxing.org/" title="">ChinaXing</a></li>
              <li><a href="http://bubbyroom.com/" title="守住每一天">Liuyu's blog</a></li>
              <li><a href="http://blog.aka-cool.net/" title="">Aka.Why</a></li>
              <li><a href="http://blog.l8ii.com/" title="刘侨">LairdNote</a></li>
              <li><a href="http://flw.tools/" title="">flw的工具箱</a></li>
              <li><a href="http://blog.mcshell.org/" title="">mcshell</a></li>
              <li><a href="http://novoland.github.io/" title="">克鲁斯卡尔的博客</a></li>
          </ul>
        </div>
        <div class="well sidebar-nav">
          <ul id="booklists" class="nav nav-list">
          <li class="nav-header">我写的技术书籍</li>
          <li><a href='http://product.china-pub.com/3769604'><img src='http://images.china-pub.com/ebook3765001-3770000/3769604/shupi.jpg' border='0' alt='网站运维技术与实践'/></a></li>
          <li><a href='http://product.china-pub.com/64005'><img src='http://images.china-pub.com/ebook60001-65000/64005/shupi.jpg' border='0' alt='ELK Stack权威指南'/></a></li>
          <li class="nav-header">我参与翻译的技术书籍</li>
          <li><a href='http://product.china-pub.com/4582714'><img src='http://images.china-pub.com/ebook4580001-4585000/4582714/shupi.jpg' border='0' alt='Puppet 实战手册'/></a></li>
        </div>
      </div>
    </div> <!-- row -->
      <footer>
        <p>&copy; 陈子 2015 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
  </body>
</html>
